
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>5. Seamless interoperation with the DOM &#8212; Transcrypt 3.7.15 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="7. Autotesting Transcrypt code" href="autotesting_transcrypt.html" />
    <link rel="prev" title="4. Systematic code examples: a guided tour of Transcrypt" href="supported_constructs.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="autotesting_transcrypt.html" title="7. Autotesting Transcrypt code"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="supported_constructs.html" title="4. Systematic code examples: a guided tour of Transcrypt"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Transcrypt 3.7.15 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="seamless-interoperation-with-the-dom">
<h1>5. Seamless interoperation with the DOM<a class="headerlink" href="#seamless-interoperation-with-the-dom" title="Permalink to this headline">¶</a></h1>
<div class="section" id="practical-example-a-simple-responsive-website-using-no-html-or-css-at-all">
<h2>5.1. Practical example: a simple, responsive website using no HTML or CSS at all<a class="headerlink" href="#practical-example-a-simple-responsive-website-using-no-html-or-css-at-all" title="Permalink to this headline">¶</a></h2>
<p>To many programmers, using ‘static’ HTML and CSS feels like being locked up in a closet.
As an alternative, responsiveness can simply be programmed using Transcrypt, as can be seen on <a class="reference external" href="http://www.transcrypt.org">the website of Transcrypt itself</a>.
The site adapts to diverse screen formats, device types and landscape vs. portrait mode.</p>
</div>
<div class="section" id="svg-example-turtle-graphics">
<h2>5.2. SVG example: Turtle graphics<a class="headerlink" href="#svg-example-turtle-graphics" title="Permalink to this headline">¶</a></h2>
<p><em>Turtle graphics</em> are a way to teach computer programming to children, invented by Seymour Papert in the 1960’s.
Lines are drawn as ‘track’ of a walking turtle, that can move ahead and turn.
Children use turtle graphics intuitively by imagining what they would do if they were the turtle.
This leads to a <em>recipe of motion</em>, indeed an <em>algorithm</em>, which is the basis of imperative (as opposed to e.g. declarative) programming.</p>
<p><em>SVG</em> or <em>Scalable Vector Graphics</em> are a way to display high quality graphs, e.g. in the browser.
SVG, as opposed to e.g. the HTML Canvas, bypasses the pixel paradigm and works with floating point coordinates directly.
As a consequence, SVG plots can be zoomed without becoming ragged or ‘pixelated’.</p>
<p>When looking under the hood of SVG, there’s an amazing correspondence between the primitives in an SVG <em>path</em> and the primitives of turtle graphics.
So both from an aestethical and from a conceptual point of view, turtle graphics and SVG form a happy mariage.</p>
<p>Turtle graphics in Transcrypt do not require the use of any graphics libraries. Below are two turtle graphics examples and the source code of Transcrypt’s <em>turtle</em> module, which is quite compact. As can be seen from the code integration between Transcrypt and JavaScript is trivial.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Drawing a alternatingly floodfilled star</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Free after the example from the Python 3.5 manual</span>

<span class="kn">from</span> <span class="nn">turtle</span> <span class="k">import</span> <span class="o">*</span>

<span class="n">up</span> <span class="p">()</span>
<span class="n">goto</span> <span class="p">(</span><span class="o">-</span><span class="mi">250</span><span class="p">,</span> <span class="o">-</span><span class="mi">21</span><span class="p">)</span>
<span class="n">startPos</span> <span class="o">=</span> <span class="n">pos</span> <span class="p">()</span>

<span class="n">down</span> <span class="p">()</span>
<span class="n">color</span> <span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
<span class="n">begin_fill</span> <span class="p">()</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">forward</span> <span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">right</span> <span class="p">(</span><span class="mi">170</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">distance</span> <span class="p">(</span><span class="n">startPos</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">break</span>
<span class="n">end_fill</span> <span class="p">()</span>
<span class="n">done</span> <span class="p">()</span>
</pre></div>
</div>
</div>
<p><a class="reference external" href="http://www.transcrypt.org/live/transcrypt/demos/turtle_demos/star.html">Click here to view the resulting zoomable star</a>.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Drawing the contours of a snowflake</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">turtle</span> <span class="k">import</span> <span class="o">*</span>

<span class="n">josh</span> <span class="o">=</span> <span class="n">Turtle</span> <span class="p">()</span>

<span class="k">def</span> <span class="nf">draw</span> <span class="p">(</span><span class="n">length</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
        <span class="n">draw</span> <span class="p">(</span><span class="n">length</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">josh</span><span class="o">.</span><span class="n">left</span> <span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">draw</span> <span class="p">(</span><span class="n">length</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">josh</span><span class="o">.</span><span class="n">right</span> <span class="p">(</span><span class="mi">120</span><span class="p">)</span>
        <span class="n">draw</span> <span class="p">(</span><span class="n">length</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">josh</span><span class="o">.</span><span class="n">left</span> <span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">draw</span> <span class="p">(</span><span class="n">length</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">josh</span><span class="o">.</span><span class="n">forward</span> <span class="p">(</span><span class="n">length</span><span class="p">)</span>

<span class="n">length</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">josh</span><span class="o">.</span><span class="n">up</span> <span class="p">()</span>
<span class="n">josh</span><span class="o">.</span><span class="n">forward</span> <span class="p">(</span><span class="n">length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">josh</span><span class="o">.</span><span class="n">left</span> <span class="p">(</span><span class="mi">90</span><span class="p">)</span>
<span class="n">josh</span><span class="o">.</span><span class="n">forward</span> <span class="p">(</span><span class="n">length</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">josh</span><span class="o">.</span><span class="n">right</span> <span class="p">(</span><span class="mi">90</span><span class="p">)</span>
<span class="n">josh</span><span class="o">.</span><span class="n">down</span> <span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">josh</span><span class="o">.</span><span class="n">right</span> <span class="p">(</span><span class="mi">120</span><span class="p">)</span>
    <span class="n">draw</span> <span class="p">(</span><span class="n">length</span><span class="p">)</span>
    
<span class="n">josh</span><span class="o">.</span><span class="n">done</span> <span class="p">()</span>
</pre></div>
</div>
</div>
<p><a class="reference external" href="http://www.transcrypt.org/live/demos/transcrypt/turtle_demos/snowflake.html">Click here to view the resulting zoomable snowflake</a>.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Transcrypt’s turtle graphics module sits directly on top of SVG, no libraries needed, so a very compact download</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;skip&#39;</span><span class="p">)</span>
<span class="n">document</span> <span class="o">=</span> <span class="n">Math</span> <span class="o">=</span> <span class="n">setInterval</span> <span class="o">=</span> <span class="n">clearInterval</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;noskip&#39;</span><span class="p">)</span>

<span class="n">_debug</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1">#def abs (vec2D):</span>
<span class="c1">#    return Math.sqrt (vec2D [0] * vec2D [0] + vec2D [1] * vec2D [1])</span>

<span class="n">_ns</span> <span class="o">=</span> <span class="s1">&#39;http://www.w3.org/2000/svg&#39;</span>
<span class="n">_svg</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createElementNS</span> <span class="p">(</span><span class="n">_ns</span><span class="p">,</span> <span class="s1">&#39;svg&#39;</span><span class="p">)</span>

<span class="n">_defaultElement</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span> <span class="p">(</span><span class="s1">&#39;__turtlegraph__&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">_defaultElement</span><span class="p">:</span>
    <span class="n">_defaultElement</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">body</span>
<span class="n">_defaultElement</span><span class="o">.</span><span class="n">appendChild</span> <span class="p">(</span><span class="n">_svg</span><span class="p">)</span>

<span class="n">_width</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">_height</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">_offset</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">_rightSize</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">nonlocal</span> <span class="n">_width</span>
    <span class="k">nonlocal</span> <span class="n">_height</span>
    <span class="k">nonlocal</span> <span class="n">_offset</span>
    
    <span class="n">_width</span> <span class="o">=</span> <span class="n">_defaultElement</span><span class="o">.</span><span class="n">offsetWidth</span>
    <span class="n">_height</span> <span class="o">=</span> <span class="n">_defaultElement</span><span class="o">.</span><span class="n">offsetHeight</span>
    <span class="n">_offset</span> <span class="o">=</span> <span class="p">[</span><span class="n">_width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">_height</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>
    
    <span class="n">_svg</span><span class="o">.</span><span class="n">setAttribute</span> <span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">_width</span><span class="p">)</span>
    <span class="n">_svg</span><span class="o">.</span><span class="n">setAttribute</span> <span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="n">_height</span><span class="p">)</span>
    
<span class="n">window</span><span class="o">.</span><span class="n">onresize</span> <span class="o">=</span> <span class="n">_rightSize</span>

<span class="n">_rightSize</span> <span class="p">()</span>

<span class="k">def</span> <span class="nf">bgcolor</span> <span class="p">(</span><span class="n">color</span><span class="p">):</span>
    <span class="k">nonlocal</span> <span class="n">_defaultElement</span>

    <span class="n">_bgcolor</span> <span class="o">=</span> <span class="n">color</span>
    <span class="n">_defaultElement</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="n">_bgcolor</span>

<span class="n">bgcolor</span> <span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">setDefaultElement</span> <span class="p">(</span><span class="n">element</span><span class="p">):</span>
    <span class="k">nonlocal</span> <span class="n">_defaultElement</span>

    <span class="n">_defaultElement</span><span class="o">.</span><span class="n">removeChild</span> <span class="p">(</span><span class="n">_svg</span><span class="p">)</span>
    <span class="n">_defaultElement</span> <span class="o">=</span> <span class="n">element</span>
    <span class="n">element</span><span class="o">.</span><span class="n">appendChild</span> <span class="p">(</span><span class="n">_svg</span><span class="p">)</span>
    
    <span class="n">_rightSize</span> <span class="p">()</span>
    <span class="n">bgcolor</span> <span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

<span class="n">_allTurtles</span> <span class="o">=</span> <span class="p">[]</span>
    
<span class="k">class</span> <span class="nc">Turtle</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_allTurtles</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span> <span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">reset</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">PI</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pensize</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_track</span> <span class="o">=</span> <span class="p">[]</span>    <span class="c1"># Need to make track explicitly because:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home</span> <span class="p">()</span>        <span class="c1">#   Makes a position but needs a track to put in in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span> <span class="p">()</span>       <span class="c1">#   Makes a track but needs a position to initialize it with</span>
        
    <span class="k">def</span> <span class="nf">clear</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span><span class="p">:</span>
            <span class="n">_svg</span><span class="o">.</span><span class="n">removeChild</span> <span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_track</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_moveto</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_position</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_flush</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_debug</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Flush:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_track</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="nb">len</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_track</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createElementNS</span> <span class="p">(</span><span class="n">_ns</span><span class="p">,</span> <span class="s1">&#39;path&#39;</span><span class="p">)</span>
            <span class="n">path</span><span class="o">.</span><span class="n">setAttribute</span> <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_track</span><span class="p">))</span>
            <span class="n">path</span><span class="o">.</span><span class="n">setAttribute</span> <span class="p">(</span><span class="s1">&#39;stroke&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pencolor</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pencolor</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>
            <span class="n">path</span><span class="o">.</span><span class="n">setAttribute</span> <span class="p">(</span><span class="s1">&#39;stroke-width&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pensize</span><span class="p">)</span>
            <span class="n">path</span><span class="o">.</span><span class="n">setAttribute</span> <span class="p">(</span><span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fillcolor</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fillcolor</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;none&#39;</span><span class="p">)</span>           
            <span class="n">path</span><span class="o">.</span><span class="n">setAttribute</span> <span class="p">(</span><span class="s1">&#39;fill-rule&#39;</span><span class="p">,</span> <span class="s1">&#39;evenodd&#39;</span><span class="p">)</span>
            <span class="n">_svg</span><span class="o">.</span><span class="n">appendChild</span> <span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_paths</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="n">path</span><span class="p">)</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">_track</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_moveto</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_position</span><span class="p">)</span>   <span class="c1"># _track should start with a move command</span>
        
    <span class="k">def</span> <span class="nf">done</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flush</span> <span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">pensize</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flush</span> <span class="p">()</span>
        <span class="k">if</span> <span class="n">width</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pensize</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pensize</span> <span class="o">=</span> <span class="n">width</span>
    
    <span class="k">def</span> <span class="nf">color</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pencolor</span><span class="p">,</span> <span class="n">fillcolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flush</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pencolor</span> <span class="o">=</span> <span class="n">pencolor</span>
        
        <span class="k">if</span> <span class="n">fillcolor</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fillcolor</span> <span class="o">=</span> <span class="n">fillcolor</span>
    
    <span class="k">def</span> <span class="nf">goto</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_track</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span> <span class="p">(</span>
            <span class="s1">&#39;L&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_down</span> <span class="k">else</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">_offset</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">_offset</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_moveto</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">wasdown</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isdown</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">up</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goto</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wasdown</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">down</span> <span class="p">()</span>
            
    <span class="k">def</span> <span class="nf">home</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_moveto</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">position</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="p">[:]</span>
        
    <span class="k">def</span> <span class="nf">pos</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">distance</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">other</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
            
        <span class="n">dX</span> <span class="o">=</span> <span class="n">other</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dY</span> <span class="o">=</span> <span class="n">other</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="n">sqrt</span> <span class="p">(</span><span class="n">dX</span> <span class="o">*</span> <span class="n">dX</span> <span class="o">+</span> <span class="n">dY</span> <span class="o">*</span> <span class="n">dY</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">up</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_down</span> <span class="o">=</span> <span class="kc">False</span>
        
    <span class="k">def</span> <span class="nf">down</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_down</span> <span class="o">=</span> <span class="kc">True</span>
        
    <span class="k">def</span> <span class="nf">isdown</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_down</span>
        
    <span class="k">def</span> <span class="nf">_predict</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="p">[</span><span class="n">Math</span><span class="o">.</span><span class="n">sin</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_heading</span><span class="p">),</span> <span class="n">Math</span><span class="o">.</span><span class="n">cos</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_heading</span><span class="p">)]</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">length</span> <span class="o">*</span> <span class="n">delta</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">length</span> <span class="o">*</span> <span class="n">delta</span> <span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        
    <span class="k">def</span> <span class="nf">forward</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict</span> <span class="p">(</span><span class="n">length</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_track</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span> <span class="p">(</span>
            <span class="s1">&#39;L&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_down</span> <span class="k">else</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">_offset</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">_offset</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">back</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forward</span> <span class="p">(</span><span class="o">-</span><span class="n">length</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">circle</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="p">(</span><span class="mi">90</span><span class="p">)</span>
        <span class="n">opposite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_predict</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">radius</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="p">(</span><span class="mi">90</span><span class="p">)</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">_track</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span> <span class="p">(</span>
            <span class="s1">&#39;A&#39;</span><span class="p">,</span>
            <span class="n">radius</span><span class="p">,</span>
            <span class="n">radius</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="n">opposite</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">_offset</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">opposite</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">_offset</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_track</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span> <span class="p">(</span>
            <span class="s1">&#39;A&#39;</span><span class="p">,</span>
            <span class="n">radius</span><span class="p">,</span>
            <span class="n">radius</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">_offset</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_position</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">_offset</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">))</span>
        
    <span class="k">def</span> <span class="nf">left</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heading</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_heading</span> <span class="o">+</span> <span class="n">Math</span><span class="o">.</span><span class="n">PI</span> <span class="o">*</span> <span class="n">angle</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">PI</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">right</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="p">(</span><span class="o">-</span><span class="n">angle</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">begin_fill</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flush</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="k">def</span> <span class="nf">end_fill</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flush</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill</span> <span class="o">=</span> <span class="kc">False</span>
        
    <span class="k">def</span> <span class="nf">speed</span> <span class="p">(</span><span class="n">speed</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">pass</span>
        
<span class="n">_defaultTurtle</span> <span class="o">=</span> <span class="n">Turtle</span> <span class="p">()</span>
<span class="n">_timer</span> <span class="o">=</span> <span class="kc">None</span>
    
<span class="k">def</span> <span class="nf">reset</span> <span class="p">():</span>
    <span class="k">nonlocal</span> <span class="n">_timer</span><span class="p">,</span> <span class="n">_allTurtles</span>
    <span class="k">if</span> <span class="n">_timer</span><span class="p">:</span>
        <span class="n">clearTimeout</span> <span class="p">(</span><span class="n">_timer</span><span class="p">)</span>
    <span class="n">bgcolor</span> <span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">turtle</span> <span class="ow">in</span> <span class="n">_allTurtles</span><span class="p">:</span>
        <span class="n">turtle</span><span class="o">.</span><span class="n">reset</span> <span class="p">()</span>
        <span class="n">turtle</span><span class="o">.</span><span class="n">done</span> <span class="p">()</span>
        
<span class="k">def</span> <span class="nf">clear</span> <span class="p">():</span>
    <span class="k">nonlocal</span> <span class="n">_allTurtles</span>
    <span class="k">for</span> <span class="n">turtle</span> <span class="ow">in</span> <span class="n">_allTurtles</span><span class="p">:</span>
        <span class="n">turtle</span><span class="o">.</span><span class="n">clear</span> <span class="p">()</span>
        
<span class="k">def</span> <span class="nf">ontimer</span> <span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="k">nonlocal</span> <span class="n">_timer</span>
    <span class="n">_timer</span> <span class="o">=</span> <span class="n">setTimeout</span> <span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">done</span> <span class="p">():</span>                            <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">done</span> <span class="p">()</span>
<span class="k">def</span> <span class="nf">pensize</span> <span class="p">(</span><span class="n">width</span><span class="p">):</span>                    <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">pensize</span> <span class="p">(</span><span class="n">width</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">color</span> <span class="p">(</span><span class="n">pencolor</span><span class="p">,</span> <span class="n">fillcolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">color</span> <span class="p">(</span><span class="n">pencolor</span><span class="p">,</span> <span class="n">fillcolor</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span> <span class="p">():</span>                            <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">home</span> <span class="p">()</span>
<span class="k">def</span> <span class="nf">goto</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>                 <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">goto</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">position</span> <span class="p">():</span>                        <span class="k">return</span> <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">position</span> <span class="p">()</span>
<span class="k">def</span> <span class="nf">pos</span> <span class="p">():</span>                             <span class="k">return</span> <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">pos</span> <span class="p">()</span>
<span class="k">def</span> <span class="nf">distance</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>             <span class="k">return</span> <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">distance</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">up</span> <span class="p">():</span>                              <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">up</span> <span class="p">()</span>
<span class="k">def</span> <span class="nf">down</span> <span class="p">():</span>                            <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">down</span> <span class="p">()</span>
<span class="k">def</span> <span class="nf">forward</span> <span class="p">(</span><span class="n">length</span><span class="p">):</span>                   <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">forward</span> <span class="p">(</span><span class="n">length</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">back</span> <span class="p">(</span><span class="n">length</span><span class="p">):</span>                      <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">back</span> <span class="p">(</span><span class="n">length</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">circle</span> <span class="p">(</span><span class="n">radius</span><span class="p">):</span>                    <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">circle</span> <span class="p">(</span><span class="n">radius</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">left</span> <span class="p">(</span><span class="n">angle</span><span class="p">):</span>                       <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">left</span> <span class="p">(</span><span class="n">angle</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">right</span> <span class="p">(</span><span class="n">angle</span><span class="p">):</span>                      <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">right</span> <span class="p">(</span><span class="n">angle</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">begin_fill</span> <span class="p">():</span>                      <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">begin_fill</span> <span class="p">()</span>
<span class="k">def</span> <span class="nf">end_fill</span> <span class="p">():</span>                        <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">end_fill</span> <span class="p">()</span>
<span class="k">def</span> <span class="nf">speed</span> <span class="p">(</span><span class="n">speed</span><span class="p">):</span>                      <span class="n">_defaultTurtle</span><span class="o">.</span><span class="n">speed</span> <span class="p">(</span><span class="n">speed</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Remark: In a later stage animation may be added. As a further step, for complicated fractals, transparent server side compilation of a relatively simple algorithm would allow on-line editing combined with fast client side rendering of high-resolution graphics.</p>
</div>
</div>
<div class="section" id="mixed-examples">
<h1>6. Mixed examples<a class="headerlink" href="#mixed-examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="example-pong">
<h2>6.1. Example: Pong<a class="headerlink" href="#example-pong" title="Permalink to this headline">¶</a></h2>
<p>In using the fabric.js JavaScript library this for example, the only thing differing from plain JavaScipt is that <em>new &lt;constructor&gt;</em> is replaced by <em>__new__ (&lt;constructor&gt;)</em>.</p>
<table border="1" class="docutils" id="code-pong">
<colgroup>
<col width="45%" />
<col width="55%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="literal-block-wrapper first last docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">pong.py</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;skip&#39;</span><span class="p">)</span>
<span class="n">document</span> <span class="o">=</span> <span class="n">window</span> <span class="o">=</span> <span class="n">Math</span> <span class="o">=</span> <span class="n">Date</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Prevent complaints by optional static checker</span>
<span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;noskip&#39;</span><span class="p">)</span>

<span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;noalias&#39;</span><span class="p">,</span> <span class="s1">&#39;clear&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">com.fabricjs</span> <span class="k">import</span> <span class="n">fabric</span>

<span class="n">orthoWidth</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">orthoHeight</span> <span class="o">=</span> <span class="mi">750</span>
<span class="n">fieldHeight</span> <span class="o">=</span> <span class="mi">650</span>

<span class="n">enter</span><span class="p">,</span> <span class="n">esc</span><span class="p">,</span> <span class="n">space</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">32</span>

<span class="n">window</span><span class="o">.</span><span class="n">onkeydown</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">keyCode</span> <span class="o">!=</span> <span class="n">space</span> <span class="c1"># Prevent scrolldown on spacebar press</span>

<span class="k">class</span> <span class="nc">Attribute</span><span class="p">:</span>    <span class="c1"># Attribute in the gaming sense of the word, rather than of an object</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game</span> <span class="o">=</span> <span class="n">game</span>                    <span class="c1"># Attribute knows game it&#39;s part of</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Game knows all its attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">install</span> <span class="p">()</span>                     <span class="c1"># Put in place graphical representation of attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span> <span class="p">()</span>                       <span class="c1"># Reset attribute to start position</span>
                
    <span class="k">def</span> <span class="nf">reset</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>       <span class="c1"># Restore starting positions or score, then commit to fabric</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commit</span> <span class="p">()</span>      <span class="c1"># Nothing to restore for the Attribute base class</span>
                
    <span class="k">def</span> <span class="nf">predict</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
                
    <span class="k">def</span> <span class="nf">interact</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
        
    <span class="k">def</span> <span class="nf">commit</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Sprite</span> <span class="p">(</span><span class="n">Attribute</span><span class="p">):</span>   <span class="c1"># Here, a sprite is an attribute that can move</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
        <span class="n">Attribute</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">install</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>     <span class="c1"># The sprite holds an image that fabric can display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="fm">__new__</span> <span class="p">(</span><span class="n">fabric</span><span class="o">.</span><span class="n">Rect</span> <span class="p">({</span>
            <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">scaleX</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">),</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">scaleY</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">),</span>
            <span class="s1">&#39;originX&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="s1">&#39;originY&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span>
        <span class="p">}))</span>
        
    <span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;kwargs&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">reset</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vX</span> <span class="o">=</span> <span class="n">vX</span>        <span class="c1"># Speed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vY</span> <span class="o">=</span> <span class="n">vY</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>          <span class="c1"># Predicted position, can be commit, no bouncing initially</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        
        <span class="n">Attribute</span><span class="o">.</span><span class="n">reset</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;nokwargs&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">predict</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>     <span class="c1"># Predict position, do not yet commit, bouncing may alter it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vX</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">deltaT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vY</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">deltaT</span>

    <span class="k">def</span> <span class="nf">commit</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>      <span class="c1"># Update fabric image for asynch draw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">orthoX</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">orthoY</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">draw</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">add</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
         
<span class="k">class</span> <span class="nc">Paddle</span> <span class="p">(</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="n">margin</span> <span class="o">=</span> <span class="mi">30</span> <span class="c1"># Distance of paddles from walls</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">height</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">speed</span> <span class="o">=</span> <span class="mi">400</span> <span class="c1"># / s</span>
    
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>  <span class="c1"># Paddle knows its player index, 0 == left, 1 == right</span>
        <span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">reset</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>       <span class="c1"># Put paddle in rest position, dependent on player index</span>
        <span class="n">Sprite</span><span class="o">.</span><span class="n">reset</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">orthoWidth</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">margin</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="k">else</span> <span class="o">-</span><span class="n">orthoWidth</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">margin</span><span class="p">,</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">predict</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># Let paddle react on keys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vY</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>                          <span class="c1"># Right player</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">keyCode</span> <span class="o">==</span> <span class="nb">ord</span> <span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">):</span>  <span class="c1"># Letter K pressed</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">keyCode</span> <span class="o">==</span> <span class="nb">ord</span> <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vY</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span>
        <span class="k">else</span><span class="p">:</span>                                   <span class="c1"># Left player</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">keyCode</span> <span class="o">==</span> <span class="nb">ord</span> <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">keyCode</span> <span class="o">==</span> <span class="nb">ord</span> <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vY</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">speed</span>
                
        <span class="n">Sprite</span><span class="o">.</span><span class="n">predict</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span>                   <span class="c1"># Do not yet commit, paddle may bounce with walls</span>

    <span class="k">def</span> <span class="nf">interact</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>    <span class="c1"># Paddles and ball assumed infinitely thin</span>
        <span class="c1"># Paddle touches wall</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="n">max</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">fieldHeight</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Math</span><span class="o">.</span><span class="n">min</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">fieldHeight</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>
        
        <span class="c1"># Paddle hits ball</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">ball</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
            <span class="ow">and</span> <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">ball</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="c1"># On or behind left paddle</span>
                <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">ball</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="c1"># On or behind right paddle</span>
            <span class="p">)</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">ball</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>               <span class="c1"># Ball may have gone too far already</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">ball</span><span class="o">.</span><span class="n">vX</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">ball</span><span class="o">.</span><span class="n">vX</span>  <span class="c1"># Bounce on paddle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">ball</span><span class="o">.</span><span class="n">speedUp</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
<span class="k">class</span> <span class="nc">Ball</span> <span class="p">(</span><span class="n">Sprite</span><span class="p">):</span>
    <span class="n">side</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">speed</span> <span class="o">=</span> <span class="mi">300</span> <span class="c1"># / s</span>
    
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game</span><span class="p">):</span>
        <span class="n">Sprite</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">side</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">side</span><span class="p">)</span>
 
    <span class="k">def</span> <span class="nf">reset</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>   <span class="c1"># Launch according to service direction with random angle offset from horizontal</span>
        <span class="n">angle</span> <span class="o">=</span>  <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">serviceIndex</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">PI</span>    <span class="c1"># Service direction</span>
            <span class="o">+</span>
            <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">Math</span><span class="o">.</span><span class="n">random</span> <span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">random</span> <span class="p">()</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">atan</span> <span class="p">(</span><span class="n">fieldHeight</span> <span class="o">/</span> <span class="n">orthoWidth</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="n">Sprite</span><span class="o">.</span><span class="n">reset</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">vX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">cos</span> <span class="p">(</span><span class="n">angle</span><span class="p">),</span>
            <span class="n">vY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">sin</span> <span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">predict</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Sprite</span><span class="o">.</span><span class="n">predict</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span>           <span class="c1"># Integrate velocity to position</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">orthoWidth</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>   <span class="c1"># If out on left side</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">scored</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>        <span class="c1">#   Right player scored</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">orthoWidth</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">scored</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">fieldHeight</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>   <span class="c1"># If it hits top wall</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">fieldHeight</span> <span class="o">//</span> <span class="mi">2</span>   <span class="c1">#   It may have gone too far already</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vY</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">vY</span>          <span class="c1">#   Bounce</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">fieldHeight</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">fieldHeight</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vY</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">vY</span>

    <span class="k">def</span> <span class="nf">speedUp</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bat</span><span class="p">):</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">0.15</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Math</span><span class="o">.</span><span class="n">abs</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">bat</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">bat</span><span class="o">.</span><span class="n">height</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>    <span class="c1"># Speed will increase more if paddle hit near centre</span>
        
        <span class="k">if</span> <span class="n">Math</span><span class="o">.</span><span class="n">abs</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vX</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">speed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vX</span> <span class="o">*=</span> <span class="n">factor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vY</span> <span class="o">*=</span> <span class="n">factor</span>           

<span class="k">class</span> <span class="nc">Scoreboard</span> <span class="p">(</span><span class="n">Attribute</span><span class="p">):</span>
    <span class="n">nameShift</span> <span class="o">=</span> <span class="mi">75</span>
    <span class="n">hintShift</span> <span class="o">=</span> <span class="mi">25</span>
            
    <span class="k">def</span> <span class="nf">install</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># Graphical representation of scoreboard are four labels and a separator line</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">playerLabels</span> <span class="o">=</span> <span class="p">[</span><span class="fm">__new__</span> <span class="p">(</span><span class="n">fabric</span><span class="o">.</span><span class="n">Text</span> <span class="p">(</span><span class="s1">&#39;Player </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span> <span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="p">{</span>
                <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;fontFamily&#39;</span><span class="p">:</span> <span class="s1">&#39;arial&#39;</span><span class="p">,</span> <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span> <span class="o">.</span><span class="n">format</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">30</span><span class="p">),</span>
                <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">orthoX</span> <span class="p">(</span><span class="n">position</span> <span class="o">*</span> <span class="n">orthoWidth</span><span class="p">),</span> <span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">orthoY</span> <span class="p">(</span><span class="n">fieldHeight</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameShift</span><span class="p">)</span>
        <span class="p">}))</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="p">((</span><span class="s1">&#39;AZ keys:&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="o">/</span><span class="mi">16</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;KM keys:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">16</span><span class="p">))]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">hintLabel</span> <span class="o">=</span> <span class="fm">__new__</span> <span class="p">(</span><span class="n">fabric</span><span class="o">.</span><span class="n">Text</span> <span class="p">(</span><span class="s1">&#39;[spacebar] starts game, [enter] resets score&#39;</span><span class="p">,</span> <span class="p">{</span>
                <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;fontFamily&#39;</span><span class="p">:</span> <span class="s1">&#39;arial&#39;</span><span class="p">,</span> <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">70</span><span class="p">),</span>
                <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">orthoX</span> <span class="p">(</span><span class="o">-</span><span class="mi">7</span><span class="o">/</span><span class="mi">16</span> <span class="o">*</span> <span class="n">orthoWidth</span><span class="p">),</span> <span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">orthoY</span> <span class="p">(</span><span class="n">fieldHeight</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hintShift</span><span class="p">)</span>
        <span class="p">}))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="fm">__new__</span> <span class="p">(</span><span class="n">fabric</span><span class="o">.</span><span class="n">Line</span> <span class="p">([</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">orthoX</span> <span class="p">(</span><span class="o">-</span><span class="n">orthoWidth</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">orthoY</span> <span class="p">(</span><span class="n">fieldHeight</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">orthoX</span> <span class="p">(</span><span class="n">orthoWidth</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">orthoY</span> <span class="p">(</span><span class="n">fieldHeight</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="p">{</span><span class="s1">&#39;stroke&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">}</span>
        <span class="p">))</span>
                
    <span class="k">def</span> <span class="nf">increment</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">playerIndex</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scores</span> <span class="p">[</span><span class="n">playerIndex</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        
    <span class="k">def</span> <span class="nf">reset</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">Attribute</span><span class="o">.</span><span class="n">reset</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Only does a commit here</span>
        
    <span class="k">def</span> <span class="nf">commit</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>          <span class="c1"># Committing labels is adapting their texts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scoreLabels</span> <span class="o">=</span> <span class="p">[</span><span class="fm">__new__</span> <span class="p">(</span><span class="n">fabric</span><span class="o">.</span><span class="n">Text</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span> <span class="p">(</span><span class="n">score</span><span class="p">),</span> <span class="p">{</span>
                <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;fontFamily&#39;</span><span class="p">:</span> <span class="s1">&#39;arial&#39;</span><span class="p">,</span> <span class="s1">&#39;fontSize&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">30</span><span class="p">),</span>
                <span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">orthoX</span> <span class="p">(</span><span class="n">position</span> <span class="o">*</span> <span class="n">orthoWidth</span><span class="p">),</span> <span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">orthoY</span> <span class="p">(</span><span class="n">fieldHeight</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nameShift</span><span class="p">)</span>
        <span class="p">}))</span> <span class="k">for</span> <span class="n">score</span><span class="p">,</span> <span class="n">position</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scores</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="o">/</span><span class="mi">16</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">draw</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">playerLabel</span><span class="p">,</span> <span class="n">scoreLabel</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">playerLabels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scoreLabels</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">add</span> <span class="p">(</span><span class="n">playerLabel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">add</span> <span class="p">(</span><span class="n">scoreLabel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">add</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hintLabel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">add</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        
<span class="k">class</span> <span class="nc">Game</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serviceIndex</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">Math</span><span class="o">.</span><span class="n">random</span> <span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="mi">0</span>    <span class="c1"># Index of player that has initial service</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pause</span> <span class="o">=</span> <span class="kc">True</span>                           <span class="c1"># Start game in paused state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyCode</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">textFrame</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span> <span class="p">(</span><span class="s1">&#39;text_frame&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvasFrame</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span> <span class="p">(</span><span class="s1">&#39;canvas_frame&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonsFrame</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span> <span class="p">(</span><span class="s1">&#39;buttons_frame&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="fm">__new__</span> <span class="p">(</span><span class="n">fabric</span><span class="o">.</span><span class="n">Canvas</span> <span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;backgroundColor&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;originX&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="s1">&#39;originY&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">onWindowDraw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw</span>        <span class="c1"># Install draw callback, will be called asynch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">lineWidth</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">clear</span> <span class="p">()</span>    

        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[]</span>                        <span class="c1"># All attributes will insert themselves here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paddles</span> <span class="o">=</span> <span class="p">[</span><span class="n">Paddle</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">2</span><span class="p">)]</span>    <span class="c1"># Pass game as parameter self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ball</span> <span class="o">=</span> <span class="n">Ball</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scoreboard</span> <span class="o">=</span> <span class="n">Scoreboard</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span>     

        <span class="n">window</span><span class="o">.</span><span class="n">setInterval</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>    <span class="c1"># Install update callback, time in ms</span>
        <span class="n">window</span><span class="o">.</span><span class="n">setInterval</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>      <span class="c1"># Install draw callback, time in ms</span>
        <span class="n">window</span><span class="o">.</span><span class="n">addEventListener</span> <span class="p">(</span><span class="s1">&#39;keydown&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keydown</span><span class="p">)</span>
        <span class="n">window</span><span class="o">.</span><span class="n">addEventListener</span> <span class="p">(</span><span class="s1">&#39;keyup&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyup</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;space&#39;</span><span class="p">,</span> <span class="s1">&#39;enter&#39;</span><span class="p">):</span>
            <span class="n">button</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span> <span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">button</span><span class="o">.</span><span class="n">addEventListener</span> <span class="p">(</span><span class="s1">&#39;mousedown&#39;</span><span class="p">,</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">aKey</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseOrTouch</span> <span class="p">(</span><span class="n">aKey</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span> <span class="p">(</span><span class="n">key</span><span class="p">))</span>  <span class="c1"># Returns inner lambda</span>
            <span class="n">button</span><span class="o">.</span><span class="n">addEventListener</span> <span class="p">(</span><span class="s1">&#39;touchstart&#39;</span><span class="p">,</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">aKey</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseOrTouch</span> <span class="p">(</span><span class="n">aKey</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span> <span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="n">button</span><span class="o">.</span><span class="n">addEventListener</span> <span class="p">(</span><span class="s1">&#39;mouseup&#39;</span><span class="p">,</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">aKey</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseOrTouch</span> <span class="p">(</span><span class="n">aKey</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span> <span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="n">button</span><span class="o">.</span><span class="n">addEventListener</span> <span class="p">(</span><span class="s1">&#39;touchend&#39;</span><span class="p">,</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">aKey</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseOrTouch</span> <span class="p">(</span><span class="n">aKey</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span> <span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="n">button</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="s1">&#39;pointer&#39;</span>
            <span class="n">button</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">userSelect</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buttons</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="n">button</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="o">+</span> <span class="fm">__new__</span> <span class="p">(</span><span class="n">Date</span><span class="p">)</span>
        
        <span class="n">window</span><span class="o">.</span><span class="n">onresize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resize</span> <span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">install</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
            <span class="n">attribute</span><span class="o">.</span><span class="n">install</span> <span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">mouseOrTouch</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">down</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">down</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;space&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">keyCode</span> <span class="o">=</span> <span class="n">space</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;enter&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">keyCode</span> <span class="o">=</span> <span class="n">enter</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">keyCode</span> <span class="o">=</span> <span class="nb">ord</span> <span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keyCode</span> <span class="o">=</span> <span class="kc">None</span>
 
    <span class="k">def</span> <span class="nf">update</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>                          <span class="c1"># Note that update and draw are not synchronized</span>
        <span class="n">oldTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="o">+</span> <span class="fm">__new__</span> <span class="p">(</span><span class="n">Date</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltaT</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">-</span> <span class="n">oldTime</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000.</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pause</span><span class="p">:</span>                          <span class="c1"># If in paused state</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyCode</span> <span class="o">==</span> <span class="n">space</span><span class="p">:</span>           <span class="c1">#   If spacebar hit</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pause</span> <span class="o">=</span> <span class="kc">False</span>              <span class="c1">#         Start playing</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyCode</span> <span class="o">==</span> <span class="n">enter</span><span class="p">:</span>         <span class="c1">#   Else if enter hit</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scoreboard</span><span class="o">.</span><span class="n">reset</span> <span class="p">()</span>        <span class="c1">#         Reset score</span>
        <span class="k">else</span><span class="p">:</span>                                   <span class="c1"># Else, so if in active state</span>
            <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>   <span class="c1">#   Compute predicted values</span>
                <span class="n">attribute</span><span class="o">.</span><span class="n">predict</span> <span class="p">()</span>
            
            <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>   <span class="c1">#   Correct values for bouncing and scoring</span>
                <span class="n">attribute</span><span class="o">.</span><span class="n">interact</span> <span class="p">()</span>
            
            <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>   <span class="c1">#   Commit them to pyglet for display</span>
                <span class="n">attribute</span><span class="o">.</span><span class="n">commit</span> <span class="p">()</span>
            
    <span class="k">def</span> <span class="nf">scored</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">playerIndex</span><span class="p">):</span>             <span class="c1"># Player has scored</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scoreboard</span><span class="o">.</span><span class="n">increment</span> <span class="p">(</span><span class="n">playerIndex</span><span class="p">)</span> <span class="c1"># Increment player&#39;s points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serviceIndex</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">playerIndex</span>     <span class="c1"># Grant service to the unlucky player</span>
        
        <span class="k">for</span> <span class="n">paddle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">paddles</span><span class="p">:</span>             <span class="c1"># Put paddles in rest position</span>
            <span class="n">paddle</span><span class="o">.</span><span class="n">reset</span> <span class="p">()</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">ball</span><span class="o">.</span><span class="n">reset</span> <span class="p">()</span>                      <span class="c1"># Put ball in rest position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pause</span> <span class="o">=</span> <span class="kc">True</span>                       <span class="c1"># Wait for next round</span>
        
    <span class="k">def</span> <span class="nf">commit</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
            <span class="n">attribute</span><span class="o">.</span><span class="n">commit</span> <span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">draw</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">clear</span> <span class="p">()</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
            <span class="n">attribute</span><span class="o">.</span><span class="n">draw</span> <span class="p">()</span>
             
    <span class="k">def</span> <span class="nf">resize</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">innerWidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pageHeight</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">innerHeight</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">textTop</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageHeight</span> <span class="o">&gt;</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvasWidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvasTop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textTop</span> <span class="o">+</span> <span class="mi">300</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvasWidth</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvasTop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textTop</span> <span class="o">+</span> <span class="mi">200</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvasLeft</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasWidth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvasHeight</span> <span class="o">=</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasWidth</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">buttonsTop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasTop</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasHeight</span> <span class="o">+</span> <span class="mi">50</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonsWidth</span> <span class="o">=</span> <span class="mi">500</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">textFrame</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textTop</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textFrame</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasLeft</span> <span class="o">+</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasWidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textFrame</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasWidth</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">canvasFrame</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasTop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvasFrame</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasLeft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">setDimensions</span> <span class="p">({</span><span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasWidth</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasHeight</span><span class="p">})</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonsFrame</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buttonsTop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonsFrame</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">buttonsWidth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonsFrame</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvasWidth</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">install</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commit</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span> <span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">scaleX</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">orthoWidth</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">scaleY</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="n">orthoHeight</span><span class="p">)</span>   
        
    <span class="k">def</span> <span class="nf">orthoX</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaleX</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">orthoWidth</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">orthoY</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaleY</span> <span class="p">(</span><span class="n">orthoHeight</span> <span class="o">-</span> <span class="n">fieldHeight</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
                
    <span class="k">def</span> <span class="nf">keydown</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyCode</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">keyCode</span>
        
    <span class="k">def</span> <span class="nf">keyup</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyCode</span> <span class="o">=</span> <span class="kc">None</span> 
        
<span class="n">game</span> <span class="o">=</span> <span class="n">Game</span> <span class="p">()</span>  <span class="c1"># Create and run game</span>
</pre></div>
</div>
</div>
</td>
<td><div class="literal-block-wrapper first last docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">pong.js</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// Transcrypt&#39;ed from Python, 2019-01-22 11:22:07
import {AssertionError, AttributeError, BaseException, DeprecationWarning, Exception, IndexError, IterableError, KeyError, NotImplementedError, RuntimeWarning, StopIteration, UserWarning, ValueError, Warning, __JsIterator__, __PyIterator__, __Terminal__, __add__, __and__, __call__, __class__, __envir__, __eq__, __floordiv__, __ge__, __get__, __getcm__, __getitem__, __getslice__, __getsm__, __gt__, __i__, __iadd__, __iand__, __idiv__, __ijsmod__, __ilshift__, __imatmul__, __imod__, __imul__, __in__, __init__, __ior__, __ipow__, __irshift__, __isub__, __ixor__, __jsUsePyNext__, __jsmod__, __k__, __kwargtrans__, __le__, __lshift__, __lt__, __matmul__, __mergefields__, __mergekwargtrans__, __mod__, __mul__, __ne__, __neg__, __nest__, __or__, __pow__, __pragma__, __proxy__, __pyUseJsNext__, __rshift__, __setitem__, __setproperty__, __setslice__, __sort__, __specialattrib__, __sub__, __super__, __t__, __terminal__, __truediv__, __withblock__, __xor__, abs, all, any, assert, bool, bytearray, bytes, callable, chr, copy, deepcopy, delattr, dict, dir, divmod, enumerate, filter, float, format, getattr, hasattr, input, int, isinstance, issubclass, len, list, map, max, min, object, ord, pow, print, property, py_TypeError, py_iter, py_metatype, py_next, py_reversed, py_typeof, range, repr, round, set, setattr, sorted, str, sum, tuple, zip} from &#39;./org.transcrypt.__runtime__.js&#39;;
import {fabric} from &#39;./com.fabricjs.js&#39;;
var __name__ = &#39;__main__&#39;;
export var orthoWidth = 1000;
export var orthoHeight = 750;
export var fieldHeight = 650;
var __left0__ = tuple ([13, 27, 32]);
export var enter = __left0__ [0];
export var esc = __left0__ [1];
export var space = __left0__ [2];
window.onkeydown = (function __lambda__ (event) {
    return event.keyCode != space;
});
export var Attribute =  __class__ (&#39;Attribute&#39;, [object], {
    __module__: __name__,
    get __init__ () {return __get__ (this, function (self, game) {
        self.game = game;
        self.game.attributes.append (self);
        self.install ();
        self.reset ();
    });},
    get reset () {return __get__ (this, function (self) {
        self.commit ();
    });},
    get predict () {return __get__ (this, function (self) {
        // pass;
    });},
    get interact () {return __get__ (this, function (self) {
        // pass;
    });},
    get commit () {return __get__ (this, function (self) {
        // pass;
    });}
});
export var Sprite =  __class__ (&#39;Sprite&#39;, [Attribute], {
    __module__: __name__,
    get __init__ () {return __get__ (this, function (self, game, width, height) {
        self.width = width;
        self.height = height;
        Attribute.__init__ (self, game);
    });},
    get install () {return __get__ (this, function (self) {
        self.image = new fabric.Rect (dict ({&#39;width&#39;: self.game.scaleX (self.width), &#39;height&#39;: self.game.scaleY (self.height), &#39;originX&#39;: &#39;center&#39;, &#39;originY&#39;: &#39;center&#39;, &#39;fill&#39;: &#39;white&#39;}));
    });},
    get reset () {return __get__ (this, function (self, vX, vY, x, y) {
        if (typeof vX == &#39;undefined&#39; || (vX != null &amp;&amp; vX.hasOwnProperty (&quot;__kwargtrans__&quot;))) {;
            var vX = 0;
        };
        if (typeof vY == &#39;undefined&#39; || (vY != null &amp;&amp; vY.hasOwnProperty (&quot;__kwargtrans__&quot;))) {;
            var vY = 0;
        };
        if (typeof x == &#39;undefined&#39; || (x != null &amp;&amp; x.hasOwnProperty (&quot;__kwargtrans__&quot;))) {;
            var x = 0;
        };
        if (typeof y == &#39;undefined&#39; || (y != null &amp;&amp; y.hasOwnProperty (&quot;__kwargtrans__&quot;))) {;
            var y = 0;
        };
        if (arguments.length) {
            var __ilastarg0__ = arguments.length - 1;
            if (arguments [__ilastarg0__] &amp;&amp; arguments [__ilastarg0__].hasOwnProperty (&quot;__kwargtrans__&quot;)) {
                var __allkwargs0__ = arguments [__ilastarg0__--];
                for (var __attrib0__ in __allkwargs0__) {
                    switch (__attrib0__) {
                        case &#39;self&#39;: var self = __allkwargs0__ [__attrib0__]; break;
                        case &#39;vX&#39;: var vX = __allkwargs0__ [__attrib0__]; break;
                        case &#39;vY&#39;: var vY = __allkwargs0__ [__attrib0__]; break;
                        case &#39;x&#39;: var x = __allkwargs0__ [__attrib0__]; break;
                        case &#39;y&#39;: var y = __allkwargs0__ [__attrib0__]; break;
                    }
                }
            }
        }
        else {
        }
        self.vX = vX;
        self.vY = vY;
        self.x = x;
        self.y = y;
        Attribute.reset (self);
    });},
    get predict () {return __get__ (this, function (self) {
        self.x += self.vX * self.game.deltaT;
        self.y += self.vY * self.game.deltaT;
    });},
    get commit () {return __get__ (this, function (self) {
        self.image.left = self.game.orthoX (self.x);
        self.image.top = self.game.orthoY (self.y);
    });},
    get draw () {return __get__ (this, function (self) {
        self.game.canvas.add (self.image);
    });}
});
export var Paddle =  __class__ (&#39;Paddle&#39;, [Sprite], {
    __module__: __name__,
    margin: 30,
    width: 10,
    height: 100,
    speed: 400,
    get __init__ () {return __get__ (this, function (self, game, index) {
        self.index = index;
        Sprite.__init__ (self, game, self.width, self.height);
    });},
    get reset () {return __get__ (this, function (self) {
        Sprite.reset (self, __kwargtrans__ ({x: (self.index ? Math.floor (orthoWidth / 2) - self.margin : Math.floor (-(orthoWidth) / 2) + self.margin), y: 0}));
    });},
    get predict () {return __get__ (this, function (self) {
        self.vY = 0;
        if (self.index) {
            if (self.game.keyCode == ord (&#39;K&#39;)) {
                self.vY = self.speed;
            }
            else if (self.game.keyCode == ord (&#39;M&#39;)) {
                self.vY = -(self.speed);
            }
        }
        else if (self.game.keyCode == ord (&#39;A&#39;)) {
            self.vY = self.speed;
        }
        else if (self.game.keyCode == ord (&#39;Z&#39;)) {
            self.vY = -(self.speed);
        }
        Sprite.predict (self);
    });},
    get interact () {return __get__ (this, function (self) {
        self.y = Math.max (Math.floor (self.height / 2) - Math.floor (fieldHeight / 2), Math.min (self.y, Math.floor (fieldHeight / 2) - Math.floor (self.height / 2)));
        if ((self.y - Math.floor (self.height / 2) &lt; self.game.ball.y &amp;&amp; self.game.ball.y &lt; self.y + Math.floor (self.height / 2)) &amp;&amp; (self.index == 0 &amp;&amp; self.game.ball.x &lt; self.x || self.index == 1 &amp;&amp; self.game.ball.x &gt; self.x)) {
            self.game.ball.x = self.x;
            self.game.ball.vX = -(self.game.ball.vX);
            self.game.ball.speedUp (self);
        }
    });}
});
export var Ball =  __class__ (&#39;Ball&#39;, [Sprite], {
    __module__: __name__,
    side: 8,
    speed: 300,
    get __init__ () {return __get__ (this, function (self, game) {
        Sprite.__init__ (self, game, self.side, self.side);
    });},
    get reset () {return __get__ (this, function (self) {
        var angle = self.game.serviceIndex * Math.PI + ((Math.random () &gt; 0.5 ? 1 : -(1)) * Math.random ()) * Math.atan (fieldHeight / orthoWidth);
        Sprite.reset (self, __kwargtrans__ ({vX: self.speed * Math.cos (angle), vY: self.speed * Math.sin (angle)}));
    });},
    get predict () {return __get__ (this, function (self) {
        Sprite.predict (self);
        if (self.x &lt; Math.floor (-(orthoWidth) / 2)) {
            self.game.scored (1);
        }
        else if (self.x &gt; Math.floor (orthoWidth / 2)) {
            self.game.scored (0);
        }
        if (self.y &gt; Math.floor (fieldHeight / 2)) {
            self.y = Math.floor (fieldHeight / 2);
            self.vY = -(self.vY);
        }
        else if (self.y &lt; Math.floor (-(fieldHeight) / 2)) {
            self.y = Math.floor (-(fieldHeight) / 2);
            self.vY = -(self.vY);
        }
    });},
    get speedUp () {return __get__ (this, function (self, bat) {
        var factor = 1 + 0.15 * Math.pow (1 - Math.abs (self.y - bat.y) / (Math.floor (bat.height / 2)), 2);
        if (Math.abs (self.vX) &lt; 3 * self.speed) {
            self.vX *= factor;
            self.vY *= factor;
        }
    });}
});
export var Scoreboard =  __class__ (&#39;Scoreboard&#39;, [Attribute], {
    __module__: __name__,
    nameShift: 75,
    hintShift: 25,
    get install () {return __get__ (this, function (self) {
        self.playerLabels = (function () {
            var __accu0__ = [];
            for (var [py_name, position] of tuple ([tuple ([&#39;AZ keys:&#39;, -(7) / 16]), tuple ([&#39;KM keys:&#39;, 1 / 16])])) {
                __accu0__.append (new fabric.Text (&#39;Player {}&#39;.format (py_name), dict ({&#39;fill&#39;: &#39;white&#39;, &#39;fontFamily&#39;: &#39;arial&#39;, &#39;fontSize&#39;: &#39;{}&#39;.format (self.game.canvas.width / 30), &#39;left&#39;: self.game.orthoX (position * orthoWidth), &#39;top&#39;: self.game.orthoY (Math.floor (fieldHeight / 2) + self.nameShift)})));
            }
            return __accu0__;
        }) ();
        self.hintLabel = new fabric.Text (&#39;[spacebar] starts game, [enter] resets score&#39;, dict ({&#39;fill&#39;: &#39;white&#39;, &#39;fontFamily&#39;: &#39;arial&#39;, &#39;fontSize&#39;: &#39;{}&#39;.format (self.game.canvas.width / 70), &#39;left&#39;: self.game.orthoX ((-(7) / 16) * orthoWidth), &#39;top&#39;: self.game.orthoY (Math.floor (fieldHeight / 2) + self.hintShift)}));
        self.image = new fabric.Line ([self.game.orthoX (Math.floor (-(orthoWidth) / 2)), self.game.orthoY (Math.floor (fieldHeight / 2)), self.game.orthoX (Math.floor (orthoWidth / 2)), self.game.orthoY (Math.floor (fieldHeight / 2))], dict ({&#39;stroke&#39;: &#39;white&#39;}));
    });},
    get increment () {return __get__ (this, function (self, playerIndex) {
        self.scores [playerIndex]++;
    });},
    get reset () {return __get__ (this, function (self) {
        self.scores = [0, 0];
        Attribute.reset (self);
    });},
    get commit () {return __get__ (this, function (self) {
        self.scoreLabels = (function () {
            var __accu0__ = [];
            for (var [score, position] of zip (self.scores, tuple ([-(2) / 16, 6 / 16]))) {
                __accu0__.append (new fabric.Text (&#39;{}&#39;.format (score), dict ({&#39;fill&#39;: &#39;white&#39;, &#39;fontFamily&#39;: &#39;arial&#39;, &#39;fontSize&#39;: &#39;{}&#39;.format (self.game.canvas.width / 30), &#39;left&#39;: self.game.orthoX (position * orthoWidth), &#39;top&#39;: self.game.orthoY (Math.floor (fieldHeight / 2) + self.nameShift)})));
            }
            return __accu0__;
        }) ();
    });},
    get draw () {return __get__ (this, function (self) {
        for (var [playerLabel, scoreLabel] of zip (self.playerLabels, self.scoreLabels)) {
            self.game.canvas.add (playerLabel);
            self.game.canvas.add (scoreLabel);
            self.game.canvas.add (self.hintLabel);
        }
        self.game.canvas.add (self.image);
    });}
});
export var Game =  __class__ (&#39;Game&#39;, [object], {
    __module__: __name__,
    get __init__ () {return __get__ (this, function (self) {
        self.serviceIndex = (Math.random () &gt; 0.5 ? 1 : 0);
        self.pause = true;
        self.keyCode = null;
        self.textFrame = document.getElementById (&#39;text_frame&#39;);
        self.canvasFrame = document.getElementById (&#39;canvas_frame&#39;);
        self.buttonsFrame = document.getElementById (&#39;buttons_frame&#39;);
        self.canvas = new fabric.Canvas (&#39;canvas&#39;, dict ({&#39;backgroundColor&#39;: &#39;black&#39;, &#39;originX&#39;: &#39;center&#39;, &#39;originY&#39;: &#39;center&#39;}));
        self.canvas.onWindowDraw = self.draw;
        self.canvas.lineWidth = 2;
        self.canvas.clear ();
        self.attributes = [];
        self.paddles = (function () {
            var __accu0__ = [];
            for (var index = 0; index &lt; 2; index++) {
                __accu0__.append (Paddle (self, index));
            }
            return __accu0__;
        }) ();
        self.ball = Ball (self);
        self.scoreboard = Scoreboard (self);
        window.setInterval (self.py_update, 10);
        window.setInterval (self.draw, 20);
        window.addEventListener (&#39;keydown&#39;, self.keydown);
        window.addEventListener (&#39;keyup&#39;, self.keyup);
        self.buttons = [];
        for (var key of tuple ([&#39;A&#39;, &#39;Z&#39;, &#39;K&#39;, &#39;M&#39;, &#39;space&#39;, &#39;enter&#39;])) {
            var button = document.getElementById (key);
            button.addEventListener (&#39;mousedown&#39;, (function __lambda__ (aKey) {
                return (function __lambda__ () {
                    return self.mouseOrTouch (aKey, true);
                });
            }) (key));
            button.addEventListener (&#39;touchstart&#39;, (function __lambda__ (aKey) {
                return (function __lambda__ () {
                    return self.mouseOrTouch (aKey, true);
                });
            }) (key));
            button.addEventListener (&#39;mouseup&#39;, (function __lambda__ (aKey) {
                return (function __lambda__ () {
                    return self.mouseOrTouch (aKey, false);
                });
            }) (key));
            button.addEventListener (&#39;touchend&#39;, (function __lambda__ (aKey) {
                return (function __lambda__ () {
                    return self.mouseOrTouch (aKey, false);
                });
            }) (key));
            button.style.cursor = &#39;pointer&#39;;
            button.style.userSelect = &#39;none&#39;;
            self.buttons.append (button);
        }
        self.time = +(new Date);
        window.onresize = self.resize;
        self.resize ();
    });},
    get install () {return __get__ (this, function (self) {
        for (var attribute of self.attributes) {
            attribute.install ();
        }
    });},
    get mouseOrTouch () {return __get__ (this, function (self, key, down) {
        if (down) {
            if (key == &#39;space&#39;) {
                self.keyCode = space;
            }
            else if (key == &#39;enter&#39;) {
                self.keyCode = enter;
            }
            else {
                self.keyCode = ord (key);
            }
        }
        else {
            self.keyCode = null;
        }
    });},
    get py_update () {return __get__ (this, function (self) {
        var oldTime = self.time;
        self.time = +(new Date);
        self.deltaT = (self.time - oldTime) / 1000.0;
        if (self.pause) {
            if (self.keyCode == space) {
                self.pause = false;
            }
            else if (self.keyCode == enter) {
                self.scoreboard.reset ();
            }
        }
        else {
            for (var attribute of self.attributes) {
                attribute.predict ();
            }
            for (var attribute of self.attributes) {
                attribute.interact ();
            }
            for (var attribute of self.attributes) {
                attribute.commit ();
            }
        }
    });},
    get scored () {return __get__ (this, function (self, playerIndex) {
        self.scoreboard.increment (playerIndex);
        self.serviceIndex = 1 - playerIndex;
        for (var paddle of self.paddles) {
            paddle.reset ();
        }
        self.ball.reset ();
        self.pause = true;
    });},
    get commit () {return __get__ (this, function (self) {
        for (var attribute of self.attributes) {
            attribute.commit ();
        }
    });},
    get draw () {return __get__ (this, function (self) {
        self.canvas.clear ();
        for (var attribute of self.attributes) {
            attribute.draw ();
        }
    });},
    get resize () {return __get__ (this, function (self) {
        self.pageWidth = window.innerWidth;
        self.pageHeight = window.innerHeight;
        self.textTop = 0;
        if (self.pageHeight &gt; 1.2 * self.pageWidth) {
            self.canvasWidth = self.pageWidth;
            self.canvasTop = self.textTop + 300;
        }
        else {
            self.canvasWidth = 0.6 * self.pageWidth;
            self.canvasTop = self.textTop + 200;
        }
        self.canvasLeft = 0.5 * (self.pageWidth - self.canvasWidth);
        self.canvasHeight = 0.6 * self.canvasWidth;
        self.buttonsTop = (self.canvasTop + self.canvasHeight) + 50;
        self.buttonsWidth = 500;
        self.textFrame.style.top = self.textTop;
        self.textFrame.style.left = self.canvasLeft + 0.05 * self.canvasWidth;
        self.textFrame.style.width = 0.9 * self.canvasWidth;
        self.canvasFrame.style.top = self.canvasTop;
        self.canvasFrame.style.left = self.canvasLeft;
        self.canvas.setDimensions (dict ({&#39;width&#39;: self.canvasWidth, &#39;height&#39;: self.canvasHeight}));
        self.buttonsFrame.style.top = self.buttonsTop;
        self.buttonsFrame.style.left = 0.5 * (self.pageWidth - self.buttonsWidth);
        self.buttonsFrame.style.width = self.canvasWidth;
        self.install ();
        self.commit ();
        self.draw ();
    });},
    get scaleX () {return __get__ (this, function (self, x) {
        return x * (self.canvas.width / orthoWidth);
    });},
    get scaleY () {return __get__ (this, function (self, y) {
        return y * (self.canvas.height / orthoHeight);
    });},
    get orthoX () {return __get__ (this, function (self, x) {
        return self.scaleX (x + Math.floor (orthoWidth / 2));
    });},
    get orthoY () {return __get__ (this, function (self, y) {
        return self.scaleY ((orthoHeight - Math.floor (fieldHeight / 2)) - y);
    });},
    get keydown () {return __get__ (this, function (self, event) {
        self.keyCode = event.keyCode;
    });},
    get keyup () {return __get__ (this, function (self, event) {
        self.keyCode = null;
    });}
});
export var game = Game ();

//# sourceMappingURL=pong.map
</pre></div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="section" id="three-ways-of-integration-with-javascript-libraries">
<h3>6.1.1. Three ways of integration with JavaScript libraries<a class="headerlink" href="#three-ways-of-integration-with-javascript-libraries" title="Permalink to this headline">¶</a></h3>
<p>There are three ways to integrate Transcrypt applications with existing JavaScript libraries.</p>
<ol class="arabic simple">
<li>The simplest way is to use the library as is, without any encapsulation. In this way all symbols of that library will be in the global namespace. While many JavaScript programmers don’t seem to mind that, many Python programmers do.</li>
<li>Another way is to encapsulate the JavaScript library as a whole in a Transcrypt module. In the distibution this is done for the <em>fabric</em> module, that encapsulates <em>fabric.js</em> and is imported in the Pong example. In this way the global namespace stays clean.</li>
<li>The third way is to write a complete Pythonic API for the JavaScript library. This is overkill in most cases and makes it harder to keep up with new versions of the library. Note that Transcrypt was desiged to make seamless cooperation between Transcrypt and JavaScript libraries possible without any glue code.</li>
</ol>
<p>In most cases this approach 2 strikes a good balance between effort and yield. As can be seen below, the effort involved is minimal.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<span id="code-encaps-fabric"></span><div class="code-block-caption"><span class="caption-text">The encapsulation layer for fabric.js</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;noanno&#39;</span><span class="p">)</span>

<span class="n">fabric</span> <span class="o">=</span> <span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;js&#39;</span><span class="p">,</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">(function () {{</span>
<span class="sd">    var exports = {{}};</span>
<span class="sd">    {}  // Puts fabric in exports and in global window</span>
<span class="sd">    delete window.fabric;</span>
<span class="sd">    return exports;</span>
<span class="sd">}}) () .fabric;</span>
<span class="sd">    &#39;&#39;&#39;</span><span class="p">,</span>
    <span class="n">__include__</span> <span class="p">(</span><span class="s1">&#39;com/fabricjs/fabric_downloaded.js&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Note that __pragma__ (‘js’, &lt;skeletoncode&gt;, includes = [&lt;file1&gt;, &lt;file2&gt;, ..]) is used to achieve the encapsulation. It replaces the {} by the respective contents of the files. The <em>fabric</em> module is part of the download. Note that not all facilities were included in customizing fabric.js. You can drop-in replace the <em>fabric.js</em> by another customized version without changing anything. Preferably download a development version, since that enables easy debugging. Transcryp will minify it for you on the fly.</p>
</div>
<div class="section" id="minification">
<h3>6.1.2. Minification<a class="headerlink" href="#minification" title="Permalink to this headline">¶</a></h3>
<p>Minification is currently performed by the Google closure compiler, that’s also part of the distribution. Currently closures ADVANCED_OPTIMIZATIONS switch breaks the working <em>strict</em> code, however, so the SIMPLE_OPTIMIZATIONS switch is used by default.</p>
<p>As can be seen from the listings of the Pong example, even the non-minified <em>pong.js</em> module is only slightly larger than <em>pong.py</em>. This is despite the expensive keyword arguments mechanism that is activated for the <em>reset</em> function, using <em>__pragma__ (‘kargs’)</em> and <em>__pragma__ (‘nokwargs’)</em>. The minified but not treeshaked Transcrypt runtime is slightly above 40 kB. The <em>fabric.js</em> library on the other hand occupies 180 kB. From this example it becomes clear that Transcrypt is extremely lightweight.</p>
</div>
</div>
<div class="section" id="example-jquery">
<h2>6.2. Example: jQuery<a class="headerlink" href="#example-jquery" title="Permalink to this headline">¶</a></h2>
<p>In contrast to the use of the <em>fabric.js</em> library in the Pong example, <em>jQuery</em> hasn’t been encapsulated at all. It’s just downloaded on the fly from a content delivery network and used as-is. Instead of the <em>$</em> (that is not a valid Python identifier), an <em>S</em> is used as <a class="reference internal" href="special_facilities.html#pragma-alias"><span class="std std-ref">alias</span></a>. This might have been any character sequence.</p>
<table border="1" class="docutils">
<colgroup>
<col width="46%" />
<col width="54%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="literal-block-wrapper first last docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">jquery_demo.py</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;alias&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;$&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">start</span> <span class="p">():</span>
    <span class="k">def</span> <span class="nf">changeColors</span> <span class="p">():</span>
        <span class="k">for</span> <span class="n">div</span> <span class="ow">in</span> <span class="n">S__divs</span><span class="p">:</span>
            <span class="n">S</span> <span class="p">(</span><span class="n">div</span><span class="p">)</span> <span class="o">.</span><span class="n">css</span> <span class="p">({</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span> <span class="p">(</span><span class="o">*</span> <span class="p">[</span><span class="nb">int</span> <span class="p">(</span><span class="mi">256</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">random</span> <span class="p">())</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">3</span><span class="p">)]),</span>
            <span class="p">})</span>

    <span class="n">S__divs</span> <span class="o">=</span> <span class="n">S</span> <span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">)</span>
    <span class="n">changeColors</span> <span class="p">()</span>
    <span class="n">window</span><span class="o">.</span><span class="n">setInterval</span> <span class="p">(</span><span class="n">changeColors</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
</td>
<td><div class="literal-block-wrapper first last docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">jquery_demo.js</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// Transcrypt&#39;ed from Python, 2019-01-22 11:21:49
import {AssertionError, AttributeError, BaseException, DeprecationWarning, Exception, IndexError, IterableError, KeyError, NotImplementedError, RuntimeWarning, StopIteration, UserWarning, ValueError, Warning, __JsIterator__, __PyIterator__, __Terminal__, __add__, __and__, __call__, __class__, __envir__, __eq__, __floordiv__, __ge__, __get__, __getcm__, __getitem__, __getslice__, __getsm__, __gt__, __i__, __iadd__, __iand__, __idiv__, __ijsmod__, __ilshift__, __imatmul__, __imod__, __imul__, __in__, __init__, __ior__, __ipow__, __irshift__, __isub__, __ixor__, __jsUsePyNext__, __jsmod__, __k__, __kwargtrans__, __le__, __lshift__, __lt__, __matmul__, __mergefields__, __mergekwargtrans__, __mod__, __mul__, __ne__, __neg__, __nest__, __or__, __pow__, __pragma__, __proxy__, __pyUseJsNext__, __rshift__, __setitem__, __setproperty__, __setslice__, __sort__, __specialattrib__, __sub__, __super__, __t__, __terminal__, __truediv__, __withblock__, __xor__, abs, all, any, assert, bool, bytearray, bytes, callable, chr, copy, deepcopy, delattr, dict, dir, divmod, enumerate, filter, float, format, getattr, hasattr, input, int, isinstance, issubclass, len, list, map, max, min, object, ord, pow, print, property, py_TypeError, py_iter, py_metatype, py_next, py_reversed, py_typeof, range, repr, round, set, setattr, sorted, str, sum, tuple, zip} from &#39;./org.transcrypt.__runtime__.js&#39;;
var __name__ = &#39;__main__&#39;;
export var start = function () {
    var changeColors = function () {
        for (var div of $divs) {
            $ (div).css (dict ({&#39;color&#39;: &#39;rgb({},{},{})&#39;.format (...(function () {
                var __accu0__ = [];
                for (var i = 0; i &lt; 3; i++) {
                    __accu0__.append (int (256 * Math.random ()));
                }
                return __accu0__;
            }) ())}));
        }
    };
    var $divs = $ (&#39;div&#39;);
    changeColors ();
    window.setInterval (changeColors, 500);
};

//# sourceMappingURL=jquery_demo.map
</pre></div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="example-ios-web-app-with-native-look-and-feel">
<h2>6.3. Example: iOS web app with native look and feel<a class="headerlink" href="#example-ios-web-app-with-native-look-and-feel" title="Permalink to this headline">¶</a></h2>
<p>You can write full screen iOS web apps in Transcrypt with native look and feel. As example here’s an app simulating 6 dice. While this example is kept very simple, you can in fact make apps of arbitrary complexity, with fast and beautiful graphics using any JS graphics library, e.g. multiplayer games working over the Internet. If you add the app to your homescreen it will be cached, so no Internet connection is needed to use it. Web apps for iOS can obtain and use location information from the user.</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/ios_app.png"><img alt="A simple dice web app for iOS" src="_images/ios_app.png" style="height: 500px;" /></a>
</div>
<div class="figure">
<a class="reference internal image-reference" href="_images/ios_app_icon.png"><img alt="The prepacked dice icon on the homescreen" src="_images/ios_app_icon.png" style="height: 500px;" /></a>
</div>
<p>You can install this app on your iPhone from <a class="reference external" href="http://www.transcrypt.org/live/transcrypt/demos/ios_app/ios_app.html">http://www.transcrypt.org/live/transcrypt/demos/ios_app/ios_app.html</a> .</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="literal-block-wrapper first last docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">ios_app.py</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="k">class</span> <span class="nc">Dice</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">addEventListener</span> <span class="p">(</span><span class="s1">&#39;touchstart&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">preventDefault</span> <span class="p">())</span>
        <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">addEventListener</span> <span class="p">(</span><span class="s1">&#39;mousedown&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">preventDefault</span> <span class="p">())</span>
        <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">margin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">overflow</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span><span class="p">;</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">all</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createElement</span> <span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="s1">&#39;100%&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="s1">&#39;100%&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">margin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">document</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">appendChild</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dices</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="n">dice</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createElement</span> <span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">)</span>
            <span class="n">dice</span><span class="o">.</span><span class="n">normalColor</span> <span class="o">=</span> <span class="s1">&#39;#770000&#39;</span> <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="s1">&#39;#0000ff&#39;</span>
            <span class="n">dice</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="s1">&#39;absolute&#39;</span>
            <span class="n">dice</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="n">dice</span><span class="o">.</span><span class="n">normalColor</span>
            <span class="n">dice</span><span class="o">.</span><span class="n">addEventListener</span> <span class="p">(</span><span class="s1">&#39;touchstart&#39;</span><span class="p">,</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">aDice</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="p">(</span><span class="n">aDice</span><span class="p">))</span> <span class="p">(</span><span class="n">dice</span><span class="p">))</span>  <span class="c1"># Returns inner lambda</span>
            <span class="n">dice</span><span class="o">.</span><span class="n">addEventListener</span> <span class="p">(</span><span class="s1">&#39;mousedown&#39;</span><span class="p">,</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">aDice</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">roll</span> <span class="p">(</span><span class="n">aDice</span><span class="p">))</span> <span class="p">(</span><span class="n">dice</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dices</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="n">dice</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">appendChild</span> <span class="p">(</span><span class="n">dice</span><span class="p">)</span>
            
            <span class="n">dice</span><span class="o">.</span><span class="n">inner</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createElement</span> <span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">)</span>
            <span class="n">dice</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">setAttribute</span> <span class="p">(</span><span class="s1">&#39;unselectable&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">)</span>
            <span class="n">dice</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">fontWeight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span>
            <span class="n">dice</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">textAlign</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
            <span class="n">dice</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="s1">&#39;absolute&#39;</span>
            <span class="n">dice</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>
            <span class="n">dice</span><span class="o">.</span><span class="n">appendChild</span> <span class="p">(</span><span class="n">dice</span><span class="o">.</span><span class="n">inner</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">banner</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">createElement</span> <span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">banner</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="s1">&#39;absolute&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">banner</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="s1">&#39;pointer&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">banner</span><span class="o">.</span><span class="n">addEventListener</span> <span class="p">(</span><span class="s1">&#39;touchstart&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gotoTranscryptSite</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">banner</span><span class="o">.</span><span class="n">addEventListener</span> <span class="p">(</span><span class="s1">&#39;mousedown&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gotoTranscryptSite</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">banner</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">fontFamily</span> <span class="o">=</span> <span class="s1">&#39;arial&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">banner</span><span class="o">.</span><span class="n">innerHTML</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s1">&#39;&lt;span id=&quot;bannerLarge&quot;&gt;&lt;font color=&quot;777777&quot;&gt;www.&lt;b&gt;&lt;i&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;font color=&quot;ff4422&quot;&gt;T&lt;font color=&quot;ffb000&quot;&gt;r&lt;font color=&quot;228822&quot;&gt;a&lt;font color=&quot;3366ff&quot;&gt;n&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;font color=&quot;ff4422&quot;&gt;s&lt;font color=&quot;ffb000&quot;&gt;c&lt;font color=&quot;228822&quot;&gt;r&lt;font color=&quot;3366ff&quot;&gt;y&lt;font color=&quot;ffb000&quot;&gt;p&lt;font color=&quot;228822&quot;&gt;t&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;/i&gt;&lt;/b&gt;&lt;font color=&quot;777777&quot;&gt;.org&lt;font size=</span><span class="si">{}</span><span class="s1">&gt;&lt;font color=&quot;cccccc&quot;&gt;&lt;/span&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;span id=&quot;bannerSmall&quot;&gt;&lt;i&gt; Write your apps in Python for free!&lt;/i&gt;&lt;/span&gt;&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">appendChild</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">banner</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bannerLarge</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span> <span class="p">(</span><span class="s1">&#39;bannerLarge&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bannerSmall</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span> <span class="p">(</span><span class="s1">&#39;bannerSmall&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">audio</span> <span class="o">=</span> <span class="fm">__new__</span> <span class="p">(</span><span class="n">Audio</span> <span class="p">(</span><span class="s1">&#39;ios_app.mp3&#39;</span><span class="p">))</span>
        
        <span class="n">window</span><span class="o">.</span><span class="n">onresize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rightSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rightSize</span> <span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">gotoTranscryptSite</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">document</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">href</span> <span class="o">=</span> <span class="s1">&#39;http://www.transcrypt.org&#39;</span>
        
    <span class="k">def</span> <span class="nf">roll</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dice</span><span class="p">):</span>
        <span class="n">frameIndex</span> <span class="o">=</span> <span class="mi">10</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">audio</span><span class="o">.</span><span class="n">play</span> <span class="p">()</span>
        
        <span class="k">def</span> <span class="nf">frame</span> <span class="p">():</span>
            <span class="k">nonlocal</span> <span class="n">frameIndex</span>
            <span class="n">frameIndex</span> <span class="o">-=</span> <span class="mi">1</span>
            
            <span class="n">dice</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">innerHTML</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">frameIndex</span><span class="p">:</span>
                <span class="n">dice</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span> <span class="p">((</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">))</span>
                <span class="n">setTimeout</span> <span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dice</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="n">dice</span><span class="o">.</span><span class="n">normalColor</span>
                <span class="n">dice</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
                
        <span class="n">frame</span> <span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">rightSize</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">innerWidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pageHeight</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">innerHeight</span>
        <span class="n">portrait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageHeight</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span>
        
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">dice</span> <span class="ow">in</span> <span class="nb">enumerate</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dices</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageHeight</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span><span class="p">:</span>    <span class="c1"># Portrait</span>
                <span class="n">dice</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageHeight</span>
                <span class="n">dice</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span>
                <span class="n">dice</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.03</span> <span class="o">+</span> <span class="p">(</span><span class="n">index</span> <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.32</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageHeight</span>
                <span class="n">dice</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.06</span> <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="mf">0.54</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span>
                
                <span class="n">charBoxSide</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageHeight</span>
                <span class="n">dice</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="mf">0.15</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageHeight</span> <span class="o">-</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">charBoxSide</span>
                <span class="n">dice</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">charBoxSide</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">banner</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="mf">0.975</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageHeight</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">banner</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mf">0.06</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span>              
                <span class="bp">self</span><span class="o">.</span><span class="n">bannerLarge</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">fontSize</span> <span class="o">=</span> <span class="mf">0.017</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageHeight</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bannerSmall</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">fontSize</span> <span class="o">=</span> <span class="mf">0.014</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageHeight</span>
            <span class="k">else</span><span class="p">:</span>                                   <span class="c1"># Landscape</span>
                <span class="n">dice</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageHeight</span>
                <span class="n">dice</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span>
                <span class="n">dice</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.06</span> <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="mf">0.54</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageHeight</span>
                <span class="n">dice</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.03</span> <span class="o">+</span> <span class="p">(</span><span class="n">index</span> <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.32</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span>
                
                <span class="n">charBoxSide</span> <span class="o">=</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageHeight</span>
                <span class="n">dice</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageHeight</span> <span class="o">-</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">charBoxSide</span>
                <span class="n">dice</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mf">0.15</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">charBoxSide</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">banner</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="mf">0.95</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageHeight</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">banner</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="mf">0.03</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bannerLarge</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">fontSize</span> <span class="o">=</span> <span class="mf">0.015</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bannerSmall</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">fontSize</span> <span class="o">=</span> <span class="mf">0.012</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pageWidth</span>
                
            <span class="n">dice</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">charBoxSide</span>
            <span class="n">dice</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">charBoxSide</span>
            <span class="n">dice</span><span class="o">.</span><span class="n">inner</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">fontSize</span> <span class="o">=</span> <span class="n">charBoxSide</span>
            
<span class="n">dice</span> <span class="o">=</span> <span class="n">Dice</span> <span class="p">()</span>
</pre></div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="literal-block-wrapper first last docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">ios_app.html</span><a class="headerlink" href="#id10" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;html manifest=&quot;cache.manifest&quot;&gt;
    &lt;!-- v45 --&gt;
    &lt;head&gt;
        &lt;meta name=&quot;apple-mobile-web-app-capable&quot; content=&quot;yes&quot;&gt;
        &lt;meta name=&quot;apple-mobile-web-app-status-bar-style&quot; content=&quot;black&quot;&gt;
        &lt;meta name=&quot;apple-mobile-web-app-title&quot; content=&quot;Dice&quot;&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, user-scalable=no&quot;&gt;
        &lt;link rel=&quot;apple-touch-icon&quot; href=&quot;ios_app.png&quot;&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;script type=&quot;module&quot;&gt;
            import * as ios_app from &quot;./__target__/ios_app.js&quot;; window.ios_app = ios_app;
        &lt;/script&gt;
    &lt;/body&gt; 
&lt;/html&gt;
</pre></div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="literal-block-wrapper first last docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">cache.manifest</span><a class="headerlink" href="#id11" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CACHE</span> <span class="n">MANIFEST</span>

<span class="c1"># v45</span>

<span class="n">CACHE</span><span class="p">:</span>
<span class="n">ios_app</span><span class="o">.</span><span class="n">html</span>
<span class="n">ios_app</span><span class="o">.</span><span class="n">mp3</span>
<span class="n">__javascript__</span><span class="o">/</span><span class="n">ios_app</span><span class="o">.</span><span class="n">js</span>
</pre></div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>N.B.1 Cache manifests have to be served with mime type <em>text/cache-manifest</em>.</p>
<p>N.B.2 For native behaviour, e.g. no visible address bar, the app must indeed be added to the home screen of your iOS device.</p>
</div>
<div class="section" id="example-d3-js">
<h2>6.4. Example: D3.js<a class="headerlink" href="#example-d3-js" title="Permalink to this headline">¶</a></h2>
<p>The <em>D3.js</em> graphics library offers animation by data driven DOM manipulation. It combines well with class based object oriented programming as supported by Trancrypt, leading to applications that are easy to understand and maintain.</p>
<table border="1" class="docutils">
<colgroup>
<col width="46%" />
<col width="54%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="literal-block-wrapper first last docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">d3js_demo.py</span><a class="headerlink" href="#id12" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Spawn</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">d3</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">category20</span> <span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">svg</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">select</span> <span class="p">(</span><span class="s1">&#39;body&#39;</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="s1">&#39;svg&#39;</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">on</span> <span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousemove</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">on</span> <span class="p">(</span><span class="s1">&#39;mousedown&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousedown</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">svg</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="s1">&#39;rect&#39;</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svg</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="s1">&#39;circle&#39;</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="s1">&#39;translate (</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span> <span class="o">.</span><span class="n">format</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;cursor&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">force</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">force</span> <span class="p">(</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">size</span> <span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">nodes</span> <span class="p">([{}]</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">linkDistance</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">charge</span> <span class="p">(</span><span class="o">-</span><span class="mi">1000</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">on</span> <span class="p">(</span><span class="s1">&#39;tick&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tick</span><span class="p">)</span>       

        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">force</span><span class="o">.</span><span class="n">nodes</span> <span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">force</span><span class="o">.</span><span class="n">links</span> <span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">svg</span><span class="o">.</span><span class="n">selectAll</span> <span class="p">(</span><span class="s1">&#39;.node&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">svg</span><span class="o">.</span><span class="n">selectAll</span> <span class="p">(</span><span class="s1">&#39;.link&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">restart</span> <span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">mousemove</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="s1">&#39;translate (&#39;</span> <span class="o">+</span> <span class="n">d3</span><span class="o">.</span><span class="n">mouse</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">svg</span><span class="o">.</span><span class="n">node</span> <span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mousedown</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">pushLink</span> <span class="p">(</span><span class="n">target</span><span class="p">):</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">y</span>
            <span class="k">if</span> <span class="n">Math</span><span class="o">.</span><span class="n">sqrt</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">:</span>
                <span class="n">spawn</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">push</span> <span class="p">({</span><span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">node</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="n">target</span><span class="p">})</span>
                
        <span class="n">point</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">mouse</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">svg</span><span class="o">.</span><span class="n">node</span> <span class="p">())</span>
        <span class="n">node</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">point</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">point</span> <span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">push</span> <span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">forEach</span> <span class="p">(</span><span class="n">pushLink</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restart</span> <span class="p">()</span>     
            
    <span class="k">def</span> <span class="nf">tick</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">x</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;y1&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">y</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;x2&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">x</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;y2&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;cx&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">x</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;cy&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">restart</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">data</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">enter</span> <span class="p">(</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">insert</span> <span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="s1">&#39;.node&#39;</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;link&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">data</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">enter</span> <span class="p">(</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">insert</span> <span class="p">(</span><span class="s1">&#39;circle&#39;</span><span class="p">,</span> <span class="s1">&#39;.cursor&#39;</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">7</span>
        <span class="p">)</span> <span class="o">.</span><span class="n">call</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">force</span><span class="o">.</span><span class="n">drag</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">force</span><span class="o">.</span><span class="n">start</span> <span class="p">()</span>

<span class="n">spawn</span> <span class="o">=</span> <span class="n">Spawn</span> <span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">innerWidth</span><span class="p">,</span> <span class="n">window</span><span class="o">.</span><span class="n">innerHeight</span><span class="p">)</span>
</pre></div>
</div>
</div>
</td>
<td><div class="literal-block-wrapper first last docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">d3js_demo.js</span><a class="headerlink" href="#id13" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Transcrypt</span><span class="s1">&#39;ed from Python, 2019-01-22 11:21:50</span>
<span class="kn">import</span> <span class="p">{</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">BaseException</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="n">IterableError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">NotImplementedError</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">,</span> <span class="ne">StopIteration</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">Warning</span><span class="p">,</span> <span class="n">__JsIterator__</span><span class="p">,</span> <span class="n">__PyIterator__</span><span class="p">,</span> <span class="n">__Terminal__</span><span class="p">,</span> <span class="fm">__add__</span><span class="p">,</span> <span class="fm">__and__</span><span class="p">,</span> <span class="fm">__call__</span><span class="p">,</span> <span class="vm">__class__</span><span class="p">,</span> <span class="n">__envir__</span><span class="p">,</span> <span class="fm">__eq__</span><span class="p">,</span> <span class="fm">__floordiv__</span><span class="p">,</span> <span class="fm">__ge__</span><span class="p">,</span> <span class="fm">__get__</span><span class="p">,</span> <span class="n">__getcm__</span><span class="p">,</span> <span class="fm">__getitem__</span><span class="p">,</span> <span class="n">__getslice__</span><span class="p">,</span> <span class="n">__getsm__</span><span class="p">,</span> <span class="fm">__gt__</span><span class="p">,</span> <span class="n">__i__</span><span class="p">,</span> <span class="fm">__iadd__</span><span class="p">,</span> <span class="fm">__iand__</span><span class="p">,</span> <span class="n">__idiv__</span><span class="p">,</span> <span class="n">__ijsmod__</span><span class="p">,</span> <span class="fm">__ilshift__</span><span class="p">,</span> <span class="fm">__imatmul__</span><span class="p">,</span> <span class="fm">__imod__</span><span class="p">,</span> <span class="fm">__imul__</span><span class="p">,</span> <span class="n">__in__</span><span class="p">,</span> <span class="fm">__init__</span><span class="p">,</span> <span class="fm">__ior__</span><span class="p">,</span> <span class="fm">__ipow__</span><span class="p">,</span> <span class="fm">__irshift__</span><span class="p">,</span> <span class="fm">__isub__</span><span class="p">,</span> <span class="fm">__ixor__</span><span class="p">,</span> <span class="n">__jsUsePyNext__</span><span class="p">,</span> <span class="n">__jsmod__</span><span class="p">,</span> <span class="n">__k__</span><span class="p">,</span> <span class="n">__kwargtrans__</span><span class="p">,</span> <span class="fm">__le__</span><span class="p">,</span> <span class="fm">__lshift__</span><span class="p">,</span> <span class="fm">__lt__</span><span class="p">,</span> <span class="fm">__matmul__</span><span class="p">,</span> <span class="n">__mergefields__</span><span class="p">,</span> <span class="n">__mergekwargtrans__</span><span class="p">,</span> <span class="fm">__mod__</span><span class="p">,</span> <span class="fm">__mul__</span><span class="p">,</span> <span class="fm">__ne__</span><span class="p">,</span> <span class="fm">__neg__</span><span class="p">,</span> <span class="n">__nest__</span><span class="p">,</span> <span class="fm">__or__</span><span class="p">,</span> <span class="fm">__pow__</span><span class="p">,</span> <span class="n">__pragma__</span><span class="p">,</span> <span class="n">__proxy__</span><span class="p">,</span> <span class="n">__pyUseJsNext__</span><span class="p">,</span> <span class="fm">__rshift__</span><span class="p">,</span> <span class="fm">__setitem__</span><span class="p">,</span> <span class="n">__setproperty__</span><span class="p">,</span> <span class="n">__setslice__</span><span class="p">,</span> <span class="n">__sort__</span><span class="p">,</span> <span class="n">__specialattrib__</span><span class="p">,</span> <span class="fm">__sub__</span><span class="p">,</span> <span class="n">__super__</span><span class="p">,</span> <span class="n">__t__</span><span class="p">,</span> <span class="n">__terminal__</span><span class="p">,</span> <span class="fm">__truediv__</span><span class="p">,</span> <span class="n">__withblock__</span><span class="p">,</span> <span class="fm">__xor__</span><span class="p">,</span> <span class="nb">abs</span><span class="p">,</span> <span class="nb">all</span><span class="p">,</span> <span class="nb">any</span><span class="p">,</span> <span class="k">assert</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">callable</span><span class="p">,</span> <span class="nb">chr</span><span class="p">,</span> <span class="n">copy</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">,</span> <span class="nb">delattr</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="nb">divmod</span><span class="p">,</span> <span class="nb">enumerate</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">,</span> <span class="nb">hasattr</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">isinstance</span><span class="p">,</span> <span class="nb">issubclass</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">map</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="nb">ord</span><span class="p">,</span> <span class="nb">pow</span><span class="p">,</span> <span class="nb">print</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">py_TypeError</span><span class="p">,</span> <span class="n">py_iter</span><span class="p">,</span> <span class="n">py_metatype</span><span class="p">,</span> <span class="n">py_next</span><span class="p">,</span> <span class="n">py_reversed</span><span class="p">,</span> <span class="n">py_typeof</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="nb">repr</span><span class="p">,</span> <span class="nb">round</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">setattr</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">sum</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">zip</span><span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;./org.transcrypt.__runtime__.js&#39;</span><span class="p">;</span>
<span class="n">var</span> <span class="vm">__name__</span> <span class="o">=</span> <span class="s1">&#39;__main__&#39;</span><span class="p">;</span>
<span class="n">export</span> <span class="n">var</span> <span class="n">Spawn</span> <span class="o">=</span>  <span class="vm">__class__</span> <span class="p">(</span><span class="s1">&#39;Spawn&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nb">object</span><span class="p">],</span> <span class="p">{</span>
    <span class="vm">__module__</span><span class="p">:</span> <span class="vm">__name__</span><span class="p">,</span>
    <span class="n">get</span> <span class="fm">__init__</span> <span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="fm">__get__</span> <span class="p">(</span><span class="n">this</span><span class="p">,</span> <span class="n">function</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">var</span> <span class="n">__left0__</span> <span class="o">=</span> <span class="nb">tuple</span> <span class="p">([</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">d3</span><span class="o">.</span><span class="n">scale</span><span class="o">.</span><span class="n">category20</span> <span class="p">()]);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">__left0__</span> <span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">__left0__</span> <span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="n">__left0__</span> <span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">__left0__</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">svg</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">select</span> <span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span><span class="o">.</span><span class="n">on</span> <span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousemove</span><span class="p">)</span><span class="o">.</span><span class="n">on</span> <span class="p">(</span><span class="s1">&#39;mousedown&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousedown</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">svg</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="s1">&#39;rect&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svg</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="s1">&#39;circle&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="s1">&#39;translate (</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;cursor&#39;</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">force</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">force</span> <span class="p">()</span><span class="o">.</span><span class="n">size</span> <span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">])</span><span class="o">.</span><span class="n">nodes</span> <span class="p">([</span><span class="nb">dict</span> <span class="p">({})])</span><span class="o">.</span><span class="n">linkDistance</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span><span class="o">.</span><span class="n">charge</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span><span class="o">.</span><span class="n">on</span> <span class="p">(</span><span class="s1">&#39;tick&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tick</span><span class="p">);</span>
        <span class="n">var</span> <span class="n">__left0__</span> <span class="o">=</span> <span class="nb">tuple</span> <span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">force</span><span class="o">.</span><span class="n">nodes</span> <span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">force</span><span class="o">.</span><span class="n">links</span> <span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">svg</span><span class="o">.</span><span class="n">selectAll</span> <span class="p">(</span><span class="s1">&#39;.node&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">svg</span><span class="o">.</span><span class="n">selectAll</span> <span class="p">(</span><span class="s1">&#39;.link&#39;</span><span class="p">)]);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">__left0__</span> <span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">links</span> <span class="o">=</span> <span class="n">__left0__</span> <span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">__left0__</span> <span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">__left0__</span> <span class="p">[</span><span class="mi">3</span><span class="p">];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restart</span> <span class="p">();</span>
    <span class="p">});},</span>
    <span class="n">get</span> <span class="n">mousemove</span> <span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="fm">__get__</span> <span class="p">(</span><span class="n">this</span><span class="p">,</span> <span class="n">function</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;translate (&#39;</span> <span class="o">+</span> <span class="n">d3</span><span class="o">.</span><span class="n">mouse</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">svg</span><span class="o">.</span><span class="n">node</span> <span class="p">()))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">);</span>
    <span class="p">});},</span>
    <span class="n">get</span> <span class="n">mousedown</span> <span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="fm">__get__</span> <span class="p">(</span><span class="n">this</span><span class="p">,</span> <span class="n">function</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">var</span> <span class="n">pushLink</span> <span class="o">=</span> <span class="n">function</span> <span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">var</span> <span class="n">__left0__</span> <span class="o">=</span> <span class="nb">tuple</span> <span class="p">([</span><span class="n">target</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">node</span><span class="o">.</span><span class="n">y</span><span class="p">]);</span>
            <span class="n">var</span> <span class="n">x</span> <span class="o">=</span> <span class="n">__left0__</span> <span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="n">var</span> <span class="n">y</span> <span class="o">=</span> <span class="n">__left0__</span> <span class="p">[</span><span class="mi">1</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">Math</span><span class="o">.</span><span class="n">sqrt</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacing</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">spawn</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">push</span> <span class="p">(</span><span class="nb">dict</span> <span class="p">({</span><span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">node</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="n">target</span><span class="p">}));</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="n">var</span> <span class="n">point</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">mouse</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">svg</span><span class="o">.</span><span class="n">node</span> <span class="p">());</span>
        <span class="n">var</span> <span class="n">node</span> <span class="o">=</span> <span class="nb">dict</span> <span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">point</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">point</span> <span class="p">[</span><span class="mi">1</span><span class="p">]});</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">push</span> <span class="p">(</span><span class="n">node</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">forEach</span> <span class="p">(</span><span class="n">pushLink</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restart</span> <span class="p">();</span>
    <span class="p">});},</span>
    <span class="n">get</span> <span class="n">tick</span> <span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="fm">__get__</span> <span class="p">(</span><span class="n">this</span><span class="p">,</span> <span class="n">function</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">function</span> <span class="n">__lambda__</span> <span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">x</span><span class="p">;</span>
        <span class="p">}))</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;y1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">function</span> <span class="n">__lambda__</span> <span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">y</span><span class="p">;</span>
        <span class="p">}))</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;x2&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">function</span> <span class="n">__lambda__</span> <span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">x</span><span class="p">;</span>
        <span class="p">}))</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;y2&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">function</span> <span class="n">__lambda__</span> <span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">y</span><span class="p">;</span>
        <span class="p">}));</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;cx&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">function</span> <span class="n">__lambda__</span> <span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">x</span><span class="p">;</span>
        <span class="p">}))</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;cy&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">function</span> <span class="n">__lambda__</span> <span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">y</span><span class="p">;</span>
        <span class="p">}));</span>
    <span class="p">});},</span>
    <span class="n">get</span> <span class="n">restart</span> <span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="fm">__get__</span> <span class="p">(</span><span class="n">this</span><span class="p">,</span> <span class="n">function</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">data</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">enter</span> <span class="p">()</span><span class="o">.</span><span class="n">insert</span> <span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="s1">&#39;.node&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;link&#39;</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">data</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">enter</span> <span class="p">()</span><span class="o">.</span><span class="n">insert</span> <span class="p">(</span><span class="s1">&#39;circle&#39;</span><span class="p">,</span> <span class="s1">&#39;.cursor&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">attr</span> <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">call</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">force</span><span class="o">.</span><span class="n">drag</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">force</span><span class="o">.</span><span class="n">start</span> <span class="p">();</span>
    <span class="p">});}</span>
<span class="p">});</span>
<span class="n">export</span> <span class="n">var</span> <span class="n">spawn</span> <span class="o">=</span> <span class="n">Spawn</span> <span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">innerWidth</span><span class="p">,</span> <span class="n">window</span><span class="o">.</span><span class="n">innerHeight</span><span class="p">);</span>

<span class="o">//</span><span class="c1"># sourceMappingURL=d3js_demo.map</span>
</pre></div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="example-react">
<h2>6.5. Example: React<a class="headerlink" href="#example-react" title="Permalink to this headline">¶</a></h2>
<p><em>React</em> is a JavaScript library for easy creation of interactive UI’s. Changes to the UI are made by fast manipulation of a light-weight virtual DOM. The real DOM, which is much slower to manipulate, is then compared with the altered virtual DOM and updated efficiently in a minimum number of steps. This way of working leads to good performance, at the same time keeping a straightforward structure of application UI code, since the complexities of optimizing DOM updates are left to the React library. React is unintrusive and mixes well with Transcrypt, allowing creation of extensive web applications that combine maintainability with speed. This example once again clearly illustrates the philosophy behind Transcrypt: rather than confining you to a “parallel” universe that could never keep up, Transcrypt offers you direct access to the ever expanding universe of innovative JavaScript libraries.</p>
<table border="1" class="docutils">
<colgroup>
<col width="46%" />
<col width="54%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="literal-block-wrapper first last docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">react_demo.py</span><a class="headerlink" href="#id14" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Helper functions</span>


<span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="n">elm_type</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">React</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="n">elm_type</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">react_element</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">container</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="n">destination_id</span><span class="p">)</span>
    <span class="n">ReactDOM</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">react_element</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>


<span class="c1"># Create a component</span>


<span class="n">Hello</span> <span class="o">=</span> <span class="n">React</span><span class="o">.</span><span class="n">createClass</span><span class="p">({</span>
    <span class="s1">&#39;displayName&#39;</span><span class="p">:</span> <span class="s1">&#39;Hello&#39;</span><span class="p">,</span>

    <span class="s1">&#39;getInitialState&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>

    <span class="s1">&#39;updateCounter&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">setState</span><span class="p">({</span><span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="n">this</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;counter&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">})),</span>

    <span class="s1">&#39;componentDidMount&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">(</span><span class="n">setInterval</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">updateCounter</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)),</span>

    <span class="s1">&#39;render&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">h</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;className&#39;</span><span class="p">:</span> <span class="s1">&#39;maindiv&#39;</span><span class="p">},</span>
                          <span class="n">h</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Hello &#39;</span><span class="p">,</span> <span class="n">this</span><span class="o">.</span><span class="n">props</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]),</span>
                          <span class="n">h</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Lorem ipsum dolor sit ame.&#39;</span><span class="p">),</span>
                          <span class="n">h</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Counter: &#39;</span><span class="p">,</span> <span class="n">this</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s1">&#39;counter&#39;</span><span class="p">])</span>
                        <span class="p">)</span>
<span class="p">})</span>


<span class="c1"># Render the component in a &#39;container&#39; div</span>

<span class="n">element</span> <span class="o">=</span> <span class="n">React</span><span class="o">.</span><span class="n">createElement</span><span class="p">(</span><span class="n">Hello</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;React!&#39;</span><span class="p">})</span>
<span class="n">render</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="s1">&#39;container&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</td>
<td><div class="literal-block-wrapper first last docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">react_demo.js</span><a class="headerlink" href="#id15" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Transcrypt</span><span class="s1">&#39;ed from Python, 2019-01-22 11:21:54</span>
<span class="kn">import</span> <span class="p">{</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">BaseException</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="n">IterableError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">NotImplementedError</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">,</span> <span class="ne">StopIteration</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">Warning</span><span class="p">,</span> <span class="n">__JsIterator__</span><span class="p">,</span> <span class="n">__PyIterator__</span><span class="p">,</span> <span class="n">__Terminal__</span><span class="p">,</span> <span class="fm">__add__</span><span class="p">,</span> <span class="fm">__and__</span><span class="p">,</span> <span class="fm">__call__</span><span class="p">,</span> <span class="vm">__class__</span><span class="p">,</span> <span class="n">__envir__</span><span class="p">,</span> <span class="fm">__eq__</span><span class="p">,</span> <span class="fm">__floordiv__</span><span class="p">,</span> <span class="fm">__ge__</span><span class="p">,</span> <span class="fm">__get__</span><span class="p">,</span> <span class="n">__getcm__</span><span class="p">,</span> <span class="fm">__getitem__</span><span class="p">,</span> <span class="n">__getslice__</span><span class="p">,</span> <span class="n">__getsm__</span><span class="p">,</span> <span class="fm">__gt__</span><span class="p">,</span> <span class="n">__i__</span><span class="p">,</span> <span class="fm">__iadd__</span><span class="p">,</span> <span class="fm">__iand__</span><span class="p">,</span> <span class="n">__idiv__</span><span class="p">,</span> <span class="n">__ijsmod__</span><span class="p">,</span> <span class="fm">__ilshift__</span><span class="p">,</span> <span class="fm">__imatmul__</span><span class="p">,</span> <span class="fm">__imod__</span><span class="p">,</span> <span class="fm">__imul__</span><span class="p">,</span> <span class="n">__in__</span><span class="p">,</span> <span class="fm">__init__</span><span class="p">,</span> <span class="fm">__ior__</span><span class="p">,</span> <span class="fm">__ipow__</span><span class="p">,</span> <span class="fm">__irshift__</span><span class="p">,</span> <span class="fm">__isub__</span><span class="p">,</span> <span class="fm">__ixor__</span><span class="p">,</span> <span class="n">__jsUsePyNext__</span><span class="p">,</span> <span class="n">__jsmod__</span><span class="p">,</span> <span class="n">__k__</span><span class="p">,</span> <span class="n">__kwargtrans__</span><span class="p">,</span> <span class="fm">__le__</span><span class="p">,</span> <span class="fm">__lshift__</span><span class="p">,</span> <span class="fm">__lt__</span><span class="p">,</span> <span class="fm">__matmul__</span><span class="p">,</span> <span class="n">__mergefields__</span><span class="p">,</span> <span class="n">__mergekwargtrans__</span><span class="p">,</span> <span class="fm">__mod__</span><span class="p">,</span> <span class="fm">__mul__</span><span class="p">,</span> <span class="fm">__ne__</span><span class="p">,</span> <span class="fm">__neg__</span><span class="p">,</span> <span class="n">__nest__</span><span class="p">,</span> <span class="fm">__or__</span><span class="p">,</span> <span class="fm">__pow__</span><span class="p">,</span> <span class="n">__pragma__</span><span class="p">,</span> <span class="n">__proxy__</span><span class="p">,</span> <span class="n">__pyUseJsNext__</span><span class="p">,</span> <span class="fm">__rshift__</span><span class="p">,</span> <span class="fm">__setitem__</span><span class="p">,</span> <span class="n">__setproperty__</span><span class="p">,</span> <span class="n">__setslice__</span><span class="p">,</span> <span class="n">__sort__</span><span class="p">,</span> <span class="n">__specialattrib__</span><span class="p">,</span> <span class="fm">__sub__</span><span class="p">,</span> <span class="n">__super__</span><span class="p">,</span> <span class="n">__t__</span><span class="p">,</span> <span class="n">__terminal__</span><span class="p">,</span> <span class="fm">__truediv__</span><span class="p">,</span> <span class="n">__withblock__</span><span class="p">,</span> <span class="fm">__xor__</span><span class="p">,</span> <span class="nb">abs</span><span class="p">,</span> <span class="nb">all</span><span class="p">,</span> <span class="nb">any</span><span class="p">,</span> <span class="k">assert</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">callable</span><span class="p">,</span> <span class="nb">chr</span><span class="p">,</span> <span class="n">copy</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">,</span> <span class="nb">delattr</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="nb">divmod</span><span class="p">,</span> <span class="nb">enumerate</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">,</span> <span class="nb">hasattr</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">isinstance</span><span class="p">,</span> <span class="nb">issubclass</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">map</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="nb">ord</span><span class="p">,</span> <span class="nb">pow</span><span class="p">,</span> <span class="nb">print</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">py_TypeError</span><span class="p">,</span> <span class="n">py_iter</span><span class="p">,</span> <span class="n">py_metatype</span><span class="p">,</span> <span class="n">py_next</span><span class="p">,</span> <span class="n">py_reversed</span><span class="p">,</span> <span class="n">py_typeof</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="nb">repr</span><span class="p">,</span> <span class="nb">round</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">setattr</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">sum</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">zip</span><span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;./org.transcrypt.__runtime__.js&#39;</span><span class="p">;</span>
<span class="n">var</span> <span class="vm">__name__</span> <span class="o">=</span> <span class="s1">&#39;__main__&#39;</span><span class="p">;</span>
<span class="n">export</span> <span class="n">var</span> <span class="n">h</span> <span class="o">=</span> <span class="n">function</span> <span class="p">(</span><span class="n">elm_type</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">typeof</span> <span class="n">props</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">||</span> <span class="p">(</span><span class="n">props</span> <span class="o">!=</span> <span class="n">null</span> <span class="o">&amp;&amp;</span> <span class="n">props</span><span class="o">.</span><span class="n">hasOwnProperty</span> <span class="p">(</span><span class="s2">&quot;__kwargtrans__&quot;</span><span class="p">)))</span> <span class="p">{;</span>
        <span class="n">var</span> <span class="n">props</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="n">var</span> <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span> <span class="p">([]</span><span class="o">.</span><span class="n">slice</span><span class="o">.</span><span class="n">apply</span> <span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="o">.</span><span class="n">slice</span> <span class="p">(</span><span class="mi">2</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">React</span><span class="o">.</span><span class="n">createElement</span> <span class="p">(</span><span class="n">elm_type</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="o">...</span><span class="n">args</span><span class="p">);</span>
<span class="p">};</span>
<span class="n">export</span> <span class="n">var</span> <span class="n">render</span> <span class="o">=</span> <span class="n">function</span> <span class="p">(</span><span class="n">react_element</span><span class="p">,</span> <span class="n">destination_id</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">typeof</span> <span class="n">callback</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">||</span> <span class="p">(</span><span class="n">callback</span> <span class="o">!=</span> <span class="n">null</span> <span class="o">&amp;&amp;</span> <span class="n">callback</span><span class="o">.</span><span class="n">hasOwnProperty</span> <span class="p">(</span><span class="s2">&quot;__kwargtrans__&quot;</span><span class="p">)))</span> <span class="p">{;</span>
        <span class="n">var</span> <span class="n">callback</span> <span class="o">=</span> <span class="p">(</span><span class="n">function</span> <span class="n">__lambda__</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">null</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">};</span>
    <span class="n">var</span> <span class="n">container</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">getElementById</span> <span class="p">(</span><span class="n">destination_id</span><span class="p">);</span>
    <span class="n">ReactDOM</span><span class="o">.</span><span class="n">render</span> <span class="p">(</span><span class="n">react_element</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">callback</span><span class="p">);</span>
<span class="p">};</span>
<span class="n">export</span> <span class="n">var</span> <span class="n">Hello</span> <span class="o">=</span> <span class="n">React</span><span class="o">.</span><span class="n">createClass</span> <span class="p">(</span><span class="nb">dict</span> <span class="p">({</span><span class="s1">&#39;displayName&#39;</span><span class="p">:</span> <span class="s1">&#39;Hello&#39;</span><span class="p">,</span> <span class="s1">&#39;getInitialState&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">function</span> <span class="n">__lambda__</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">dict</span> <span class="p">({</span><span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">});</span>
<span class="p">}),</span> <span class="s1">&#39;updateCounter&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">function</span> <span class="n">__lambda__</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">this</span><span class="o">.</span><span class="n">setState</span> <span class="p">(</span><span class="nb">dict</span> <span class="p">({</span><span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="n">this</span><span class="o">.</span><span class="n">state</span> <span class="p">[</span><span class="s1">&#39;counter&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}));</span>
<span class="p">}),</span> <span class="s1">&#39;componentDidMount&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">function</span> <span class="n">__lambda__</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">setInterval</span> <span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">updateCounter</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">}),</span> <span class="s1">&#39;render&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">function</span> <span class="n">__lambda__</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">h</span> <span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="nb">dict</span> <span class="p">({</span><span class="s1">&#39;className&#39;</span><span class="p">:</span> <span class="s1">&#39;maindiv&#39;</span><span class="p">}),</span> <span class="n">h</span> <span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="s1">&#39;Hello &#39;</span><span class="p">,</span> <span class="n">this</span><span class="o">.</span><span class="n">props</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]),</span> <span class="n">h</span> <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="s1">&#39;Lorem ipsum dolor sit ame.&#39;</span><span class="p">),</span> <span class="n">h</span> <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="s1">&#39;Counter: &#39;</span><span class="p">,</span> <span class="n">this</span><span class="o">.</span><span class="n">state</span> <span class="p">[</span><span class="s1">&#39;counter&#39;</span><span class="p">]));</span>
<span class="p">})}));</span>
<span class="n">export</span> <span class="n">var</span> <span class="n">element</span> <span class="o">=</span> <span class="n">React</span><span class="o">.</span><span class="n">createElement</span> <span class="p">(</span><span class="n">Hello</span><span class="p">,</span> <span class="nb">dict</span> <span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;React!&#39;</span><span class="p">}));</span>
<span class="n">render</span> <span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="s1">&#39;container&#39;</span><span class="p">);</span>

<span class="o">//</span><span class="c1"># sourceMappingURL=react_demo.map</span>
</pre></div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="example-riot">
<h2>6.6. Example: Riot<a class="headerlink" href="#example-riot" title="Permalink to this headline">¶</a></h2>
<p><em>Riot</em> is a UI framework that combines the use of custom tags and a virtual DOM, much like the one in React. Custom tags look like ordinary HTML tags, but whereas HTML tags only define structure, Riot tags define structure, style and behaviour. Custom tags are compiled to JavaScript by a compiler that comes with Riot. With these custom tags as reusable components, web pages can be built. Riot itself is tiny, and the virtual DOM allows for fast adaptation of page content.</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="literal-block-wrapper first last docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">riot_demo.html</span><a class="headerlink" href="#id16" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!DOCTYPE html&gt;
&lt;html&gt;

  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;title&gt;Hello PyRiot ;-)&lt;/title&gt;
    &lt;!-- for transcrypted version we do not need the compiler.
         for the classic version you can use riot+compiler --&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/riot/2.5/riot.js&quot;&gt;&lt;/script&gt;
    &lt;style&gt;
        body {font-family:arial;font-size:30px;padding:50px;}
        h1 {font-size:50px;color:#0000ff;}
    &lt;/style&gt;
  &lt;/head&gt;

  &lt;body&gt;

  &lt;!-- classic riot (compiled on server, could be done in browser)         --&gt;
        &lt;sample id=&quot;s1&quot;&gt;&lt;/sample&gt;
        &lt;script src=&quot;tags/sample.js&quot;&gt;&lt;/script&gt;
        &lt;script&gt;riot.mount(&#39;sample&#39;)&lt;/script&gt;


  &lt;!-- transcrypted version (transpiled on server, using python)           --&gt;
        &lt;sample2 id=&#39;s2&#39; label=&quot;nr1&quot;&gt;&lt;/sample2&gt;
        &lt;mp2     id=&#39;s3&#39; label=&quot;nr2&quot;&gt;&lt;/mp2&gt;
        &lt;!-- the transpiled tag&#39;s js --&gt;
        &lt;script type=&quot;module&quot;&gt;
            import * as riot_demo from &quot;./__target__/riot_demo.js&quot;

            // register
            var cls = riot_demo.Sample2
            riot.tag2(&#39;sample2&#39;, cls.template, cls.style, &#39;&#39;, function(opts) {
                new cls(this, opts)})
            document.t1 = riot.mount(&#39;sample2&#39;)[0].update()
            document.t2 = riot.mount(&#39;#s3&#39;, &#39;sample2&#39;)[0]
            document.t2.update()
        &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="literal-block-wrapper first last docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">sample.tag, a classic Riot tag</span><a class="headerlink" href="#id17" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">vim</span><span class="p">:</span> <span class="n">ft</span><span class="o">=</span><span class="n">html</span>
<span class="o">&lt;</span><span class="n">sample</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Riot</span> <span class="n">Native</span> <span class="n">Tag</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">h5</span> <span class="n">each</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{lv}</span><span class="s2">&quot;</span><span class="o">&gt;</span><span class="n">name</span><span class="p">:</span> <span class="p">{</span><span class="n">name</span><span class="p">}</span> <span class="o">-</span> <span class="n">counter</span><span class="p">:</span> <span class="p">{</span><span class="n">this</span><span class="o">.</span><span class="n">count</span><span class="p">()}</span><span class="o">&lt;/</span><span class="n">h5</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
        <span class="n">this</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="o">//</span> <span class="n">riot</span><span class="s1">&#39;s synctactic sugar:</span>
        <span class="n">count</span><span class="p">()</span> <span class="p">{</span> <span class="n">this</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">return</span> <span class="n">this</span><span class="o">.</span><span class="n">counter</span> <span class="p">}</span>

        <span class="o">//</span> <span class="n">to</span> <span class="n">test</span> <span class="n">stuff</span> <span class="n">on</span> <span class="n">console</span><span class="p">:</span>
        <span class="n">window</span><span class="o">.</span><span class="n">native_tag</span> <span class="o">=</span> <span class="n">this</span>

        <span class="n">this</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">this</span><span class="o">.</span><span class="n">lv</span> <span class="o">=</span> <span class="p">[{</span><span class="n">name</span><span class="p">:</span> <span class="s1">&#39;n1&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;n2&#39;</span><span class="p">}]</span>
            <span class="n">this</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="p">})</span>
    <span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">style</span> <span class="n">scoped</span><span class="o">&gt;</span>
    <span class="n">h1</span> <span class="p">{</span><span class="n">color</span><span class="p">:</span> <span class="n">red</span><span class="p">}</span>
    <span class="o">&lt;/</span><span class="n">style</span><span class="o">&gt;</span>

<span class="o">&lt;/</span><span class="n">sample</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</td>
<td><div class="literal-block-wrapper first last docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">sample.js, compiled by Riot</span><a class="headerlink" href="#id18" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">vim</span><span class="p">:</span> <span class="n">ft</span><span class="o">=</span><span class="n">html</span>
<span class="n">riot</span><span class="o">.</span><span class="n">tag2</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;h1&gt;Riot Native Tag&lt;/h1&gt; &lt;h5 each=&quot;</span><span class="si">{lv}</span><span class="s1">&quot;&gt;name: </span><span class="si">{name}</span><span class="s1"> - counter: {this.count()}&lt;/h5&gt;&#39;</span><span class="p">,</span> 
<span class="s1">&#39;sample h1,[riot-tag=&quot;sample&quot;] h1,[data-is=&quot;sample&quot;] h1{color: red}&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">this</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span> <span class="n">this</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">return</span> <span class="n">this</span><span class="o">.</span><span class="n">counter</span> <span class="p">}</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">this</span><span class="p">)</span>

        <span class="n">window</span><span class="o">.</span><span class="n">native_tag</span> <span class="o">=</span> <span class="n">this</span>

        <span class="n">this</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">this</span><span class="o">.</span><span class="n">lv</span> <span class="o">=</span> <span class="p">[{</span><span class="n">name</span><span class="p">:</span> <span class="s1">&#39;n1&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;n2&#39;</span><span class="p">}]</span>
            <span class="n">this</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="p">})</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="literal-block-wrapper first last docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">riot_tag.py, baseclass of all Transcrypt Riot tags</span><a class="headerlink" href="#id19" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parent Class for a Transcrypt Riot Tag</span>
<span class="c1">#</span>
<span class="c1"># This binds the namespace of a riot tag at before-mount event 100% to that of</span>
<span class="c1"># the a transcrypt instance, except members which begin with an underscore, those</span>
<span class="c1"># are private to the transcrypt object.</span>
<span class="c1">#</span>
<span class="c1"># The 4 riot lifecycle events are bound to overwritable python functions.</span>
<span class="c1">#</span>
<span class="c1"># Immutables (strings, ints, ...) are bound to property functions within the tag,</span>
<span class="c1"># so the templates work, based on state in the transcrypt tag.</span>
<span class="c1"># State can be changed in the riot tag as well but take care to not create new</span>
<span class="c1"># references - you won&#39;t find them in the Transcrypt tag.</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># Best Practices:</span>
<span class="c1">#  - mutate state only in the transcrypt tag.</span>
<span class="c1">#  - declare all variables so they are bound into the riot tag</span>
<span class="c1">#  - IF you declare new variables to be used in templates, run</span>
<span class="c1">#    self.bind_vars(self.riot_tag)</span>
<span class="c1"># TODO: docstring format not accepted by the transpiler, strange.</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Gunther Klessinger, gk@axiros.com, Germany&quot;</span>

<span class="c1"># just a minihack to get some colors, mainly to test lamdas and imports:</span>
<span class="kn">from</span> <span class="nn">color</span> <span class="k">import</span> <span class="n">colors</span><span class="p">,</span> <span class="n">cprint</span> <span class="k">as</span> <span class="n">col_print</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">colors</span>
<span class="n">M</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;purple&#39;</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;orange&#39;</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;gray&#39;</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">]</span>

<span class="n">lifecycle_ev</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;before-mount&#39;</span><span class="p">,</span> <span class="s1">&#39;mount&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;unmount&#39;</span><span class="p">]</span>

<span class="n">cur_tag_col</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">class</span> <span class="nc">RiotTag</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    taking care for extending the riot tag obj with</span>
<span class="sd">    functions and immutable(!) properties of derivations of us</span>
<span class="sd">    See counter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># placeholders:</span>
    <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;&lt;h1&gt;it worx&lt;/h1&gt;&#39;</span>
    <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">node_name</span> <span class="o">=</span> <span class="s1">&#39;unmounted&#39;</span>
    <span class="n">opts</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">opts</span><span class="p">):</span>
        <span class="c1"># opts into the python instance, why not:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opts</span> <span class="o">=</span> <span class="n">opts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="c1"># giving ourselves a unique color:</span>
        <span class="k">global</span> <span class="n">cur_tag_col</span> <span class="c1"># working (!)</span>
        <span class="n">cur_tag_col</span> <span class="o">=</span> <span class="p">(</span><span class="n">cur_tag_col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
        <span class="c1"># TODO values() on a dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_col</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">items</span><span class="p">()[</span><span class="n">cur_tag_col</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_setup_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
        <span class="c1"># keeping mutual refs</span>
        <span class="n">tag</span><span class="o">.</span><span class="n">py_obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">riot_tag</span> <span class="o">=</span> <span class="n">tag</span>
        <span class="c1"># making the event system call self&#39;s methods:</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ev</span> <span class="ow">in</span> <span class="n">lifecycle_ev</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
                <span class="c1"># this.on(&#39;mount&#39;, function() {...}):</span>
                <span class="c1"># whats nicer?</span>
                <span class="n">tag</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">ev</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">msg</span><span class="p">):</span>
        <span class="c1"># color flash in the console. one color per tag instance.</span>
        <span class="n">col_print</span><span class="p">(</span>
            <span class="c1">#B(self.riot_tag._riot_id),</span>
            <span class="n">L</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_col</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_col</span><span class="p">),</span> <span class="s1">&#39;/&gt; &#39;</span><span class="p">),</span>
            <span class="n">M</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">])))</span>

    <span class="k">def</span> <span class="nf">_lifecycle_ev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">(</span><span class="n">mode</span> <span class="o">+</span> <span class="s1">&#39;ing&#39;</span><span class="p">)</span>

    <span class="c1"># overwrite these for your specific one:</span>
    <span class="k">def</span> <span class="nf">update</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lifecycle_ev</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">mount</span>  <span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lifecycle_ev</span><span class="p">(</span><span class="s1">&#39;mount&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unmount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lifecycle_ev</span><span class="p">(</span><span class="s1">&#39;unmount&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">before_mount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lifecycle_ev</span><span class="p">(</span><span class="s1">&#39;before-mount&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bind_vars</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">bind_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">riot_tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">nodeName</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">(</span><span class="s1">&#39;binding vars&#39;</span><span class="p">)</span>
        <span class="c1"># binding self&#39;s functions into the tag instance</span>
        <span class="c1"># binding writable properties to everything else (e.g. ints, strs...)</span>
        <span class="n">tag</span><span class="o">.</span><span class="n">_immutables</span> <span class="o">=</span> <span class="n">im</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lc</span> <span class="o">=</span> <span class="n">lifecycle_ev</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># private or lifecycle function? don&#39;t bind:</span>
            <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span> <span class="ow">or</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lifecycle_ev</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;before_mount&#39;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="c1"># these I can&#39;t write in python. Lets use JS then.</span>
            <span class="c1"># TODO there should be, maybe some mocking facility for code</span>
            <span class="c1"># testing w/o a js runtime:</span>
            <span class="n">__pragma__</span><span class="p">(</span><span class="s1">&#39;js&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                  typeof v === &quot;function&quot; || typeof v === &quot;object&quot; ?</span>
<span class="s1">                  tag[k] = self[k] : tag._immutables.push(k)&#39;&#39;&#39;</span><span class="p">)</span>

        <span class="n">__pragma__</span><span class="p">(</span><span class="s1">&#39;js&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        var i = tag._immutables, py = self</span>
<span class="s1">        i.forEach(function(k, j, i) {</span>
<span class="s1">            Object.defineProperty(tag, k, {</span>
<span class="s1">                get: function()  { return self[k]},</span>
<span class="s1">                set: function(v) { self[k] = v }</span>
<span class="s1">            })</span>
<span class="s1">        })&#39;&#39;&#39;</span><span class="p">)</span>

</pre></div>
</div>
</div>
</td>
<td><div class="literal-block-wrapper first last docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">riot_tag.js, compiled by Transcrypt</span><a class="headerlink" href="#id20" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// Transcrypt&#39;ed from Python, 2019-01-22 11:21:56
import {AssertionError, AttributeError, BaseException, DeprecationWarning, Exception, IndexError, IterableError, KeyError, NotImplementedError, RuntimeWarning, StopIteration, UserWarning, ValueError, Warning, __JsIterator__, __PyIterator__, __Terminal__, __add__, __and__, __call__, __class__, __envir__, __eq__, __floordiv__, __ge__, __get__, __getcm__, __getitem__, __getslice__, __getsm__, __gt__, __i__, __iadd__, __iand__, __idiv__, __ijsmod__, __ilshift__, __imatmul__, __imod__, __imul__, __in__, __init__, __ior__, __ipow__, __irshift__, __isub__, __ixor__, __jsUsePyNext__, __jsmod__, __k__, __kwargtrans__, __le__, __lshift__, __lt__, __matmul__, __mergefields__, __mergekwargtrans__, __mod__, __mul__, __ne__, __neg__, __nest__, __or__, __pow__, __pragma__, __proxy__, __pyUseJsNext__, __rshift__, __setitem__, __setproperty__, __setslice__, __sort__, __specialattrib__, __sub__, __super__, __t__, __terminal__, __truediv__, __withblock__, __xor__, abs, all, any, assert, bool, bytearray, bytes, callable, chr, copy, deepcopy, delattr, dict, dir, divmod, enumerate, filter, float, format, getattr, hasattr, input, int, isinstance, issubclass, len, list, map, max, min, object, ord, pow, print, property, py_TypeError, py_iter, py_metatype, py_next, py_reversed, py_typeof, range, repr, round, set, setattr, sorted, str, sum, tuple, zip} from &#39;./org.transcrypt.__runtime__.js&#39;;
import {cprint as col_print, colors} from &#39;./color.js&#39;;
var __name__ = &#39;riot_tag&#39;;
export var __author__ = &#39;Gunther Klessinger, gk@axiros.com, Germany&#39;;
export var c = colors;
var __left0__ = tuple ([c [&#39;purple&#39;], c [&#39;orange&#39;], c [&#39;gray&#39;], c [&#39;red&#39;], c [&#39;black&#39;]]);
export var M = __left0__ [0];
export var I = __left0__ [1];
export var L = __left0__ [2];
export var R = __left0__ [3];
export var B = __left0__ [4];
export var lifecycle_ev = [&#39;before-mount&#39;, &#39;mount&#39;, &#39;update&#39;, &#39;unmount&#39;];
export var cur_tag_col = 0;
export var RiotTag =  __class__ (&#39;RiotTag&#39;, [object], {
    __module__: __name__,
    debug: null,
    template: &#39;&lt;h1&gt;it worx&lt;/h1&gt;&#39;,
    style: &#39;&#39;,
    node_name: &#39;unmounted&#39;,
    opts: null,
    get __init__ () {return __get__ (this, function (self, tag, opts) {
        self.opts = opts;
        self._setup_tag (tag);
        cur_tag_col = __mod__ (cur_tag_col + 1, len (colors));
        self.my_col = colors.py_items () [cur_tag_col] [1];
    });},
    get _setup_tag () {return __get__ (this, function (self, tag) {
        tag.py_obj = self;
        self.riot_tag = tag;
        var handlers = dict ({});
        for (var ev of lifecycle_ev) {
            var f = getattr (self, ev.py_replace (&#39;-&#39;, &#39;_&#39;));
            if (f) {
                tag.on (ev, f);
            }
        }
    });},
    get pp () {return __get__ (this, function (self) {
        var msg = tuple ([].slice.apply (arguments).slice (1));
        col_print (L (&#39;&lt;&#39;, self.my_col (self.node_name, self.my_col), &#39;/&gt; &#39;), M (&#39; &#39;.join ((function () {
            var __accu0__ = [];
            for (var s of msg) {
                __accu0__.append (s);
            }
            return __accu0__;
        }) ())));
    });},
    get _lifecycle_ev () {return __get__ (this, function (self, mode) {
        if (self.debug) {
            self.pp (mode + &#39;ing&#39;);
        }
    });},
    get py_update () {return __get__ (this, function (self) {
        self._lifecycle_ev (&#39;update&#39;);
    });},
    get mount () {return __get__ (this, function (self) {
        self._lifecycle_ev (&#39;mount&#39;);
    });},
    get unmount () {return __get__ (this, function (self) {
        self._lifecycle_ev (&#39;unmount&#39;);
    });},
    get before_mount () {return __get__ (this, function (self) {
        self._lifecycle_ev (&#39;before-mount&#39;);
        return self.bind_vars ();
    });},
    get bind_vars () {return __get__ (this, function (self) {
        var tag = self.riot_tag;
        self.node_name = tag.root.nodeName.lower ();
        self.debug &amp;&amp; self.pp (&#39;binding vars&#39;);
        var __left0__ = [];
        tag._immutables = __left0__;
        var im = __left0__;
        var lc = lifecycle_ev;
        for (var k of dir (self)) {
            if (k [0] == &#39;_&#39; || __in__ (k, lifecycle_ev) || k == &#39;before_mount&#39;) {
                continue;
            }
            var v = getattr (self, k);
            
                              typeof v === &quot;function&quot; || typeof v === &quot;object&quot; ?
                              tag[k] = self[k] : tag._immutables.push(k)
        }
        
                var i = tag._immutables, py = self
                i.forEach(function(k, j, i) {
                    Object.defineProperty(tag, k, {
                        get: function()  { return self[k]},
                        set: function(v) { self[k] = v }
                    })
                })
    });}
});

//# sourceMappingURL=riot_tag.map
</pre></div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="51%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="literal-block-wrapper first last docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">riot_demo.py, a derived Transcrypt Riot tag class</span><a class="headerlink" href="#id21" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># an example user tag, using RiotTag</span>

<span class="kn">from</span> <span class="nn">riot_tag</span> <span class="k">import</span> <span class="n">RiotTag</span>

<span class="k">class</span> <span class="nc">P</span><span class="p">(</span><span class="n">RiotTag</span><span class="p">):</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># never do mutables on class level. this is just to check if transpiler</span>
    <span class="c1"># creates the same behaviour - and it does, a second tag instance gets</span>
    <span class="c1"># the same lv object:</span>
    <span class="n">lv</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;n0&#39;</span><span class="p">}]</span>
    <span class="c1"># immuatble on class level. does a second instance start at 1?</span>
    <span class="c1"># answer: yes, perfect:</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39; &lt;div&gt;&lt;h1&gt;Riot Transcrypt Tag Instance </span><span class="si">{label}</span><span class="s1">&lt;/h1&gt;</span>
<span class="s1">                         &lt;div&gt;INNER&lt;/div&gt;&lt;/div&gt; &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">count_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">(</span><span class="s1">&#39;counter:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span> <span class="s1">&#39;len lv:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lv</span><span class="p">),</span> <span class="s1">&#39;adding one lv&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lv</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;n&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span>

<span class="c1"># try some inheritance...</span>
<span class="k">class</span> <span class="nc">Sample2</span><span class="p">(</span><span class="n">P</span><span class="p">):</span>
    <span class="c1"># ... and change the state at every update, just for fun:</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;INNER&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    &lt;div&gt;</span>
<span class="s1">    &lt;h5 each=&quot;</span><span class="si">{lv}</span><span class="s1">&quot;&gt;name: </span><span class="si">{name}</span><span class="s1"> - counter: {count_up()}&lt;/h5&gt;</span>
<span class="s1">    &lt;/div&gt;</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># no scoped styles currently</span>
    <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;sample2 h5 {color: green}&#39;&#39;&#39;</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">opts</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>  <span class="c1"># this rocks so much.</span>
        <span class="c1"># alternative to super:</span>
        <span class="n">RiotTag</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
        <span class="c1"># uncomment next line and chrome will stop:</span>
        <span class="c1"># debugger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">(</span><span class="s1">&#39;tag init&#39;</span><span class="p">,</span> <span class="s1">&#39;adding 2 lv&#39;</span><span class="p">)</span>
        <span class="c1"># mutating the lv object:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lv</span><span class="o">.</span><span class="n">extend</span><span class="p">([{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;n1&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;n2&#39;</span><span class="p">}])</span>


    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="p">(</span><span class="s1">&#39;update handler in the custom tag, calling super&#39;</span><span class="p">)</span>
        <span class="n">RiotTag</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

</pre></div>
</div>
</div>
</td>
<td><div class="literal-block-wrapper first last docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text">riot_demo.js, compiled by Transcrypt</span><a class="headerlink" href="#id22" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Transcrypt</span><span class="s1">&#39;ed from Python, 2019-01-22 11:21:56</span>
<span class="kn">import</span> <span class="p">{</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">BaseException</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="n">IterableError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">NotImplementedError</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">,</span> <span class="ne">StopIteration</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">Warning</span><span class="p">,</span> <span class="n">__JsIterator__</span><span class="p">,</span> <span class="n">__PyIterator__</span><span class="p">,</span> <span class="n">__Terminal__</span><span class="p">,</span> <span class="fm">__add__</span><span class="p">,</span> <span class="fm">__and__</span><span class="p">,</span> <span class="fm">__call__</span><span class="p">,</span> <span class="vm">__class__</span><span class="p">,</span> <span class="n">__envir__</span><span class="p">,</span> <span class="fm">__eq__</span><span class="p">,</span> <span class="fm">__floordiv__</span><span class="p">,</span> <span class="fm">__ge__</span><span class="p">,</span> <span class="fm">__get__</span><span class="p">,</span> <span class="n">__getcm__</span><span class="p">,</span> <span class="fm">__getitem__</span><span class="p">,</span> <span class="n">__getslice__</span><span class="p">,</span> <span class="n">__getsm__</span><span class="p">,</span> <span class="fm">__gt__</span><span class="p">,</span> <span class="n">__i__</span><span class="p">,</span> <span class="fm">__iadd__</span><span class="p">,</span> <span class="fm">__iand__</span><span class="p">,</span> <span class="n">__idiv__</span><span class="p">,</span> <span class="n">__ijsmod__</span><span class="p">,</span> <span class="fm">__ilshift__</span><span class="p">,</span> <span class="fm">__imatmul__</span><span class="p">,</span> <span class="fm">__imod__</span><span class="p">,</span> <span class="fm">__imul__</span><span class="p">,</span> <span class="n">__in__</span><span class="p">,</span> <span class="fm">__init__</span><span class="p">,</span> <span class="fm">__ior__</span><span class="p">,</span> <span class="fm">__ipow__</span><span class="p">,</span> <span class="fm">__irshift__</span><span class="p">,</span> <span class="fm">__isub__</span><span class="p">,</span> <span class="fm">__ixor__</span><span class="p">,</span> <span class="n">__jsUsePyNext__</span><span class="p">,</span> <span class="n">__jsmod__</span><span class="p">,</span> <span class="n">__k__</span><span class="p">,</span> <span class="n">__kwargtrans__</span><span class="p">,</span> <span class="fm">__le__</span><span class="p">,</span> <span class="fm">__lshift__</span><span class="p">,</span> <span class="fm">__lt__</span><span class="p">,</span> <span class="fm">__matmul__</span><span class="p">,</span> <span class="n">__mergefields__</span><span class="p">,</span> <span class="n">__mergekwargtrans__</span><span class="p">,</span> <span class="fm">__mod__</span><span class="p">,</span> <span class="fm">__mul__</span><span class="p">,</span> <span class="fm">__ne__</span><span class="p">,</span> <span class="fm">__neg__</span><span class="p">,</span> <span class="n">__nest__</span><span class="p">,</span> <span class="fm">__or__</span><span class="p">,</span> <span class="fm">__pow__</span><span class="p">,</span> <span class="n">__pragma__</span><span class="p">,</span> <span class="n">__proxy__</span><span class="p">,</span> <span class="n">__pyUseJsNext__</span><span class="p">,</span> <span class="fm">__rshift__</span><span class="p">,</span> <span class="fm">__setitem__</span><span class="p">,</span> <span class="n">__setproperty__</span><span class="p">,</span> <span class="n">__setslice__</span><span class="p">,</span> <span class="n">__sort__</span><span class="p">,</span> <span class="n">__specialattrib__</span><span class="p">,</span> <span class="fm">__sub__</span><span class="p">,</span> <span class="n">__super__</span><span class="p">,</span> <span class="n">__t__</span><span class="p">,</span> <span class="n">__terminal__</span><span class="p">,</span> <span class="fm">__truediv__</span><span class="p">,</span> <span class="n">__withblock__</span><span class="p">,</span> <span class="fm">__xor__</span><span class="p">,</span> <span class="nb">abs</span><span class="p">,</span> <span class="nb">all</span><span class="p">,</span> <span class="nb">any</span><span class="p">,</span> <span class="k">assert</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">callable</span><span class="p">,</span> <span class="nb">chr</span><span class="p">,</span> <span class="n">copy</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">,</span> <span class="nb">delattr</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="nb">divmod</span><span class="p">,</span> <span class="nb">enumerate</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">,</span> <span class="nb">hasattr</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">isinstance</span><span class="p">,</span> <span class="nb">issubclass</span><span class="p">,</span> <span class="nb">len</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">map</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="nb">ord</span><span class="p">,</span> <span class="nb">pow</span><span class="p">,</span> <span class="nb">print</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">py_TypeError</span><span class="p">,</span> <span class="n">py_iter</span><span class="p">,</span> <span class="n">py_metatype</span><span class="p">,</span> <span class="n">py_next</span><span class="p">,</span> <span class="n">py_reversed</span><span class="p">,</span> <span class="n">py_typeof</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="nb">repr</span><span class="p">,</span> <span class="nb">round</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">setattr</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">sum</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">zip</span><span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;./org.transcrypt.__runtime__.js&#39;</span><span class="p">;</span>
<span class="kn">import</span> <span class="p">{</span><span class="n">RiotTag</span><span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;./riot_tag.js&#39;</span><span class="p">;</span>
<span class="n">var</span> <span class="vm">__name__</span> <span class="o">=</span> <span class="s1">&#39;__main__&#39;</span><span class="p">;</span>
<span class="n">export</span> <span class="n">var</span> <span class="n">P</span> <span class="o">=</span>  <span class="vm">__class__</span> <span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">RiotTag</span><span class="p">],</span> <span class="p">{</span>
    <span class="vm">__module__</span><span class="p">:</span> <span class="vm">__name__</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">lv</span><span class="p">:</span> <span class="p">[</span><span class="nb">dict</span> <span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;n0&#39;</span><span class="p">})],</span>
    <span class="n">counter</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">template</span><span class="p">:</span> <span class="s1">&#39; &lt;div&gt;&lt;h1&gt;Riot Transcrypt Tag Instance </span><span class="si">{label}</span><span class="s1">&lt;/h1&gt;</span><span class="se">\n</span><span class="s1">                         &lt;div&gt;INNER&lt;/div&gt;&lt;/div&gt; &#39;</span><span class="p">,</span>
    <span class="n">get</span> <span class="n">count_up</span> <span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="fm">__get__</span> <span class="p">(</span><span class="n">this</span><span class="p">,</span> <span class="n">function</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pp</span> <span class="p">(</span><span class="s1">&#39;counter:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="p">,</span> <span class="s1">&#39;len lv:&#39;</span><span class="p">,</span> <span class="nb">len</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lv</span><span class="p">),</span> <span class="s1">&#39;adding one lv&#39;</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lv</span><span class="o">.</span><span class="n">append</span> <span class="p">(</span><span class="nb">dict</span> <span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;n&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="p">}));</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">counter</span><span class="p">;</span>
    <span class="p">});}</span>
<span class="p">});</span>
<span class="n">export</span> <span class="n">var</span> <span class="n">Sample2</span> <span class="o">=</span>  <span class="vm">__class__</span> <span class="p">(</span><span class="s1">&#39;Sample2&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">P</span><span class="p">],</span> <span class="p">{</span>
    <span class="vm">__module__</span><span class="p">:</span> <span class="vm">__name__</span><span class="p">,</span>
    <span class="n">template</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">py_replace</span> <span class="p">(</span><span class="s1">&#39;INNER&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    &lt;div&gt;</span><span class="se">\n</span><span class="s1">    &lt;h5 each=&quot;</span><span class="si">{lv}</span><span class="s1">&quot;&gt;name: </span><span class="si">{name}</span><span class="s1"> - counter: {count_up()}&lt;/h5&gt;</span><span class="se">\n</span><span class="s1">    &lt;/div&gt;</span><span class="se">\n</span><span class="s1">    &#39;</span><span class="p">),</span>
    <span class="n">style</span><span class="p">:</span> <span class="s1">&#39;sample2 h5 {color: green}&#39;</span><span class="p">,</span>
    <span class="n">get</span> <span class="fm">__init__</span> <span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="fm">__get__</span> <span class="p">(</span><span class="n">this</span><span class="p">,</span> <span class="n">function</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span> <span class="p">{</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">capitalize</span> <span class="p">();</span>
        <span class="n">RiotTag</span><span class="o">.</span><span class="fm">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">opts</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pp</span> <span class="p">(</span><span class="s1">&#39;tag init&#39;</span><span class="p">,</span> <span class="s1">&#39;adding 2 lv&#39;</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lv</span><span class="o">.</span><span class="n">extend</span> <span class="p">([</span><span class="nb">dict</span> <span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;n1&#39;</span><span class="p">}),</span> <span class="nb">dict</span> <span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;n2&#39;</span><span class="p">})]);</span>
    <span class="p">});},</span>
    <span class="n">get</span> <span class="n">py_update</span> <span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="fm">__get__</span> <span class="p">(</span><span class="n">this</span><span class="p">,</span> <span class="n">function</span> <span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pp</span> <span class="p">(</span><span class="s1">&#39;update handler in the custom tag, calling super&#39;</span><span class="p">);</span>
        <span class="n">RiotTag</span><span class="o">.</span><span class="n">py_update</span> <span class="p">(</span><span class="bp">self</span><span class="p">);</span>
    <span class="p">});}</span>
<span class="p">});</span>

<span class="o">//</span><span class="c1"># sourceMappingURL=riot_demo.map</span>
</pre></div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="example-using-input-and-print-in-a-dom-terminal-element-in-your-browser">
<h2>6.7. Example: Using input and print in a DOM __terminal__ element in your browser<a class="headerlink" href="#example-using-input-and-print-in-a-dom-terminal-element-in-your-browser" title="Permalink to this headline">¶</a></h2>
<p>Without special measures, Transcrypt’s <em>print</em> function prints to the debugging console. However if there’s an element with id <em>__terminal__</em> in your DOM tree, the <em>print</em> function prints to this element. Moreover, the <em>input</em> function also prints its prompt message to the terminal element. Input is collected using a dialog box and echoed to the terminal element.</p>
<p>This means that you can write applications with blocking I/O, rather than event driven behaviour, e.g. for simple activities or, since they are intuitively easy to comprehend, for educational purposes.</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="literal-block-wrapper first last docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text">terminal_demo.html</span><a class="headerlink" href="#id23" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">script</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;module&quot;</span><span class="o">&gt;</span><span class="kn">import</span> <span class="o">*</span> <span class="k">as</span> <span class="n">terminal_demo</span> <span class="kn">from</span> <span class="s2">&quot;./__target__/terminal_demo.js&quot;</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span>
            <span class="n">Leave</span> <span class="nb">input</span> <span class="n">field</span> <span class="n">blank</span> <span class="n">to</span> <span class="n">quit</span><span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
            <span class="n">Refresh</span> <span class="n">browser</span> <span class="n">window</span> <span class="n">to</span> <span class="n">restart</span><span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">div</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;__terminal__&#39;</span><span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="literal-block-wrapper first last docutils container" id="id24">
<div class="code-block-caption"><span class="caption-text">terminal_demo.py</span><a class="headerlink" href="#id24" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="nb">input</span> <span class="p">(</span><span class="s1">&#39;What&#39;&#39;s your name? &#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">break</span><span class="p">;</span>
    
    <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Hi&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;I am your computer.&#39;</span><span class="p">)</span>

    <span class="n">age</span> <span class="o">=</span> <span class="nb">float</span> <span class="p">(</span><span class="nb">input</span> <span class="p">(</span><span class="s1">&#39;How old are you? &#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;Sorry&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="s1">&#39;is too young to drive a car in the Netherlands.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;OK&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="s1">&#39;is old enough to drive a car in the Netherlands.&#39;</span><span class="p">)</span>
        
    <span class="nb">print</span> <span class="p">()</span>
    
</pre></div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="example-using-the-parcel-js-bundler-to-package-a-set-of-modules-written-in-diverse-programming-languages">
<h2>6.8. Example: Using the Parcel.js bundler to package a set of modules written in diverse programming languages<a class="headerlink" href="#example-using-the-parcel-js-bundler-to-package-a-set-of-modules-written-in-diverse-programming-languages" title="Permalink to this headline">¶</a></h2>
<p>Bundlers are increasingly popular in the world of web development.
With the Parcel bundler, it is possible to integrate Transcrypt modules with modules written in other languages.
Whenever the source code of any module changes, automatic recompilation and repackaging takes place.
Sourcemaps are generated for all non-JavaScript modules, enabling source level debugging in the browser.</p>
<p>In the example, the top level file of the module hierarchy is the html file below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="literal-block-wrapper first last docutils container" id="id25">
<div class="code-block-caption"><span class="caption-text">index.html</span><a class="headerlink" href="#id25" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">parcel</span><span class="o">-</span><span class="n">plugin</span><span class="o">-</span><span class="n">python</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Python</span><span class="o">+</span><span class="n">Transcrypt</span> <span class="n">Plugin</span> <span class="k">for</span> <span class="n">Parcel</span> <span class="n">Bundler</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">[</span> <span class="nb">open</span> <span class="n">the</span> <span class="n">console</span> <span class="k">for</span> <span class="n">program</span> <span class="n">output</span> <span class="p">]</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;./index.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>The html file above refers to the JavaScript file below:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="literal-block-wrapper first last docutils container" id="id26">
<div class="code-block-caption"><span class="caption-text">index.js</span><a class="headerlink" href="#id26" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="p">{</span> <span class="n">main</span> <span class="p">}</span> <span class="kn">from</span> <span class="s2">&quot;./main.py&quot;</span><span class="p">;</span>

<span class="n">main</span><span class="p">();</span>
</pre></div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>This top level JavaScript file in turn refers to a Python file,
that makes use of many modules, some written in Python, some in JavaScript:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="literal-block-wrapper first last docutils container" id="id27">
<div class="code-block-caption"><span class="caption-text">main.py</span><a class="headerlink" href="#id27" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">testcontext</span> <span class="k">import</span> <span class="n">Test</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Main function of the program (called from index.js)&#39;&#39;&#39;</span>
    <span class="c1"># sibling module</span>
    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;import sibling&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">sibling</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">sibling</span><span class="o">.</span><span class="n">sibling_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;import sibling as alias_sibling&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">sibling</span> <span class="k">as</span> <span class="nn">alias_sibling</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">alias_sibling</span><span class="o">.</span><span class="n">sibling_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;from sibling import sibling_func&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">sibling</span> <span class="k">import</span> <span class="n">sibling_func</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">sibling_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;from sibling import sibling_func as alias_sibling_func&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">sibling</span> <span class="k">import</span> <span class="n">sibling_func</span> <span class="k">as</span> <span class="n">alias_sibling_func</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">alias_sibling_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="c1"># sibling2 module (using sibling2 because `import * from sibling` would overrride sibling_func above)</span>
    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;from sibling2 import *&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">sibling2</span> <span class="k">import</span> <span class="o">*</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">sibling2_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="c1"># siblingjs.js (Javascript file import)</span>
    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;import siblingjs&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">siblingjs</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">siblingjs</span><span class="o">.</span><span class="n">siblingjs_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;import siblingjs as alias_siblingjs&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">siblingjs</span> <span class="k">as</span> <span class="nn">alias_siblingjs</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">alias_siblingjs</span><span class="o">.</span><span class="n">siblingjs_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;from siblingjs import siblingjs_func&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">siblingjs</span> <span class="k">import</span> <span class="n">siblingjs_func</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">siblingjs_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;from siblingjs import siblingjs_func as alias_siblingjs_func&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">siblingjs</span> <span class="k">import</span> <span class="n">siblingjs_func</span> <span class="k">as</span> <span class="n">alias_siblingjs_func</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">alias_siblingjs_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="c1"># mymod package (__init__.py file)</span>
    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;import mymod&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">mymod</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">mymod</span><span class="o">.</span><span class="n">mymod_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;import mymod as alias_mymod&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">mymod</span> <span class="k">as</span> <span class="nn">alias_mymod</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">alias_mymod</span><span class="o">.</span><span class="n">mymod_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;from mymod import mymod_func&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">mymod</span> <span class="k">import</span> <span class="n">mymod_func</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">mymod_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;from mymod import mymod_func as alias_mymod_func&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">mymod</span> <span class="k">import</span> <span class="n">mymod_func</span> <span class="k">as</span> <span class="n">alias_mymod_func</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">alias_mymod_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="c1"># mymod.child (subdir module)</span>
    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;import mymod.child&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">mymod.child</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">mymod</span><span class="o">.</span><span class="n">child</span><span class="o">.</span><span class="n">child_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;alias_child.child_func&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">mymod.child</span> <span class="k">as</span> <span class="nn">alias_child</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">alias_child</span><span class="o">.</span><span class="n">child_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;from mymod.child import child_func&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">mymod.child</span> <span class="k">import</span> <span class="n">child_func</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">child_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;from mymod.child import child_func as alias_child_func&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">mymod.child</span> <span class="k">import</span> <span class="n">child_func</span> <span class="k">as</span> <span class="n">alias_child_func</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">alias_child_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;import mymod.grandchildmod&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">mymod.grandchildmod</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">mymod</span><span class="o">.</span><span class="n">grandchildmod</span><span class="o">.</span><span class="n">grandchildmod_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;import mymod.grandchildmod as alias_grandchildmod&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">mymod.grandchildmod</span> <span class="k">as</span> <span class="nn">alias_grandchildmod</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">alias_grandchildmod</span><span class="o">.</span><span class="n">grandchildmod_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;from mymod.grandchildmod.grandchild import grandchild_func&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">mymod.grandchildmod.grandchild</span> <span class="k">import</span> <span class="n">grandchild_func</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">grandchild_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Test</span><span class="p">(</span><span class="s1">&#39;from mymod.grandchildmod.grandchild import grandchild_func as alias_grandchild_func&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">test</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">mymod.grandchildmod.grandchild</span> <span class="k">import</span> <span class="n">grandchild_func</span> <span class="k">as</span> <span class="n">alias_grandchild_func</span>
        <span class="n">test</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">alias_grandchild_func</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">random_num</span><span class="p">)</span>
</pre></div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Whenever a source file of this mixed bag of modules is changed,
the whole module hierarchy is rebuilt and repackaged.
The bundler gets its information from the <em>.project</em> file in the <em>__target__</em> directory.
Consequently Transcrypt can be fully integrated in an automated build process for a project featuring an arbitrary mix of source languages.
With this feature, Python has truly become a first class citizen in the browser world.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo_sphinx.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Subjects</a></h3>
  <ul>
<li><a class="reference internal" href="#">5. Seamless interoperation with the DOM</a><ul>
<li><a class="reference internal" href="#practical-example-a-simple-responsive-website-using-no-html-or-css-at-all">5.1. Practical example: a simple, responsive website using no HTML or CSS at all</a></li>
<li><a class="reference internal" href="#svg-example-turtle-graphics">5.2. SVG example: Turtle graphics</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mixed-examples">6. Mixed examples</a><ul>
<li><a class="reference internal" href="#example-pong">6.1. Example: Pong</a><ul>
<li><a class="reference internal" href="#three-ways-of-integration-with-javascript-libraries">6.1.1. Three ways of integration with JavaScript libraries</a></li>
<li><a class="reference internal" href="#minification">6.1.2. Minification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-jquery">6.2. Example: jQuery</a></li>
<li><a class="reference internal" href="#example-ios-web-app-with-native-look-and-feel">6.3. Example: iOS web app with native look and feel</a></li>
<li><a class="reference internal" href="#example-d3-js">6.4. Example: D3.js</a></li>
<li><a class="reference internal" href="#example-react">6.5. Example: React</a></li>
<li><a class="reference internal" href="#example-riot">6.6. Example: Riot</a></li>
<li><a class="reference internal" href="#example-using-input-and-print-in-a-dom-terminal-element-in-your-browser">6.7. Example: Using input and print in a DOM __terminal__ element in your browser</a></li>
<li><a class="reference internal" href="#example-using-the-parcel-js-bundler-to-package-a-set-of-modules-written-in-diverse-programming-languages">6.8. Example: Using the Parcel.js bundler to package a set of modules written in diverse programming languages</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="supported_constructs.html"
                        title="previous chapter">4. Systematic code examples: a guided tour of Transcrypt</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="autotesting_transcrypt.html"
                        title="next chapter">7. Autotesting Transcrypt code</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/integration_javascript.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="autotesting_transcrypt.html" title="7. Autotesting Transcrypt code"
             >next</a> |</li>
        <li class="right" >
          <a href="supported_constructs.html" title="4. Systematic code examples: a guided tour of Transcrypt"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Transcrypt 3.7.15 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Jacques de Hooge.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.8.
    </div>
  </body>
</html>