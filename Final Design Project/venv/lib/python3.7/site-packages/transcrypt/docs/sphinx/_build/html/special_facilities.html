
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>3. Special facilities &#8212; Transcrypt 3.7.15 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4. Systematic code examples: a guided tour of Transcrypt" href="supported_constructs.html" />
    <link rel="prev" title="2. Getting started" href="installation_use.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="supported_constructs.html" title="4. Systematic code examples: a guided tour of Transcrypt"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation_use.html" title="2. Getting started"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Transcrypt 3.7.15 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="special-facilities">
<h1>3. Special facilities<a class="headerlink" href="#special-facilities" title="Permalink to this headline">¶</a></h1>
<div class="section" id="transcrypt-s-module-mechanism">
<span id="module-mechanism"></span><h2>3.1. Transcrypt’s module mechanism<a class="headerlink" href="#transcrypt-s-module-mechanism" title="Permalink to this headline">¶</a></h2>
<p>Transcrypt’s module mechanism looks a lot like Python’s but there are a few differences.
Firstly, in Transcrypt it is good practice to use url-based unique module identifiers, e.g.</p>
<ul class="simple">
<li><em>com.github.&lt;my name&gt;.&lt;my module name&gt;</em></li>
<li><em>org.python.pypi.&lt;my module name&gt;</em></li>
<li><em>com.&lt;my company name&gt;.&lt;my module name&gt;</em></li>
</ul>
<p>To achieve optimal CPython compatibility, an exception is made for modules that are part of the CPython distribution, e.g. <em>math</em>.</p>
<p>Note that Transcrypt is meant be to used with JavaScript rather than Python libraries, since its focus isn’t on the desktop but on the browser. Nevertheless a growing set of standard Python modules is part of the distribution, currently cmat, datetime, itertools, logging, math, random (partially), re (almost complete), time, turtle and warnings. Other modules are in the making.</p>
<p>Finding the code for a module proceeds as follows:</p>
<p>Suppose you import a module <em>all.the.kings.men</em>. Then the following paths will be searched respectively:</p>
<blockquote>
<div><ul class="simple">
<li><em>&lt;directory of your main module&gt;/all/the/kings/men.py</em></li>
<li><em>&lt;directory of your main module&gt;/all/the/kings/men.js</em></li>
<li><em>&lt;directory of your main module&gt;/all/the/kings/men/__init__.py</em></li>
<li><em>&lt;directory of your main module&gt;/all/the/kings/men/__init__.js</em></li>
</ul>
<ul class="simple">
<li><em>transcrypt/Transcrypt/modules/all/the/kings/men.py</em></li>
<li><em>transcrypt/Transcrypt/modules/all/the/kings/men.js</em></li>
<li><em>transcrypt/Transcrypt/modules/all/the/kings/men/__init__py</em></li>
<li><em>transcrypt/Transcrypt/modules/all/the/kings/men/__init__js</em></li>
</ul>
<ul class="simple">
<li><em>&lt;CPython packages directory 1&gt;/all/the/kings/men.py</em></li>
<li><em>&lt;CPython packages directory 1&gt;/all/the/kings/men.js</em></li>
<li><em>&lt;CPython packages directory 1&gt;/all/the/kings/men/__init__.py</em></li>
<li><em>&lt;CPython packages directory 1&gt;/all/the/kings/men/__init__.js</em></li>
</ul>
<ul class="simple">
<li><em>&lt;CPython packages directory 2&gt;/all/the/kings/men.py</em></li>
<li><em>&lt;CPython packages directory 2&gt;/all/the/kings/men.js</em></li>
<li><em>&lt;CPython packages directory 2&gt;/all/the/kings/men/__init__.py</em></li>
<li><em>&lt;CPython packages directory 2&gt;/all/the/kings/men/__init__.js</em></li>
</ul>
<ul class="simple">
<li><em>More CPython packages directories</em></li>
</ul>
</div></blockquote>
<p>As can be seen from the above list, modules local to your project take precedence over modules available in Transcrypt, which again take precedence over modules available globally in CPython. Note that even if modules are made available globally in CPython, importing them in Transcrypt gives special possibilities and restrictions. They are allowed to be written in native JavaScript, in which case they reside in the __javascript__ subdirectory of the module. They should not depend on C, C++ or features that are outside Python subset supported by Transcrypt.</p>
<p>Although under these guidelines it’s quite possible to write modules that are importable both by CPyton and Transcrypt, most Transcrypt modules will be come from the JavaScript, rather than from the Python ecosystem. If both a Python and a JavaScript incarnation of a module are present, the Python module is only recompiled if it’s younger than the corresponding JavaScript module, unless the -b switch is used.</p>
<p>Furthermore, note that the <em>__init__.py</em> or <em>__init__.js</em> file of a module is executed if and only if that module is imported, not if it’s just somewhere in the hierarchy of directories containing that module. Furthermore the global code of a module is executed only once, no matter how often that module is imported, as is equally the case with CPython.</p>
<p>Another deviation from CPython is that the inclusion of a module has to be decided upon compiletime. This means that imports cannot be runtime conditional, so e.g. cannot be under an <em>if</em>. For compiletime conditional imports you can use
<a class="reference internal" href="#pragma-ifdef"><span class="std std-ref">__pragma__ (‘ifdef’)</span></a>. Also, since imports are resolved in one pass, cyclic imports are not supported.</p>
<p>As a consequence of the above, modules may be distributed as Python <em>.py</em> files, but also as JavaScript-only <em>.js</em> files. The JavaScript files may be hand written or generated by any tool including Transcrypt.</p>
</div>
<div class="section" id="using-browser-stubs-to-test-non-gui-code-that-uses-console-log-and-window-alert">
<h2>3.2. Using browser stubs to test non-GUI code that uses console.log and window.alert<a class="headerlink" href="#using-browser-stubs-to-test-non-gui-code-that-uses-console-log-and-window-alert" title="Permalink to this headline">¶</a></h2>
<p>To test the non-GUI part of your code in a desktop rather than a browser environment, use <em>from org.transcrypt.stubs.browser import *</em>. This will allow you to call the <em>window.alert</em> and <em>console.log</em> functions in your code when you run it from the command prompt, using the -r command line switch: <em>transcrypt -r &lt;my main module name&gt;</em>. This will invoke CPython, searching the appropriate module paths as compilation would have done.</p>
</div>
<div class="section" id="creating-javascript-objects-with-new-constructor-call">
<h2>3.3. Creating JavaScript objects with __new__ (&lt;constructor call&gt;)<a class="headerlink" href="#creating-javascript-objects-with-new-constructor-call" title="Permalink to this headline">¶</a></h2>
<p>While creating objects in Transcrypt mostly happens in the plain Python way, e.g. <em>canvas = Canvas (&lt;parameters&gt;)</em>, objects from 3rd party JavaScript libraries often have to be created using <em>new</em>. In Transcrypt such objects are created by calling the  <em>__new__</em> function, e.g. <em>canvas = __new__ (Canvas (&lt;parameters&gt;)</em>, as can be seen in the <a class="reference internal" href="integration_javascript.html#code-pong"><span class="std std-ref">Pong example</span></a>. This mechanism is simple, follows Python’s syntax rules and doesn’t require updating of an encapsulation layer if a later version of the underlying JavaScript library features additional constructor functions. Therefore in most cases it is the preferred way to create objects who’s initialization requires calling 3rd party JavaScript constructor functions.</p>
<p>As an alternative, instantiation and construction can be encapsulated in one function call. Since this in fact creates an alternative API facade for the 3rd party JavaScript library, such an encapsulation should be kept separate from the original library, e.g. by putting it in a separate importable module. The JavaScript code for this encapsulation would e.g. be <em>&lt;facade module name&gt;.Canvas = function (&lt;parameters&gt;) {return new Canvas (&lt;parameters&gt;);};</em>. After importing the facade module, canvas creation is straightforward: <em>canvas = Canvas (&lt;parameters&gt;)</em>.</p>
<p>As a third alternative, encapsulation can be done in Python rather than JavaScript: <em>def Canvas (&lt;parameters&gt;): return __new__ (&lt;3rd party module name&gt;.Canvas (&lt;parameters&gt;)</em>. Also in this case the creation syntax is simple: <em>canvas = Canvas (&lt;parameters&gt;)</em>.</p>
</div>
<div class="section" id="the-pragma-mechanism">
<h2>3.4. The __pragma__ mechanism<a class="headerlink" href="#the-pragma-mechanism" title="Permalink to this headline">¶</a></h2>
<p>Pragma’s are directives in the source code, that locally alter the behaviour of the compiler. Pragma’s come in four varieties.</p>
<div class="section" id="the-function-like-variety">
<h3>3.4.1. The function-like variety<a class="headerlink" href="#the-function-like-variety" title="Permalink to this headline">¶</a></h3>
<p><em>__pragma__ (&lt;parameters&gt;)</em></p>
<p>is acceptable only to Transcrypt, CPython requires a stub with parameter <em>*args</em>. Such a stub can either be defined locally or imported:</p>
<p><em>from org.transcrypt.stubs.browser import __pragma__</em></p>
</div>
<div class="section" id="the-comment-like-variety">
<h3>3.4.2. The comment-like variety<a class="headerlink" href="#the-comment-like-variety" title="Permalink to this headline">¶</a></h3>
<p># __pragma__ (&lt;parameters&gt;)</p>
<p>is acceptable both to Transcrypt and CPython. In CPython it does nothing.</p>
<p>N.B. Both varieties above have to be properly indented, matching indentation of their context.</p>
</div>
<div class="section" id="the-single-line-activation-variety">
<h3>3.4.3. The single-line activation variety<a class="headerlink" href="#the-single-line-activation-variety" title="Permalink to this headline">¶</a></h3>
<p>&lt;line of code&gt; # __:&lt;single parameter&gt;</p>
<p>It will switch a facility on or off just for the line of code it’s part of.
Single line pragma’s can only be used for pragma’s which have a single parameter, it’s name.</p>
<p>For example the following line:</p>
<p><em>vector2 = vector0 + vector1 # __:opov</em></p>
<p>will be compiled identically to:</p>
<p><em>__pragma__ (‘opov’); vector2 = vector0 + vector1; __pragma__ (‘noopov’)</em></p>
</div>
<div class="section" id="the-single-line-deactivation-variety">
<h3>3.4.4. The single-line deactivation variety<a class="headerlink" href="#the-single-line-deactivation-variety" title="Permalink to this headline">¶</a></h3>
<p><em>scalar2 = scalar0 + scalar1 # __:noopov</em></p>
<p>will be compiled identically to:</p>
<p><em>__pragma__ (‘noopov’); scalar2 = scalar0 + scalar1; __pragma__ (‘opov’)</em></p>
</div>
</div>
<div class="section" id="pragma-alias">
<span id="identifier-aliasing-pragma-alias-and-pragma-noalias"></span><h2>3.5. Identifier aliasing: __pragma__ (‘alias’, …) and __pragma__ (‘noalias’, …)<a class="headerlink" href="#pragma-alias" title="Permalink to this headline">¶</a></h2>
<p>Calling <em>__pragma__ (‘alias’, &lt;Python id part&gt;, &lt;JavaScript id part&gt;)</em> at the start of a module will replace identifiers or parts thereof like in the following examples:</p>
<p>Example 1:</p>
<table border="1" class="docutils">
<colgroup>
<col width="62%" />
<col width="38%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td colspan="2">Used at the start of the module: <em>__pragma__ (‘alias’, ‘S’, ‘$’)</em></td>
</tr>
<tr class="row-even"><td>Original in Python:</td>
<td>Alias in JavaScript:</td>
</tr>
<tr class="row-odd"><td><em>S (‘body’)</em></td>
<td><em>$ (‘body’)</em></td>
</tr>
<tr class="row-even"><td><em>S__body</em></td>
<td><em>$body</em></td>
</tr>
<tr class="row-odd"><td><em>S__She__S__Sells__S__Sea__S__Shells__S</em></td>
<td><em>$She$Sells$Sea$Shells$</em></td>
</tr>
</tbody>
</table>
<p>Using the above alias, a piece of jQuery code will look like this in Python:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Use of __pragma__ (‘alias’, ‘S’, ‘$’) in jquery_demo.py</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;alias&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;$&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">start</span> <span class="p">():</span>
    <span class="k">def</span> <span class="nf">changeColors</span> <span class="p">():</span>
        <span class="k">for</span> <span class="n">div</span> <span class="ow">in</span> <span class="n">S__divs</span><span class="p">:</span>
            <span class="n">S</span> <span class="p">(</span><span class="n">div</span><span class="p">)</span> <span class="o">.</span><span class="n">css</span> <span class="p">({</span>
                <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;rgb(</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span> <span class="p">(</span><span class="o">*</span> <span class="p">[</span><span class="nb">int</span> <span class="p">(</span><span class="mi">256</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="n">random</span> <span class="p">())</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">3</span><span class="p">)]),</span>
            <span class="p">})</span>

    <span class="n">S__divs</span> <span class="o">=</span> <span class="n">S</span> <span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">)</span>
    <span class="n">changeColors</span> <span class="p">()</span>
    <span class="n">window</span><span class="o">.</span><span class="n">setInterval</span> <span class="p">(</span><span class="n">changeColors</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Example 2:</p>
<table border="1" class="docutils">
<colgroup>
<col width="62%" />
<col width="38%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td colspan="2">Used at the start of the module <em>__pragma__ (‘alias’, ‘jq’, ‘$’)</em></td>
</tr>
<tr class="row-even"><td><em>jq__body = jq (body)</em></td>
<td><em>$body = $ (‘body’)</em></td>
</tr>
</tbody>
</table>
<p>Note that in the generated JavaScript only the modified identifiers will be present, not the original ones. So the JavaScript identifiers are only aliases for the Python ones, not for any identifier in the JavaScript code itself.</p>
<p>A number of aliases are predefined in the source code of Transcrypt as follows:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Transcrypt’s predefined aliases</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
            <span class="c1"># Format: (&#39;&lt;Python source identifier&gt;&#39;, &#39;&lt;JavaScript target identifier&gt;&#39;)</span>

                                                    <span class="p">(</span><span class="s1">&#39;js_and&#39;</span><span class="p">,</span> <span class="s1">&#39;and&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;arguments&#39;</span><span class="p">,</span> <span class="s1">&#39;py_arguments&#39;</span><span class="p">),</span>          <span class="p">(</span><span class="s1">&#39;js_arguments&#39;</span><span class="p">,</span> <span class="s1">&#39;arguments&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;case&#39;</span><span class="p">,</span> <span class="s1">&#39;py_case&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">,</span> <span class="s1">&#39;py_clear&#39;</span><span class="p">),</span>                  <span class="p">(</span><span class="s1">&#39;js_clear&#39;</span><span class="p">,</span> <span class="s1">&#39;clear&#39;</span><span class="p">),</span>
                                                    <span class="p">(</span><span class="s1">&#39;js_conjugate&#39;</span><span class="p">,</span> <span class="s1">&#39;conjugate&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;py_default&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;del&#39;</span><span class="p">,</span> <span class="s1">&#39;py_del&#39;</span><span class="p">),</span>                      <span class="p">(</span><span class="s1">&#39;js_del&#39;</span><span class="p">,</span> <span class="s1">&#39;del&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="s1">&#39;py_false&#39;</span><span class="p">),</span>
                                                    <span class="p">(</span><span class="s1">&#39;js_from&#39;</span><span class="p">,</span> <span class="s1">&#39;from&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="s1">&#39;py_get&#39;</span><span class="p">),</span>                      <span class="p">(</span><span class="s1">&#39;js_get&#39;</span><span class="p">,</span> <span class="s1">&#39;get&#39;</span><span class="p">),</span>
                                                    <span class="p">(</span><span class="s1">&#39;js_global&#39;</span><span class="p">,</span> <span class="s1">&#39;global&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;Infinity&#39;</span><span class="p">,</span> <span class="s1">&#39;py_Infinity&#39;</span><span class="p">),</span>            <span class="p">(</span><span class="s1">&#39;js_Infinity&#39;</span><span class="p">,</span> <span class="s1">&#39;Infinity&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;py_is&#39;</span><span class="p">),</span>                        <span class="p">(</span><span class="s1">&#39;js_is&#39;</span><span class="p">,</span> <span class="s1">&#39;is&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;isNaN&#39;</span><span class="p">,</span> <span class="s1">&#39;py_isNaN&#39;</span><span class="p">),</span>                  <span class="p">(</span><span class="s1">&#39;js_isNaN&#39;</span><span class="p">,</span> <span class="s1">&#39;isNaN&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;iter&#39;</span><span class="p">,</span> <span class="s1">&#39;py_iter&#39;</span><span class="p">),</span>                    <span class="p">(</span><span class="s1">&#39;js_iter&#39;</span><span class="p">,</span> <span class="s1">&#39;iter&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;items&#39;</span><span class="p">,</span> <span class="s1">&#39;py_items&#39;</span><span class="p">),</span>                  <span class="p">(</span><span class="s1">&#39;js_items&#39;</span><span class="p">,</span> <span class="s1">&#39;items&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;keys&#39;</span><span class="p">,</span> <span class="s1">&#39;py_keys&#39;</span><span class="p">),</span>                    <span class="p">(</span><span class="s1">&#39;js_keys&#39;</span><span class="p">,</span> <span class="s1">&#39;keys&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;py_name&#39;</span><span class="p">),</span>                    <span class="p">(</span><span class="s1">&#39;js_name&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">,</span> <span class="s1">&#39;py_NaN&#39;</span><span class="p">),</span>                      <span class="p">(</span><span class="s1">&#39;js_NaN&#39;</span><span class="p">,</span> <span class="s1">&#39;NaN&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;new&#39;</span><span class="p">,</span> <span class="s1">&#39;py_new&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">,</span> <span class="s1">&#39;py_next&#39;</span><span class="p">),</span>                    <span class="p">(</span><span class="s1">&#39;js_next&#39;</span><span class="p">,</span> <span class="s1">&#39;next&#39;</span><span class="p">),</span>
                                                    <span class="p">(</span><span class="s1">&#39;js_not&#39;</span><span class="p">,</span> <span class="s1">&#39;not&#39;</span><span class="p">),</span>
                                                    <span class="p">(</span><span class="s1">&#39;js_or&#39;</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;pop&#39;</span><span class="p">,</span> <span class="s1">&#39;py_pop&#39;</span><span class="p">),</span>                      <span class="p">(</span><span class="s1">&#39;js_pop&#39;</span><span class="p">,</span> <span class="s1">&#39;pop&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;popitem&#39;</span><span class="p">,</span> <span class="s1">&#39;py_popitem&#39;</span><span class="p">),</span>              <span class="p">(</span><span class="s1">&#39;js_popitem&#39;</span><span class="p">,</span> <span class="s1">&#39;popitem&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="s1">&#39;py_replace&#39;</span><span class="p">),</span>              <span class="p">(</span><span class="s1">&#39;js_replace&#39;</span><span class="p">,</span> <span class="s1">&#39;replace&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;selector&#39;</span><span class="p">,</span> <span class="s1">&#39;py_selector&#39;</span><span class="p">),</span>            <span class="p">(</span><span class="s1">&#39;js_selector&#39;</span><span class="p">,</span> <span class="s1">&#39;selector&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;sort&#39;</span><span class="p">,</span> <span class="s1">&#39;py_sort&#39;</span><span class="p">),</span>                    <span class="p">(</span><span class="s1">&#39;js_sort&#39;</span><span class="p">,</span> <span class="s1">&#39;sort&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;split&#39;</span><span class="p">,</span> <span class="s1">&#39;py_split&#39;</span><span class="p">),</span>                  <span class="p">(</span><span class="s1">&#39;js_split&#39;</span><span class="p">,</span> <span class="s1">&#39;split&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;switch&#39;</span><span class="p">,</span> <span class="s1">&#39;py_switch&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;py_metatype&#39;</span><span class="p">),</span>                <span class="p">(</span><span class="s1">&#39;js_type&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">),</span>    <span class="c1"># Only for the type metaclass, the type operator is dealt with separately in visit_Call</span>
            <span class="p">(</span><span class="s1">&#39;TypeError&#39;</span><span class="p">,</span> <span class="s1">&#39;py_TypeError&#39;</span><span class="p">),</span>          <span class="p">(</span><span class="s1">&#39;js_TypeError&#39;</span><span class="p">,</span> <span class="s1">&#39;TypeError&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;py_update&#39;</span><span class="p">),</span>                <span class="p">(</span><span class="s1">&#39;js_update&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;values&#39;</span><span class="p">,</span> <span class="s1">&#39;py_values&#39;</span><span class="p">),</span>                <span class="p">(</span><span class="s1">&#39;js_values&#39;</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;reversed&#39;</span><span class="p">,</span> <span class="s1">&#39;py_reversed&#39;</span><span class="p">),</span>            <span class="p">(</span><span class="s1">&#39;js_reversed&#39;</span><span class="p">,</span> <span class="s1">&#39;reversed&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;setdefault&#39;</span><span class="p">,</span> <span class="s1">&#39;py_setdefault&#39;</span><span class="p">),</span>        <span class="p">(</span><span class="s1">&#39;js_setdefault&#39;</span><span class="p">,</span> <span class="s1">&#39;setdefault&#39;</span><span class="p">),</span>
                                                    <span class="p">(</span><span class="s1">&#39;js_super&#39;</span><span class="p">,</span> <span class="s1">&#39;super&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;py_true&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;undefined&#39;</span><span class="p">,</span> <span class="s1">&#39;py_undefined&#39;</span><span class="p">),</span>          <span class="p">(</span><span class="s1">&#39;js_undefined&#39;</span><span class="p">,</span> <span class="s1">&#39;undefined&#39;</span><span class="p">),</span>

</pre></div>
</div>
</div>
<p>The predefined aliases are used to resolve name conflicts between Python and JavaScript. Calling e.g <em>&lt;object&gt;.sort (&lt;params&gt;)</em> from Python will invoke a <em>sort</em> method with Python semantics, which in the generated JavaScript is called <em>py_sort</em>. Calling <em>&lt;object&gt;.js_sort &lt;params&gt;</em> from Python will invoke a <em>sort</em> method with JavaScript semantics, which in the generated JavaScript is simply called <em>sort</em>, as 3rd party JavaScript libraries will expect.</p>
<p>Calling <em>__pragma__ (‘noalias’, &lt;Python id part&gt;)</em> will remove the alias. Calling <em>__pragma__ (‘noalias’)</em> without second parameter will remove all aliases. WARNING: This will also remove the predefined aliases.</p>
<p>The alias mechanism is vital to both the compactness and speed of code generated by Transcrypt and to its seamless integration with JavaScript. It allows Transcrypt to extend native JavaScript objects without causing name conflicts even when JavaScript gets expanded over the years, but also without any conversions or other overhead. That’s why in Transcrypt this approach is favored over wrapping native objects.</p>
</div>
<div class="section" id="generating-doc-attributes-from-docstrings-pragma-docat-and-pragma-nodocat">
<h2>3.6. Generating __doc__ attributes from docstrings: __pragma__ (‘docat’) and __pragma__ (‘nodocat’)<a class="headerlink" href="#generating-doc-attributes-from-docstrings-pragma-docat-and-pragma-nodocat" title="Permalink to this headline">¶</a></h2>
<p>Even though docstrings may be present in your code, by default <em>__doc__</em> attributes are not generated, to keep the generated JavaScript code lean. You can switch on and off generation of <em>__doc__</em> attributes for modules, classes, methods and functions with <em>__pragma__ (‘docat’)</em> and <em>__pragma__ (‘nodocat’)</em> respectively. There’s also a <em>-d</em> / <em>–docat</em> command line switch, which can be overruled per module by <em>__pragma__ (‘nodocat’)</em>. Advice: Though these pragma’s are flexible, its advisable to use them only at the spot indicated in the <a class="reference internal" href="supported_constructs.html#autotest-docstrings"><span class="std std-ref">docstrings testlet</span></a>, to retain CPython compatibility. Note that <em>__pragma__ (‘docat’)</em> follows rather than precedes the module docstring, since CPython dictates the module docstring to be the first statement in a module.</p>
</div>
<div class="section" id="skipping-transcrypt-code-fragments-when-running-with-cpython-pragma-ecom-and-pragma-noecom">
<h2>3.7. Skipping Transcrypt code fragments when running with CPython: __pragma__ (‘ecom’) and __pragma__ (‘noecom’)<a class="headerlink" href="#skipping-transcrypt-code-fragments-when-running-with-cpython-pragma-ecom-and-pragma-noecom" title="Permalink to this headline">¶</a></h2>
<p>Executable comments are specially formatted comments, that are turned into executable statements by Transcrypt but, by nature, skipped by CPython.
There are two types of executable comments: single-line and multi-line. Single-line executable comments start with #? at the current indentation level.
Multi-line executable comments start with <em>‘’‘?</em> or <em>“”“?</em> and end with <em>?’‘’</em> or <em>?”“”</em>, again at the current indentation level. There’s also a <em>-ecom</em> command line switch, that can be annihilated locally by <em>__pragma__ (‘noecom’)</em> or its single line equivalent.</p>
<p>If you want the opposite, skipping code in Transcrypt but executing it with CPython, use the the  <a class="reference internal" href="#skipping-fragments"><span class="std std-ref">__pragma__ (‘skip’) … __pragma__ (‘noskip’)</span></a> pair or its single-line variety.</p>
<p>An example of skipping code on either platform is the testlet below:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">The use of executable comments and, for the opposite effect, __pragma__ (‘skip’) and __pragma__ (‘noskip’)</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">org.transcrypt.stubs.browser</span> <span class="k">import</span> <span class="n">__pragma__</span>

<span class="k">def</span> <span class="nf">run</span> <span class="p">(</span><span class="n">autoTester</span><span class="p">):</span>

    <span class="c1"># __pragma__ (&#39;ecom&#39;) # ===================================================================</span>

    <span class="c1"># --- Executed only by Transcrypt ---</span>
    <span class="sd">&#39;&#39;&#39;?</span>
<span class="sd">    for i in range (10):</span>
<span class="sd">        autoTester.check (i)</span>
<span class="sd">    ?&#39;&#39;&#39;</span>

    <span class="c1"># --- Executed only by CPython ---</span>
    <span class="c1"># __pragma__ (&#39;skip&#39;)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">autoTester</span><span class="o">.</span><span class="n">check</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="c1"># __pragma__ (&#39;noskip&#39;)</span>

    <span class="c1"># --- Executed only by Transcrypt ---</span>
    <span class="c1">#?autoTester.check (100)</span>

    <span class="c1"># --- Executed only by CPython ---</span>
    <span class="n">autoTester</span><span class="o">.</span><span class="n">check</span> <span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="c1">#__: skip</span>
        
    <span class="c1">#__pragma__ (&#39;noecom&#39;) # ===================================================================</span>


    <span class="c1"># --- Executed by none ---</span>
    <span class="sd">&#39;&#39;&#39;?</span>
<span class="sd">    for i in range (10, 20):</span>
<span class="sd">        autoTester.check (i)</span>
<span class="sd">    ?&#39;&#39;&#39;</span>

    <span class="c1"># --- Executed by none ---</span>
    <span class="c1">#?autoTester.check (200)</span>

    <span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;ecom&#39;</span><span class="p">)</span> <span class="c1"># ===================================================================</span>


    <span class="c1"># --- Executed only by Transcrypt ---</span>
    <span class="sd">&#39;&#39;&#39;?</span>
<span class="sd">    for i in range (20, 30):</span>
<span class="sd">        autoTester.check (i)</span>
<span class="sd">    ?&#39;&#39;&#39;</span>

    <span class="c1"># --- Executed only by CPython ---</span>
    <span class="c1"># __pragma__ (&#39;skip&#39;)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
        <span class="n">autoTester</span><span class="o">.</span><span class="n">check</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="c1"># __pragma__ (&#39;noskip&#39;)</span>

    <span class="c1"># --- Executed only by Transcrypt ---</span>
    <span class="c1">#?autoTester.check (300)</span>

    <span class="c1"># --- Executed only by CPython ---</span>
    <span class="n">autoTester</span><span class="o">.</span><span class="n">check</span> <span class="p">(</span><span class="mi">300</span><span class="p">)</span> <span class="c1">#__: skip</span>

    <span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;noecom&#39;</span><span class="p">)</span> <span class="c1"># ===================================================================</span>

    <span class="c1"># --- Executed by none ---</span>
    <span class="sd">&#39;&#39;&#39;?</span>
<span class="sd">    for i in range (30, 40):</span>
<span class="sd">        autoTester.check (i)</span>
<span class="sd">    ?&#39;&#39;&#39;</span>

    <span class="c1"># --- Executed by none ---</span>
    <span class="c1">#?autoTester.check (400)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="surpassing-the-speed-of-native-javascript-pragma-fcall-and-pragma-nofcall">
<h2>3.8. Surpassing the speed of native JavaScript: __pragma__ (‘fcall’) and __pragma (‘nofcall’)<a class="headerlink" href="#surpassing-the-speed-of-native-javascript-pragma-fcall-and-pragma-nofcall" title="Permalink to this headline">¶</a></h2>
<p>Fast calls or fcalls are method calls where the method isn’t an attribute of an object’s prototype, but of the object itself, even if this method is inherited over multiple levels. This means that only for the first call the prototype chain is searched and the method is bound to the object. All subsequent calls invoke the bound method directly on the object. You can use the -f command line switch to generate fcall’s pervasively, making your objects slightly larger since they will contain references to their methods. If you don’t want that, just place the definition of the method(s) or class(es) you wish to optimize between   <em>__pragma__ (‘fcall’)</em> and <em>__pragma__ (‘nofcall’)</em>. You can also do the opposite, using the -f switch and exempting some method(s) or class(es) by embedding them between <em>__pragma__ (‘nofcall’)</em> and <em>__pragma__ (‘fcall’)</em>.</p>
<p>Note that these pragmas have to be applied on the function definition location rather than the call location. Placing <em>__pragma__ (‘fcall’)</em> or <em>__pragma__ (‘nofcall’)</em> at the beginning of a module will influence all methods defined in that module. The fcall mechanism is a form of memoization and one example of a transpiler being able to generate optimized code that surpasses common hand coding practice. The fcall mechanism influences neither the pure Python syntax nor the semantics of your program.</p>
</div>
<div class="section" id="enabling-pythons-send-syntax-pragma-gsend-and-pragma-nogsend">
<h2>3.9. Enabling Pythons <em>send</em> syntax: __pragma__ (‘gsend’) and __pragma (‘nogsend’)<a class="headerlink" href="#enabling-pythons-send-syntax-pragma-gsend-and-pragma-nogsend" title="Permalink to this headline">¶</a></h2>
<p>These pragmas enable respectively disable use of Pythons <em>send</em> syntax for generators, which is disabled by default. An example of its use is in the following code:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Use of __pragma__ (‘gsend’) to enable Pythons <em>send</em> syntax fo generators</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        
    <span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;gsend&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test0</span> <span class="p">():</span>
        <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="p">(</span><span class="k">yield</span> <span class="n">r</span><span class="p">)</span>

    <span class="n">gen0</span> <span class="o">=</span> <span class="n">test0</span><span class="p">()</span>
    <span class="nb">next</span> <span class="p">(</span><span class="n">gen0</span><span class="p">)</span>
    <span class="n">autoTester</span><span class="o">.</span><span class="n">check</span> <span class="p">(</span><span class="n">gen0</span><span class="o">.</span><span class="n">send</span> <span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">autoTester</span><span class="o">.</span><span class="n">check</span> <span class="p">(</span><span class="n">gen0</span><span class="o">.</span><span class="n">send</span> <span class="p">(</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test1</span> <span class="p">():</span>
        <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="n">r</span>

    <span class="n">gen1</span> <span class="o">=</span> <span class="n">test1</span><span class="p">()</span>
    <span class="nb">next</span> <span class="p">(</span><span class="n">gen1</span><span class="p">)</span>
    <span class="n">autoTester</span><span class="o">.</span><span class="n">check</span> <span class="p">(</span><span class="n">gen1</span><span class="o">.</span><span class="n">send</span> <span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">autoTester</span><span class="o">.</span><span class="n">check</span> <span class="p">(</span><span class="n">gen1</span><span class="o">.</span><span class="n">send</span> <span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    
</pre></div>
</div>
</div>
</div>
<div class="section" id="automatic-conversion-to-iterable-pragma-iconv-and-pragma-noiconv">
<h2>3.10. Automatic conversion to iterable: __pragma__ (‘iconv’) and __pragma__ (‘noiconv’)<a class="headerlink" href="#automatic-conversion-to-iterable-pragma-iconv-and-pragma-noiconv" title="Permalink to this headline">¶</a></h2>
<p>In CPython sometimes automatic conversion from a non-iterable to an iterable type takes place. This comes at the expense of a runtime typecheck and is by default avoided in Transcrypt for that reason. Iteration through the keys of a <em>dict</em> without explicitly calling its <em>keys ()</em> member is a frequent use case of automatic conversion. To switch on automatic conversion for dicts locally, <em>__pragma__ (‘iconv’)</em> and <em>__pragma__ (‘noiconv’)</em> can be used. The alternative is to switch on automatic conversion globally using the -i command line switch. Use of this switch is disadvised, especially for numerical processing code containing nested loops, since it adds the mentioned typecheck to each <em>for .. in ..</em> loop. When designing numerical processing libraries, it’s advisable to use <em>__pragma__ (‘noiconv’)</em> explicitly at the start of each performance-sensitive module. The result will be that even when an application developer chooses to use the -i switch, the performance of the computations won’t suffer.</p>
</div>
<div class="section" id="conditional-compilation-pragma-ifdef-symbol-pragma-ifndef-symbol-pragma-else-and-pragma-endif">
<span id="pragma-ifdef"></span><h2>3.11. Conditional compilation: __pragma__ (‘ifdef’, &lt;symbol&gt;), __pragma__ (‘ifndef’, &lt;symbol&gt;), __pragma__ (‘else’) and __pragma__ (‘endif’)<a class="headerlink" href="#conditional-compilation-pragma-ifdef-symbol-pragma-ifndef-symbol-pragma-else-and-pragma-endif" title="Permalink to this headline">¶</a></h2>
<p>A piece of code in between <em>__pragma__ (‘ifdef’, &lt;symbol&gt;)</em> and <em>__pragma__ (‘endif’)</em> will only be compiled if &lt;symbol&gt; occurs in the global list of defined symbols.</p>
<p>This pragma works mainly in combination with the <em>-s</em> / <em>–symbols &lt;names joined by $&gt;</em> command line option. On top of that, some command line options automatically add symbols, without using the <em>-s</em> switch.</p>
<p>TODO: Add example</p>
<p>Code after <em>__pragma__ (‘ifndef’, &lt;symbol&gt;)</em> is compiled if &lt;symbol&gt; is NOT defined. To choose between two alternative source code blocks, precede the second block with <em>__pragma__ (‘else’)</em> and terminate it with <em>__pragma__ (‘endif’)</em>.</p>
<p>Important: The conditional compilation pragma’s also work when placed at the start of a line in precompiled or hand-written JavaScript code.</p>
</div>
<div class="section" id="inserting-literal-javascript-pragma-js-and-include">
<span id="pragma-js"></span><h2>3.12. Inserting literal JavaScript: __pragma__ (‘js’, …) and __include__ (…)<a class="headerlink" href="#inserting-literal-javascript-pragma-js-and-include" title="Permalink to this headline">¶</a></h2>
<p>During compilation the <em>__pragma__ (‘js’, code, &lt;format parameters&gt;)</em> is replaced by the JavaScript code given in the <em>code</em> parameter. This code is formatted using the Python <em>str.format</em> method, using <em>&lt;format parameters&gt;</em>.</p>
<p>An example of its use is to encapsulate a JavaScript library as a Python module, as is <a class="reference internal" href="integration_javascript.html#code-encaps-fabric"><span class="std std-ref">shown  for the fabric.js library</span></a>. In that case there’s usually one format parameter, namely a call to <em>__include__ (&lt;relative module path&gt;)</em>. The module path is either relative to the directory holding the main module of your project, or to the root of the modules directory, and searched in that order. So modules local to your project prevail over generally available modules.</p>
<p>Note that since {} is used as placeholder in Python formatting, any normal { and } in your JavaScript in the code parameter have to be doubled. If you just want to include a literal piece of JavaScript without any replacements, you can avoid this doubling by using __pragma__ (‘js’, ‘{}’, &lt;my_piece_of_JS_code&gt;).</p>
</div>
<div class="section" id="pragma-jskeys-and-pragma-nojskeys">
<h2>3.13. __pragma__ (‘jskeys’) and __pragma__ (‘nojskeys’)<a class="headerlink" href="#pragma-jskeys-and-pragma-nojskeys" title="Permalink to this headline">¶</a></h2>
<p>Normally in Python, dictionary keys without quotes are interpreted as identifiers and dictionary keys with quotes as string literals. This is more flexible than the JavaScript approach, where dictionary keys with or without quotes are always interpreted as string literals. However to better match the documentation and habits with some JavaScript libraries, such as plotly.js, dictionary keys without quotes can be optionally interpreted as string literals. While the -jk command line switch achieves this globally, the preferred way is to switch on and off this facility locally.</p>
</div>
<div class="section" id="keeping-your-code-lean-pragma-jsmod-and-pragma-nojsmod">
<h2>3.14. Keeping your code lean: __pragma__ (‘jsmod’) and __pragma__ (‘nojsmod’)<a class="headerlink" href="#keeping-your-code-lean-pragma-jsmod-and-pragma-nojsmod" title="Permalink to this headline">¶</a></h2>
<p>When <em>__pragma__ (‘jsmod’)</em> is active, <em>%</em> has JavaScript rather than Python semantics. While the -jm command line switch achieves this globally, the preferred way is to switch on and off this facility locally.</p>
</div>
<div class="section" id="pragma-keycheck-and-pragma-nokeycheck">
<h2>3.15. __pragma__ (‘keycheck’) and __pragma__ (‘nokeycheck’)<a class="headerlink" href="#pragma-keycheck-and-pragma-nokeycheck" title="Permalink to this headline">¶</a></h2>
<p>When <em>__pragma__ (‘keycheck’)</em> is active, an attempt to retrieve an element from a dictionary via a non-existing key results in a KeyError being raised, unless it happens at the lefthand side of an augmented assignment. The run time support for this is expensive, as it requires passing the result of every such retrieval to a function that checks the definedness of the result. While the -kc command line switch switches key checking on globally, the preferred way is to switch on and off this facility locally to prevent code bloat.</p>
</div>
<div class="section" id="keeping-your-code-lean-pragma-kwargs-and-pragma-nokwargs">
<h2>3.16. Keeping your code lean: __pragma__ (‘kwargs’) and __pragma__ (‘nokwargs’)<a class="headerlink" href="#keeping-your-code-lean-pragma-kwargs-and-pragma-nokwargs" title="Permalink to this headline">¶</a></h2>
<p>While it’s possible to compile with the -k command line switch, allowing keyword arguments in all flavors supported by Python 3.5 in all places, this disadvised, as it leads to bloated code. It is better to use the ‘kwargs’ and ‘nokwargs’ pragmas, to enable this feature only at definition (as opposed to calling) of functions that require it. You’ll find an example of how to use these pragma’s in the <a class="reference internal" href="supported_constructs.html#autotest-arguments"><span class="std std-ref">arguments autotest</span></a>. You can use them on whole modules or any part thereof. Note that at due to the dynamic nature of Python, use of keyword arguments at call time cannot be predicted at definition time. When running with CPython from the command prompt using the browser stubs, these pragma’s are ignored.</p>
</div>
<div class="section" id="preventing-target-annotation-pragma-noanno">
<h2>3.17. Preventing target annotation: __pragma__ (‘noanno’)<a class="headerlink" href="#preventing-target-annotation-pragma-noanno" title="Permalink to this headline">¶</a></h2>
<p>The -a command line switch will comment target code compiled from Python with source file names and source line numbers. Since this interferes with literal inclusion of JavaScript code with multi-line comments, it can be switched off by including <em>__pragma__ (‘noanno’)</em> at the beginning of a module. An example of this can be seen in the <a class="reference internal" href="integration_javascript.html#code-encaps-fabric"><span class="std std-ref">encapsulation code for the fabric.js library</span></a>.</p>
</div>
<div class="section" id="operator-overloading-pragma-opov-and-pragma-noopov">
<h2>3.18. Operator overloading: __pragma__ (‘opov’) and __pragma__ (‘noopov’)<a class="headerlink" href="#operator-overloading-pragma-opov-and-pragma-noopov" title="Permalink to this headline">¶</a></h2>
<p>Transcrypt currently supports overloading of the following operators: *, /, +, -, &#64;, [], (), ==, !=, &lt;, &lt;=, &gt;, and &gt;=.</p>
<p>These operators have been chosen since they can enhance the readability of computations involving matrices and vectors, enable the use of callable objects (functors) or are used to compare tuples, lists and sets. Using the -o command line switch will activate operator overloading globally. <em>This is strongly disadvised</em>, since even 1 + 2 will result in two function calls in that case. It’s better to use <em>__pragma__ (‘opov’)</em> to switch it on locally and <em>__pragma__ (‘noopov’)</em> to switch it off again, activating operator overloading only for lines of code involving extensive matrix / vector computations or functor calls (as opposed to definitions), in which case the overhead is negligeable in most cases.</p>
<p>Formula v4 = M * (v1 + v2) + v3 is probably preferred over v4 = add (mul (M, add (v1, v2), v3)), which by the way closely resembles the JavaScript that will be generated for the expression that uses overloaded + and * operators. In order to support operator overloading your matrix and vector classes have to support the appropriate selection of functions out of <em>__mul__</em>, <em>__rmul__</em>, <em>__div__</em>, <em>__rdiv__</em>, <em>__add__</em>, <em>__radd__</em>, <em>__sub__</em>, <em>__rsub__</em>, <em>__matmul__</em>, <em>__rmatmul__</em>, <em>__getitem__</em>, <em>__setitem__</em> and <em>__call__</em> as described in the CPython documentation. The comparison operators are supported by the functions <em>__eq__</em>, <em>__ne__</em>, <em>__lt__</em>, <em>__le__</em>, <em>__gt__</em> and <em>__ge__</em>.</p>
</div>
<div class="section" id="skipping-fragments-while-generating-code-pragma-skip-and-pragma-noskip">
<span id="skipping-fragments"></span><h2>3.19. Skipping fragments while generating code: __pragma__ (‘skip’) and __pragma__ (‘noskip’)<a class="headerlink" href="#skipping-fragments-while-generating-code-pragma-skip-and-pragma-noskip" title="Permalink to this headline">¶</a></h2>
<p>On some occasions it’s handy to be able to skip code generation for fragments of Python source. The most important use case is when you perform a static check using the <a class="reference internal" href="installation_use.html#command-line-switches"><span class="std std-ref">-c or –check</span></a> command line switch. If you use global JavaScript names without importing them from some encapsulation module, you’ll have to tell the static checker that these names are not to be flagged as undefined. Insert a line containing dummy definitions of the unknown names for the static checker, surrounded by <em>__pragma__ (‘skip’) and __pragma__ (‘noskip’)</em>, to make code generator skip these definitions. The beginning of the source code of the Pong demo, shown below, demonstates how this is done.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Preventing complaints of the static checker about unknown global JavaScript names in pong.py</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;skip&#39;</span><span class="p">)</span>
<span class="n">document</span> <span class="o">=</span> <span class="n">window</span> <span class="o">=</span> <span class="n">Math</span> <span class="o">=</span> <span class="n">Date</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Prevent complaints by optional static checker</span>
<span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;noskip&#39;</span><span class="p">)</span>

<span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;noalias&#39;</span><span class="p">,</span> <span class="s1">&#39;clear&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">com.fabricjs</span> <span class="k">import</span> <span class="n">fabric</span>

<span class="n">orthoWidth</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">orthoHeight</span> <span class="o">=</span> <span class="mi">750</span>
<span class="n">fieldHeight</span> <span class="o">=</span> <span class="mi">650</span>

<span class="n">enter</span><span class="p">,</span> <span class="n">esc</span><span class="p">,</span> <span class="n">space</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">32</span>

<span class="n">window</span><span class="o">.</span><span class="n">onkeydown</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">keyCode</span> <span class="o">!=</span> <span class="n">space</span> <span class="c1"># Prevent scrolldown on spacebar press</span>

</pre></div>
</div>
</div>
</div>
<div class="section" id="automatic-conversion-to-truth-value-pragma-tconv-and-pragma-notconv">
<h2>3.20. Automatic conversion to truth value: __pragma__ (‘tconv’) and __pragma__ (‘notconv’)<a class="headerlink" href="#automatic-conversion-to-truth-value-pragma-tconv-and-pragma-notconv" title="Permalink to this headline">¶</a></h2>
<p>When automatic conversion to truth value is activated, an empty array, dict or set has truth value False just as in CPyton, rather than True, as would be the case natively in JavaScript. This comes at the expense of a runtime typecheck and is by default avoided in Transcrypt for that reason. To switch on automatic conversion to truth values locally, <em>__pragma__ (‘tconv’)</em> and <em>__pragma__ (‘notconv’)</em> can be used. The alternative is to switch on automatic conversion globally using the -t command line switch. Use of this switch is disadvised if a lot of boolean expressions are computed in inner loops, since it would result in many extra typechecks. When designing performance sensitive libraries, it’s advisable to use <em>__pragma__ (‘notconv’)</em> explicitly at the start of each performance-sensitive module. The result will be that even when an application developer chooses to use the -t switch, performance of won’t suffer.</p>
</div>
<div class="section" id="adding-directories-to-the-module-search-path-pragma-xpath-directory-list">
<h2>3.21. Adding directories to the module search path: __pragma__ (‘xpath’, &lt;directory list&gt;)<a class="headerlink" href="#adding-directories-to-the-module-search-path-pragma-xpath-directory-list" title="Permalink to this headline">¶</a></h2>
<p>In addition to the <a class="reference internal" href="#module-mechanism"><span class="std std-ref">regular module mechanism</span></a> you can use <em># __pragma__ (‘xpath’, &lt;directory list&gt;)</em> to add directories to the module search path. Note that resolving search paths happens compile time, so dynamic manipulation of the module search path doesn’t apply. If you want to alter the search path in code that is used both by Transcrypt and CPython, you can additionally manipulate <em>sys.path</em> in a <em>try</em> clause or under an <em>if</em> with condition <em>__envir__.executor_name == __envir__.interpreter_name</em>.</p>
<p>The <em>-xp / –xpath</em> <a class="reference internal" href="installation_use.html#command-line-switches"><span class="std std-ref">command line switch</span></a> has the same effect.</p>
</div>
<div class="section" id="using-an-external-transpiler-pragma-xtrans-translator-cwd-workingdirectory">
<h2>3.22. Using an external transpiler: __pragma__ (‘xtrans’, &lt;translator&gt;, …, cwd = &lt;workingdirectory&gt;)<a class="headerlink" href="#using-an-external-transpiler-pragma-xtrans-translator-cwd-workingdirectory" title="Permalink to this headline">¶</a></h2>
<p>This pragma works the same as <em>__pragma__ (‘js’, …)</em>, only now an external translator application can be specified, e.g. to translate JSX code.
If the <em>cwd</em> parameter is present, it the external translator will use it as working directory.
The code offered to this pragma is routed through this external translator by means of pipes.
This pragma can use <em>__include__ (…)</em> just like <em>__pragma__ (‘js’, …)</em>.</p>
<p>Example:</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Test program using __pragma__ (‘xtrans’, …)</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;xtrans&#39;</span><span class="p">,</span> <span class="s1">&#39;change_case.exe&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="sd">&#39;&#39;&#39;/*</span>
<span class="sd">&lt;div id=&quot;StudentContainer&quot;&gt;</span>
<span class="sd">    {self.props.students.map((s) =&gt; (</span>
<span class="sd">        &lt;StudentTile student={s}  key={s.searchval}  /&gt;</span>
<span class="sd">    ))}</span>
<span class="sd">&lt;/div&gt;</span>
<span class="sd">*/\f&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="s1">&#39;workdir&#39;</span><span class="p">,</span> 
<span class="p">)</span>

<span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;xtrans&#39;</span><span class="p">,</span> <span class="s1">&#39;change_case.exe -l&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="sd">&#39;&#39;&#39;/*</span>
<span class="sd">&lt;div id=&quot;StudentContainer&quot;&gt;</span>
<span class="sd">    {self.props.students.map((s) =&gt; (</span>
<span class="sd">        &lt;StudentTile student={s}  key={s.searchval}  /&gt;</span>
<span class="sd">    ))}</span>
<span class="sd">&lt;/div&gt;</span>
<span class="sd">*/\f&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="s1">&#39;workdir&#39;</span><span class="p">,</span> 
<span class="p">)</span>

<span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Simple external translator change_case.cpp, changing the case to upper or lower, depending on -l switch</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;iostream&gt;</span>
<span class="c1">#include &lt;string&gt;</span>
<span class="c1">#include &lt;algorithm&gt;</span>
<span class="c1">#include &lt;fstream&gt;</span>

<span class="n">using</span> <span class="n">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="nb">int</span> <span class="n">main</span> <span class="p">(</span><span class="nb">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="o">*</span><span class="n">argv</span> <span class="p">[])</span> <span class="p">{</span>
    <span class="n">string</span> <span class="n">buffer</span><span class="p">;</span>
    <span class="n">getline</span> <span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\f</span><span class="s1">&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">string</span> <span class="p">(</span><span class="n">argv</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;-l&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">transform</span> <span class="p">(</span><span class="n">buffer</span><span class="o">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">buffer</span><span class="o">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">buffer</span><span class="o">.</span><span class="n">begin</span><span class="p">(),</span> <span class="p">::</span><span class="n">tolower</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">transform</span> <span class="p">(</span><span class="n">buffer</span><span class="o">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">buffer</span><span class="o">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">buffer</span><span class="o">.</span><span class="n">begin</span><span class="p">(),</span> <span class="p">::</span><span class="n">toupper</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">buffer</span><span class="p">;</span>
    
    <span class="o">//</span> <span class="n">Check</span> <span class="k">if</span> <span class="n">cwd</span> <span class="n">parameter</span> <span class="n">works</span> <span class="n">correctly</span>
    <span class="n">ofstream</span> <span class="n">outputFile</span> <span class="p">(</span><span class="s2">&quot;output.txt&quot;</span><span class="p">);</span>
    <span class="n">outputFile</span> <span class="o">&lt;&lt;</span> <span class="n">buffer</span><span class="p">;</span>
    <span class="n">outputFile</span><span class="o">.</span><span class="n">close</span> <span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">The resulting translated file test.js</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;use strict&#39;</span><span class="p">;</span><span class="n">import</span><span class="p">{</span><span class="ne">AssertionError</span><span class="p">,</span><span class="ne">AttributeError</span><span class="p">,</span><span class="ne">BaseException</span><span class="p">,</span><span class="ne">DeprecationWarning</span><span class="p">,</span><span class="ne">Exception</span><span class="p">,</span><span class="ne">IndexError</span><span class="p">,</span><span class="n">IterableError</span><span class="p">,</span><span class="ne">KeyError</span><span class="p">,</span><span class="ne">NotImplementedError</span><span class="p">,</span><span class="ne">RuntimeWarning</span><span class="p">,</span><span class="ne">StopIteration</span><span class="p">,</span><span class="ne">UserWarning</span><span class="p">,</span><span class="ne">ValueError</span><span class="p">,</span><span class="ne">Warning</span><span class="p">,</span><span class="n">__JsIterator__</span><span class="p">,</span><span class="n">__PyIterator__</span><span class="p">,</span><span class="n">__Terminal__</span><span class="p">,</span><span class="fm">__add__</span><span class="p">,</span><span class="fm">__and__</span><span class="p">,</span><span class="fm">__call__</span><span class="p">,</span><span class="vm">__class__</span><span class="p">,</span><span class="n">__envir__</span><span class="p">,</span><span class="fm">__eq__</span><span class="p">,</span><span class="fm">__floordiv__</span><span class="p">,</span><span class="fm">__ge__</span><span class="p">,</span><span class="fm">__get__</span><span class="p">,</span><span class="n">__getcm__</span><span class="p">,</span><span class="fm">__getitem__</span><span class="p">,</span><span class="n">__getslice__</span><span class="p">,</span><span class="n">__getsm__</span><span class="p">,</span><span class="vm">__globals__</span><span class="p">,</span><span class="fm">__gt__</span><span class="p">,</span><span class="n">__i__</span><span class="p">,</span><span class="fm">__iadd__</span><span class="p">,</span><span class="fm">__iand__</span><span class="p">,</span><span class="n">__idiv__</span><span class="p">,</span><span class="n">__ijsmod__</span><span class="p">,</span><span class="fm">__ilshift__</span><span class="p">,</span><span class="fm">__imatmul__</span><span class="p">,</span><span class="fm">__imod__</span><span class="p">,</span><span class="fm">__imul__</span><span class="p">,</span><span class="n">__in__</span><span class="p">,</span><span class="fm">__init__</span><span class="p">,</span><span class="fm">__ior__</span><span class="p">,</span>
<span class="fm">__ipow__</span><span class="p">,</span><span class="fm">__irshift__</span><span class="p">,</span><span class="fm">__isub__</span><span class="p">,</span><span class="fm">__ixor__</span><span class="p">,</span><span class="n">__jsUsePyNext__</span><span class="p">,</span><span class="n">__jsmod__</span><span class="p">,</span><span class="n">__k__</span><span class="p">,</span><span class="n">__kwargtrans__</span><span class="p">,</span><span class="fm">__le__</span><span class="p">,</span><span class="fm">__lshift__</span><span class="p">,</span><span class="fm">__lt__</span><span class="p">,</span><span class="fm">__matmul__</span><span class="p">,</span><span class="n">__merge__</span><span class="p">,</span><span class="fm">__mod__</span><span class="p">,</span><span class="fm">__mul__</span><span class="p">,</span><span class="fm">__ne__</span><span class="p">,</span><span class="fm">__neg__</span><span class="p">,</span><span class="n">__nest__</span><span class="p">,</span><span class="fm">__or__</span><span class="p">,</span><span class="fm">__pow__</span><span class="p">,</span><span class="n">__pragma__</span><span class="p">,</span><span class="n">__proxy__</span><span class="p">,</span><span class="n">__pyUseJsNext__</span><span class="p">,</span><span class="fm">__rshift__</span><span class="p">,</span><span class="n">__setProperty__</span><span class="p">,</span><span class="fm">__setitem__</span><span class="p">,</span><span class="n">__setslice__</span><span class="p">,</span><span class="n">__sort__</span><span class="p">,</span><span class="n">__specialattrib__</span><span class="p">,</span><span class="fm">__sub__</span><span class="p">,</span><span class="n">__super__</span><span class="p">,</span><span class="n">__t__</span><span class="p">,</span><span class="n">__terminal__</span><span class="p">,</span><span class="fm">__truediv__</span><span class="p">,</span><span class="fm">__xor__</span><span class="p">,</span><span class="nb">abs</span><span class="p">,</span><span class="nb">all</span><span class="p">,</span><span class="nb">any</span><span class="p">,</span><span class="k">assert</span><span class="p">,</span><span class="nb">bool</span><span class="p">,</span><span class="nb">bytearray</span><span class="p">,</span><span class="nb">bytes</span><span class="p">,</span><span class="n">callable</span><span class="p">,</span><span class="nb">chr</span><span class="p">,</span><span class="n">copy</span><span class="p">,</span><span class="n">deepcopy</span><span class="p">,</span><span class="nb">delattr</span><span class="p">,</span><span class="nb">dict</span><span class="p">,</span><span class="nb">dir</span><span class="p">,</span><span class="nb">divmod</span><span class="p">,</span><span class="nb">enumerate</span><span class="p">,</span><span class="nb">filter</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="nb">getattr</span><span class="p">,</span><span class="nb">hasattr</span><span class="p">,</span><span class="nb">input</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">isinstance</span><span class="p">,</span>
<span class="nb">issubclass</span><span class="p">,</span><span class="nb">len</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="nb">map</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span><span class="nb">min</span><span class="p">,</span><span class="nb">object</span><span class="p">,</span><span class="nb">ord</span><span class="p">,</span><span class="nb">print</span><span class="p">,</span><span class="nb">property</span><span class="p">,</span><span class="n">py_TypeError</span><span class="p">,</span><span class="n">py_iter</span><span class="p">,</span><span class="n">py_metatype</span><span class="p">,</span><span class="n">py_next</span><span class="p">,</span><span class="n">py_reversed</span><span class="p">,</span><span class="n">py_typeof</span><span class="p">,</span><span class="nb">range</span><span class="p">,</span><span class="nb">repr</span><span class="p">,</span><span class="nb">round</span><span class="p">,</span><span class="nb">set</span><span class="p">,</span><span class="nb">setattr</span><span class="p">,</span><span class="nb">sorted</span><span class="p">,</span><span class="nb">str</span><span class="p">,</span><span class="nb">sum</span><span class="p">,</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">zip</span><span class="p">}</span><span class="n">from</span><span class="s2">&quot;./org.transcrypt.__runtime__.js&quot;</span><span class="p">;</span><span class="n">var</span> <span class="vm">__name__</span><span class="o">=</span><span class="s2">&quot;__main__&quot;</span><span class="p">;</span><span class="n">export</span> <span class="n">var</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">export</span> <span class="n">var</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>

<span class="o">//</span><span class="c1"># sourceMappingURL=test.map</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="create-bare-javascript-objects-and-iterate-over-their-attributes-from-python-pragma-jsiter-and-pragma-nojsiter">
<h2>3.23. Create bare JavaScript objects and iterate over their attributes from Python: __pragma__ (‘jsiter’) and __pragma__ (‘nojsiter’)<a class="headerlink" href="#create-bare-javascript-objects-and-iterate-over-their-attributes-from-python-pragma-jsiter-and-pragma-nojsiter" title="Permalink to this headline">¶</a></h2>
<p>Normally a Python <em>{…}</em> literal is compiled to <em>dict ({…})</em> to include the special attributes and methods of a Python dict, including e.g. an iterator. When <em>__pragma__ (‘jsiter’)</em> is active, a <em>Python {…}</em> literal is compiled to a bare <em>{…}</em>, without special attributes or methods. To still be able to iterate over the attributes of such a bare JavaScript object from Python, when <em>__pragma__ (‘jsiter’)</em> is active, a Python <em>for … in …</em> is literally translated to a JavaScript <em>for (var … in …)</em>. The main use case for this pragma is conveniently looping through class attributes in the <em>__new__</em> method of a metaclass. As a more flexible, but less convenient alternative, <em>__pragma__ (‘js’, ‘{}’, ‘’‘…’‘’)</em> can be used.</p>
<p>An example of the use of this pragma is the following:</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">Use of __pragma__ (‘jsiter’) and __pragma (‘nojsiter’) to manipulate class attributes in a metaclass</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="k">class</span> <span class="nc">UppercaserMeta</span> <span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__new__</span> <span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attribs</span><span class="p">):</span>
        <span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;jsiter&#39;</span><span class="p">)</span>       <span class="c1"># Translate for ... in directly to JavaScript for ... in ... and translate {} to bare {} rather than to dict {}</span>
                                    <span class="c1"># Using bare {} as attribs parameter to __new__ avoids dict attributes masking regular attributes</span>
                                    <span class="c1"># For more flexibility use __pragma__ (&#39;js&#39;, &#39;{}&#39;, &#39;&#39;&#39;...&#39;&#39;&#39;)</span>
        <span class="n">upperAttribs</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">attribKey</span> <span class="ow">in</span> <span class="n">attribs</span><span class="p">:</span>   <span class="c1"># Translates to &#39;for (var attribKey in attribs)&#39; by virtue of __pragma__ (&#39;jsiter&#39;), to iterate over the attributes of a bare JavaScript {}</span>
            <span class="n">upperAttribs</span> <span class="p">[</span><span class="n">attribKey</span> <span class="k">if</span>  <span class="n">attribKey</span><span class="o">.</span><span class="n">startswith</span> <span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">attribKey</span><span class="o">.</span><span class="n">upper</span> <span class="p">()]</span> <span class="o">=</span> <span class="n">attribs</span> <span class="p">[</span><span class="n">attribKey</span><span class="p">]</span>
            
        <span class="n">__pragma__</span> <span class="p">(</span><span class="s1">&#39;nojsiter&#39;</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__new__</span> <span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">upperAttribs</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo_sphinx.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Subjects</a></h3>
  <ul>
<li><a class="reference internal" href="#">3. Special facilities</a><ul>
<li><a class="reference internal" href="#transcrypt-s-module-mechanism">3.1. Transcrypt’s module mechanism</a></li>
<li><a class="reference internal" href="#using-browser-stubs-to-test-non-gui-code-that-uses-console-log-and-window-alert">3.2. Using browser stubs to test non-GUI code that uses console.log and window.alert</a></li>
<li><a class="reference internal" href="#creating-javascript-objects-with-new-constructor-call">3.3. Creating JavaScript objects with __new__ (&lt;constructor call&gt;)</a></li>
<li><a class="reference internal" href="#the-pragma-mechanism">3.4. The __pragma__ mechanism</a><ul>
<li><a class="reference internal" href="#the-function-like-variety">3.4.1. The function-like variety</a></li>
<li><a class="reference internal" href="#the-comment-like-variety">3.4.2. The comment-like variety</a></li>
<li><a class="reference internal" href="#the-single-line-activation-variety">3.4.3. The single-line activation variety</a></li>
<li><a class="reference internal" href="#the-single-line-deactivation-variety">3.4.4. The single-line deactivation variety</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pragma-alias">3.5. Identifier aliasing: __pragma__ (‘alias’, …) and __pragma__ (‘noalias’, …)</a></li>
<li><a class="reference internal" href="#generating-doc-attributes-from-docstrings-pragma-docat-and-pragma-nodocat">3.6. Generating __doc__ attributes from docstrings: __pragma__ (‘docat’) and __pragma__ (‘nodocat’)</a></li>
<li><a class="reference internal" href="#skipping-transcrypt-code-fragments-when-running-with-cpython-pragma-ecom-and-pragma-noecom">3.7. Skipping Transcrypt code fragments when running with CPython: __pragma__ (‘ecom’) and __pragma__ (‘noecom’)</a></li>
<li><a class="reference internal" href="#surpassing-the-speed-of-native-javascript-pragma-fcall-and-pragma-nofcall">3.8. Surpassing the speed of native JavaScript: __pragma__ (‘fcall’) and __pragma (‘nofcall’)</a></li>
<li><a class="reference internal" href="#enabling-pythons-send-syntax-pragma-gsend-and-pragma-nogsend">3.9. Enabling Pythons <em>send</em> syntax: __pragma__ (‘gsend’) and __pragma (‘nogsend’)</a></li>
<li><a class="reference internal" href="#automatic-conversion-to-iterable-pragma-iconv-and-pragma-noiconv">3.10. Automatic conversion to iterable: __pragma__ (‘iconv’) and __pragma__ (‘noiconv’)</a></li>
<li><a class="reference internal" href="#conditional-compilation-pragma-ifdef-symbol-pragma-ifndef-symbol-pragma-else-and-pragma-endif">3.11. Conditional compilation: __pragma__ (‘ifdef’, &lt;symbol&gt;), __pragma__ (‘ifndef’, &lt;symbol&gt;), __pragma__ (‘else’) and __pragma__ (‘endif’)</a></li>
<li><a class="reference internal" href="#inserting-literal-javascript-pragma-js-and-include">3.12. Inserting literal JavaScript: __pragma__ (‘js’, …) and __include__ (…)</a></li>
<li><a class="reference internal" href="#pragma-jskeys-and-pragma-nojskeys">3.13. __pragma__ (‘jskeys’) and __pragma__ (‘nojskeys’)</a></li>
<li><a class="reference internal" href="#keeping-your-code-lean-pragma-jsmod-and-pragma-nojsmod">3.14. Keeping your code lean: __pragma__ (‘jsmod’) and __pragma__ (‘nojsmod’)</a></li>
<li><a class="reference internal" href="#pragma-keycheck-and-pragma-nokeycheck">3.15. __pragma__ (‘keycheck’) and __pragma__ (‘nokeycheck’)</a></li>
<li><a class="reference internal" href="#keeping-your-code-lean-pragma-kwargs-and-pragma-nokwargs">3.16. Keeping your code lean: __pragma__ (‘kwargs’) and __pragma__ (‘nokwargs’)</a></li>
<li><a class="reference internal" href="#preventing-target-annotation-pragma-noanno">3.17. Preventing target annotation: __pragma__ (‘noanno’)</a></li>
<li><a class="reference internal" href="#operator-overloading-pragma-opov-and-pragma-noopov">3.18. Operator overloading: __pragma__ (‘opov’) and __pragma__ (‘noopov’)</a></li>
<li><a class="reference internal" href="#skipping-fragments-while-generating-code-pragma-skip-and-pragma-noskip">3.19. Skipping fragments while generating code: __pragma__ (‘skip’) and __pragma__ (‘noskip’)</a></li>
<li><a class="reference internal" href="#automatic-conversion-to-truth-value-pragma-tconv-and-pragma-notconv">3.20. Automatic conversion to truth value: __pragma__ (‘tconv’) and __pragma__ (‘notconv’)</a></li>
<li><a class="reference internal" href="#adding-directories-to-the-module-search-path-pragma-xpath-directory-list">3.21. Adding directories to the module search path: __pragma__ (‘xpath’, &lt;directory list&gt;)</a></li>
<li><a class="reference internal" href="#using-an-external-transpiler-pragma-xtrans-translator-cwd-workingdirectory">3.22. Using an external transpiler: __pragma__ (‘xtrans’, &lt;translator&gt;, …, cwd = &lt;workingdirectory&gt;)</a></li>
<li><a class="reference internal" href="#create-bare-javascript-objects-and-iterate-over-their-attributes-from-python-pragma-jsiter-and-pragma-nojsiter">3.23. Create bare JavaScript objects and iterate over their attributes from Python: __pragma__ (‘jsiter’) and __pragma__ (‘nojsiter’)</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation_use.html"
                        title="previous chapter">2. Getting started</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="supported_constructs.html"
                        title="next chapter">4. Systematic code examples: a guided tour of Transcrypt</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/special_facilities.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="supported_constructs.html" title="4. Systematic code examples: a guided tour of Transcrypt"
             >next</a> |</li>
        <li class="right" >
          <a href="installation_use.html" title="2. Getting started"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Transcrypt 3.7.15 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Jacques de Hooge.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.8.
    </div>
  </body>
</html>